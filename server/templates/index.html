<!DOCTYPE html>
<html>

<head>
    <title>Source, a Freesound-powered sampler</title>

    <style>
        .cards_container_slide {
            overflow: scroll;
            white-space: nowrap;
        }

        .controls_card {
            display:inline-block;
            padding:5px;
            background-color:#eeeeee;
            margin:5px;
        }
        
        .voice {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 1px solid black;
        }

        .voice_progress {
            overflow: hidden;
            background-color: greenyellow;
            height: 100%;
        }

        #individualSoundEditors{
            display: inline-block;
        }

        #allSoundsEditor{
            display: inline-block;
        }
    </style>

    <script>

        var updateStateTimer;
        var updateSystemStatsTimer;
        var triggerPostStateTimer;
        var lastReceivedStateText;
        var lastReceivedStateXml;
        var updateStateInterval = 50;
        var triggerPostStateInterval = 50;

        document.addEventListener("DOMContentLoaded", function () {
            triggerPostState();
            
            document.getElementById('allSoundsEditor').innerHTML = '<b>All sounds</b><br>' + generateSoundEditControls(-1);
            updateAllSliderLabels();

            startAutoUpdate();
        });

        function startAutoUpdate(){
            updateStateTimer = setInterval(function () {
                updateState();
            }, updateStateInterval);

            triggerPostStateTimer  = setInterval(function () {
                triggerPostState();
            }, triggerPostStateInterval);

            updateSystemStatsTimer = setInterval(function () {
                getSystemStats();
            }, 1000);
        }

        function stopAutoUpdate() {
            window.clearInterval(updateStateTimer);
            window.clearInterval(updateSystemStatsTimer);
            window.clearInterval(triggerPostStateTimer);
        }

        function updateAllSliderLabels(){
            var elements = document.querySelectorAll("input[type=range]")
            for (var i = 0, sliderElement; sliderElement = elements[i++];) {
                updateSliderLabel(sliderElement);
            }
        }

        function updateSliderLabel(sliderElement){
            var labelElement = document.getElementById(sliderElement.id + "Label");
            if (labelElement != null) {
                labelElement.innerHTML = getProcessedSoundParameterValuLinToExp(sliderElement).toFixed(2);
            }
        }

        var expStrength = 2;

        function linToExp(x){
            return (Math.pow(x,expStrength));
        }

        function expToLin(x){
            return (Math.pow(x,1/expStrength));
        }

        function sliderShouldBehaveExponentially(sliderElement){
            var name = sliderElement.name;
            if (name != null){
                if ((name.indexOf("attack") > -1) ||
                    (name.indexOf("decay") > -1) ||
                    (name.indexOf("release") > -1) ||
                    (name == "filterCutoff")
                ){
                    return true;
                }
            }
            
            return false;
        }

        function getProcessedSoundParameterValuLinToExp(sliderElement){
            var value = parseFloat(sliderElement.value, 10);
            if (sliderShouldBehaveExponentially(sliderElement) == true){
                return linToExp(value/sliderElement.max)*sliderElement.max;
            } else {
                return value;
            }
        }

        function getProcessedSoundParameterValueExpToLin(sliderElement, valueRaw){
            if (sliderShouldBehaveExponentially(sliderElement) == true){
                return expToLin(valueRaw/sliderElement.max)*sliderElement.max;
            } else {
                return valueRaw;
            }
        }

        function sendOsc(address, values, types) {
            var data = new FormData();
            data.append('address', address);
            data.append('values', values.join(';'));
            data.append('types', types);

            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function () {
                if (this.readyState != 4) return;
                if (this.status == 200) {
                }
            };
            xhr.open('POST', '/send_osc', true);
            xhr.send(data);
        }

        function setSoundParameter(soundIdx, sliderElement){
            sliderElement.setAttribute("data-lastMoved", Date.now()/1000);
            updateSliderLabel(sliderElement);
            sendOsc('/set_sound_parameter', [soundIdx, sliderElement.name, getProcessedSoundParameterValuLinToExp(sliderElement)], 'int;str;float')
        }

        function setSoundParameterInt(soundIdx, sliderElement){
            sliderElement.setAttribute("data-lastMoved", Date.now()/1000);
            updateSliderLabel(sliderElement);
            sendOsc('/set_sound_parameter_int', [soundIdx, sliderElement.name, sliderElement.value], 'int;str;int')
        }

        function makeQuery(){
            var query = document.getElementsByName('query')[0].value;
            var numSounds = document.getElementsByName('numSounds')[0].value || 16;
            var maxSoundLength = document.getElementsByName('maxSoundLength')[0].value || 0.5;
            sendOsc('/new_query', [query, numSounds, maxSoundLength], 'str;int;float')
        }

        function setMidiRootNoteOffset(){
            var offset = document.getElementsByName('midiRootNoteOffset')[0].value;
            sendOsc('/set_midi_root_offset', [offset * -1], 'int')
        }

        function setMidiInChannel() {
            var midiInChannel = document.getElementsByName('midiInChannel')[0].value;
            sendOsc('/set_midi_in_channel', [midiInChannel], 'int')
        }

        function setMidiThru() {
            var midiThru = document.getElementsByName('midiThru')[0].checked;
            sendOsc('/set_midi_thru', [midiThru ? 1: 0], 'int')
        }

        function setReverbParameters() {
            var roomSize = document.getElementById('0_roomSize').value;
            var damping = document.getElementById('0_damping').value;
            var wetLevel = document.getElementById('0_wetLevel').value;
            var dryLevel = document.getElementById('0_dryLevel').value;
            var width = document.getElementById('0_width').value;
            var freezeMode = document.getElementById('0_freezeMode').value;
            updateAllSliderLabels();
            sendOsc('/set_reverb_parameters', [roomSize, damping, wetLevel, dryLevel, width, freezeMode], 'float;float;float;float;float;float')
        }

        function setNumVoices() {
            var numVoices = document.getElementsByName('numVoices')[0].value;
            sendOsc('/set_polyphony', [numVoices], 'int')
        }

        function playSound(soundIdx){
            sendOsc('/play_sound', [soundIdx], 'int')
        }

        function stopSound(soundIdx){
            sendOsc('/stop_sound', [soundIdx], 'int')
        }

        function savePreset(){
            var name = document.getElementsByName('presetName')[0].value;
            var idx = document.getElementsByName('presetIdx')[0].value;
            sendOsc('/save_current_preset', [name, idx], 'str;int')
        }

        function loadPreset() {
            var idx = document.getElementsByName('presetIdx')[0].value;
            sendOsc('/load_preset', [idx], 'int')
        }

        // UI generation
        function generateSoundEditControls(soundIdx){
            html = '';
            // --> Start auto-generated code A
            html += '<input type="range" id="' + soundIdx + '_filterCutoff" name="filterCutoff" min="10.0" max="20000.0" value="20000.0" step="0.01" oninput="setSoundParameter(' + soundIdx + ', this)" > filterCutoff: <span id="' + soundIdx + '_filterCutoffLabel"></span><br>'
            html += '<input type="range" id="' + soundIdx + '_filterRessonance" name="filterRessonance" min="0.0" max="1.0" value="0.0" step="0.01" oninput="setSoundParameter(' + soundIdx + ', this)" > filterRessonance: <span id="' + soundIdx + '_filterRessonanceLabel"></span><br>'
            html += '<input type="range" id="' + soundIdx + '_maxPitchRatioMod" name="maxPitchRatioMod" min="0.0" max="2.0" value="0.1" step="0.01" oninput="setSoundParameter(' + soundIdx + ', this)" > maxPitchRatioMod: <span id="' + soundIdx + '_maxPitchRatioModLabel"></span><br>'
            html += '<input type="range" id="' + soundIdx + '_maxFilterCutoffMod" name="maxFilterCutoffMod" min="0.0" max="100.0" value="10.0" step="0.01" oninput="setSoundParameter(' + soundIdx + ', this)" > maxFilterCutoffMod: <span id="' + soundIdx + '_maxFilterCutoffModLabel"></span><br>'
            html += '<input type="range" id="' + soundIdx + '_gain" name="gain" min="0.0" max="1.0" value="0.5" step="0.01" oninput="setSoundParameter(' + soundIdx + ', this)" > gain: <span id="' + soundIdx + '_gainLabel"></span><br>'
            html += '<input type="range" id="' + soundIdx + '_ampADSR.attack" name="ampADSR.attack" min="0.0" max="20.0" value="0.1" step="0.01" oninput="setSoundParameter(' + soundIdx + ', this)" > ampADSR.attack: <span id="' + soundIdx + '_ampADSR.attackLabel"></span><br>'
            html += '<input type="range" id="' + soundIdx + '_ampADSR.decay" name="ampADSR.decay" min="0.0" max="20.0" value="0.0" step="0.01" oninput="setSoundParameter(' + soundIdx + ', this)" > ampADSR.decay: <span id="' + soundIdx + '_ampADSR.decayLabel"></span><br>'
            html += '<input type="range" id="' + soundIdx + '_ampADSR.sustain" name="ampADSR.sustain" min="0.0" max="1.0" value="1.0" step="0.01" oninput="setSoundParameter(' + soundIdx + ', this)" > ampADSR.sustain: <span id="' + soundIdx + '_ampADSR.sustainLabel"></span><br>'
            html += '<input type="range" id="' + soundIdx + '_ampADSR.release" name="ampADSR.release" min="0.0" max="20.0" value="1.0" step="0.01" oninput="setSoundParameter(' + soundIdx + ', this)" > ampADSR.release: <span id="' + soundIdx + '_ampADSR.releaseLabel"></span><br>'
            html += '<input type="range" id="' + soundIdx + '_filterADSR.attack" name="filterADSR.attack" min="0.0" max="20.0" value="0.1" step="0.01" oninput="setSoundParameter(' + soundIdx + ', this)" > filterADSR.attack: <span id="' + soundIdx + '_filterADSR.attackLabel"></span><br>'
            html += '<input type="range" id="' + soundIdx + '_filterADSR.decay" name="filterADSR.decay" min="0.0" max="20.0" value="0.0" step="0.01" oninput="setSoundParameter(' + soundIdx + ', this)" > filterADSR.decay: <span id="' + soundIdx + '_filterADSR.decayLabel"></span><br>'
            html += '<input type="range" id="' + soundIdx + '_filterADSR.sustain" name="filterADSR.sustain" min="0.0" max="1.0" value="1.0" step="0.01" oninput="setSoundParameter(' + soundIdx + ', this)" > filterADSR.sustain: <span id="' + soundIdx + '_filterADSR.sustainLabel"></span><br>'
            html += '<input type="range" id="' + soundIdx + '_filterADSR.release" name="filterADSR.release" min="0.0" max="20.0" value="1.0" step="0.01" oninput="setSoundParameter(' + soundIdx + ', this)" > filterADSR.release: <span id="' + soundIdx + '_filterADSR.releaseLabel"></span><br>'
            html += '<input type="range" id="' + soundIdx + '_maxFilterADSRMod" name="maxFilterADSRMod" min="0.0" max="10.0" value="1.0" step="0.01" oninput="setSoundParameter(' + soundIdx + ', this)" > maxFilterADSRMod: <span id="' + soundIdx + '_maxFilterADSRModLabel"></span><br>'
            html += '<input type="range" id="' + soundIdx + '_basePitch" name="basePitch" min="-36.0" max="36.0" value="0.0" step="1.0" oninput="setSoundParameter(' + soundIdx + ', this)" > basePitch: <span id="' + soundIdx + '_basePitchLabel"></span><br>'
            html += '<input type="range" id="' + soundIdx + '_startPosition" name="startPosition" min="0.0" max="1.0" value="0.0" step="0.01" oninput="setSoundParameter(' + soundIdx + ', this)" > startPosition: <span id="' + soundIdx + '_startPositionLabel"></span><br>'
            html += '<input type="range" id="' + soundIdx + '_endPosition" name="endPosition" min="0.0" max="1.0" value="1.0" step="0.01" oninput="setSoundParameter(' + soundIdx + ', this)" > endPosition: <span id="' + soundIdx + '_endPositionLabel"></span><br>'
            html += '<input type="range" id="' + soundIdx + '_loopStartPosition" name="loopStartPosition" min="0.0" max="1.0" value="0.0" step="0.01" oninput="setSoundParameter(' + soundIdx + ', this)" > loopStartPosition: <span id="' + soundIdx + '_loopStartPositionLabel"></span><br>'
            html += '<input type="range" id="' + soundIdx + '_loopEndPosition" name="loopEndPosition" min="0.0" max="1.0" value="1.0" step="0.01" oninput="setSoundParameter(' + soundIdx + ', this)" > loopEndPosition: <span id="' + soundIdx + '_loopEndPositionLabel"></span><br>'
            html += '<input type="range" id="' + soundIdx + '_loopMode" name="loopMode" min="0" max="1" value="0" step="1" oninput="setSoundParameterInt(' + soundIdx + ', this)" > loopMode: <span id="' + soundIdx + '_loopModeLabel"></span><br>'
            html += '<input type="range" id="' + soundIdx + '_maxGainVelMod" name="maxGainVelMod" min="0.0" max="1.0" value="0.5" step="0.01" oninput="setSoundParameter(' + soundIdx + ', this)" > maxGainVelMod: <span id="' + soundIdx + '_maxGainVelModLabel"></span><br>'
            html += '<input type="range" id="' + soundIdx + '_pan" name="pan" min="-1.0" max="1.0" value="0.0" step="0.01" oninput="setSoundParameter(' + soundIdx + ', this)" > pan: <span id="' + soundIdx + '_panLabel"></span><br>'
            html += '<input type="range" id="' + soundIdx + '_pitchBendRangeUp" name="pitchBendRangeUp" min="0.0" max="36.0" value="12.0" step="0.01" oninput="setSoundParameter(' + soundIdx + ', this)" > pitchBendRangeUp: <span id="' + soundIdx + '_pitchBendRangeUpLabel"></span><br>'
            html += '<input type="range" id="' + soundIdx + '_pitchBendRangeDown" name="pitchBendRangeDown" min="0.0" max="36.0" value="12.0" step="0.01" oninput="setSoundParameter(' + soundIdx + ', this)" > pitchBendRangeDown: <span id="' + soundIdx + '_pitchBendRangeDownLabel"></span><br>'
            // --> End auto-generated code A
            return html;
        }

        function updateElementValueFromXmlStates(element, attrName, newState, oldState){
            if (oldState !== undefined){
                if (oldState.getAttribute(attrName) != newState.getAttribute(attrName)){
                    element.value = newState.getAttribute(attrName);
                }
            } else {
                element.value = newState.getAttribute(attrName);
            }
        }

        function createCardForSound(i, sound){ //sound, samplerSound = xml elements
            var cardElementId = i + "_" + sound.getAttribute('soundId');
            html = '<div class="controls_card" id="' + cardElementId + '">';
            html += '<b>' + i + " - " + sound.getAttribute('soundId') + '</b><button onclick="playSound(' + i + ')">play</button><button onclick="stopSound(' + i + ')">stop</button><br>';
            html += sound.getAttribute('soundName') + '<br>';
            html += generateSoundEditControls(i);
            html += '</div>';
            return html;
        }

        function syncUIWithState(xmlState){
            
            var SourcePresetState = xmlState.getElementsByTagName('SourcePresetState')[0];
            var GlobalSettings = xmlState.getElementsByTagName('GlobalSettings')[0];
            var SamplerState = xmlState.getElementsByTagName('Sampler')[0];
            var OldStateSourcePresetState, OldStateGlobalSettings, OldStateSamplerState, OldStateReverbParameters = undefined; 
            var ReverbParameters = xmlState.getElementsByTagName('ReverbParameters')[0];
            if (lastReceivedStateXml !== undefined){
                OldStateSourcePresetState = lastReceivedStateXml.getElementsByTagName('SourcePresetState')[0];
                OldStateGlobalSettings = lastReceivedStateXml.getElementsByTagName('GlobalSettings')[0];
                OldStateSamplerState = lastReceivedStateXml.getElementsByTagName('Sampler')[0];
                OldStateReverbParameters = lastReceivedStateXml.getElementsByTagName('ReverbParameters')[0];
            }
            
            // Update main preset settings and global settings (only update if state has changed)
            updateElementValueFromXmlStates(document.getElementsByName('query')[0], 'query', SourcePresetState, OldStateSourcePresetState);
            updateElementValueFromXmlStates(document.getElementsByName('presetName')[0], 'presetName', SourcePresetState, OldStateSourcePresetState);
            updateElementValueFromXmlStates(document.getElementsByName('midiThru')[0], 'midiThru', GlobalSettings, OldStateGlobalSettings);
            updateElementValueFromXmlStates(document.getElementsByName('midiInChannel')[0], 'midiInChannel', GlobalSettings, OldStateGlobalSettings);
            updateElementValueFromXmlStates(document.getElementsByName('numVoices')[0], 'NumVoices', SamplerState, OldStateSamplerState);
            updateElementValueFromXmlStates(document.getElementById('0_roomSize'), 'reverb_roomSize', ReverbParameters, OldStateReverbParameters);
            updateElementValueFromXmlStates(document.getElementById('0_damping'), 'reverb_damping', ReverbParameters, OldStateReverbParameters);
            updateElementValueFromXmlStates(document.getElementById('0_wetLevel'), 'reverb_wetLevel', ReverbParameters, OldStateReverbParameters);
            updateElementValueFromXmlStates(document.getElementById('0_dryLevel'), 'reverb_dryLevel', ReverbParameters, OldStateReverbParameters);
            updateElementValueFromXmlStates(document.getElementById('0_width'), 'reverb_width', ReverbParameters, OldStateReverbParameters);
            updateElementValueFromXmlStates(document.getElementById('0_freezeMode'), 'reverb_freezeMode', ReverbParameters, OldStateReverbParameters);
            
            // Update volatile state
            var volatileStateElement = document.getElementById('volatileState');
            var VolatileState = xmlState.getElementsByTagName('VolatileState')[0];
            var html = '<div class="voices">';
            if (VolatileState !== undefined){
                var voiceActivations = VolatileState.getAttribute('voiceActivations').split(',').slice(0, -1);
                var voiceSoundIdxs = VolatileState.getAttribute('voiceSoundIdxs').split(',').slice(0, -1);
                var voiceSoundPlayPosition = VolatileState.getAttribute('voiceSoundPlayPosition').split(',').slice(0, -1);
                
                for (var i=0; i<voiceSoundIdxs.length; i++){
                    if (voiceSoundIdxs[i] == "-1"){
                        // Draw empty square
                        html += '<div class="voice"><div class="voice_progress" style="width:0%;">&nbsp;</div></div>'
                    } else {
                        html += '<div class="voice"><div class="voice_progress" style="width:' + 100 * parseFloat(voiceSoundPlayPosition[i], 10) + '%;">' + voiceSoundIdxs[i] + '</div></div>'
                    }
                }
            }
            html += "</div>";
            volatileStateElement.innerHTML = html;
 
            // Update individual sound editors

            // Check if the sound listing has changed
            var shouldRedoCards = false;
            var soundInfoElements = xmlState.getElementsByTagName('soundInfo');
            var samplerSoundElements = xmlState.getElementsByTagName('SamplerSound');
            var OldStateSoundInfoElements, OldStateSamplerSoundElements = undefined;

            if (lastReceivedStateXml === undefined){
                shouldRedoCards = true;
            } else {
                OldStateSoundInfoElements = lastReceivedStateXml.getElementsByTagName('soundInfo');
                OldStateSamplerSoundElements = lastReceivedStateXml.getElementsByTagName('SamplerSound');
                
                var newStateIds = "";
                var oldStateIds = "";
                for (var i=0; i<soundInfoElements.length; i++){
                    newStateIds += soundInfoElements[i].getAttribute('soundId') + ',';
                }
                for (var i=0; i<OldStateSoundInfoElements.length; i++){
                    oldStateIds += OldStateSoundInfoElements[i].getAttribute('soundId') + ',';
                }
                if (newStateIds != oldStateIds){
                    shouldRedoCards = true;
                }
            }

            // Re-create sound cards if needed
            if (shouldRedoCards){
                var individualSoundEditorsElement = document.getElementById('individualSoundEditors');
                individualSoundEditorsElement.innerHTML = '';
                for (var i = 0; i < soundInfoElements.length; i++) {
                    var sound = soundInfoElements[i];
                    var soundCardHtml = createCardForSound(i, sound);
                    individualSoundEditorsElement.innerHTML += soundCardHtml;
                }
            }

            // Update sound sliders if changed
            var slidersToUpdate = [];
            for (var i = 0; i < soundInfoElements.length; i++) {
                var samplerSound = samplerSoundElements[i];
                var oldSamplerSound = undefined;
                if (OldStateSamplerSoundElements !== undefined){
                    oldSamplerSound = OldStateSamplerSoundElements[i];
                }
                 
                var samplerSoundParameters = samplerSound.getElementsByTagName('SamplerSoundParameter');
                var oldStateSamplerSoundParameters = undefined;
                if (oldSamplerSound !== undefined){
                    oldStateSamplerSoundParameters = oldSamplerSound.getElementsByTagName('SamplerSoundParameter');
                }

                for (var j = 0; j < samplerSoundParameters.length; j++) {
                    var parameter = samplerSoundParameters[j];
                    var name = parameter.getAttribute('parameter_name');
                    var type = parameter.getAttribute('parameter_type');
                    var rawValue = parameter.getAttribute('parameter_value');
                    var oldRawValue = undefined;
                    if ((oldStateSamplerSoundParameters !== undefined) && (j < oldStateSamplerSoundParameters.length)){
                        oldRawValue = oldStateSamplerSoundParameters[j].getAttribute('parameter_value');
                    }
                    if (rawValue !== oldRawValue){
                        if (type == "float"){
                            var sliderElement = document.getElementById(i + '_' + name) // Needed to get slider max value
                            var value = getProcessedSoundParameterValueExpToLin(sliderElement, parseFloat(rawValue, 10));
                            slidersToUpdate.push([i + '_' + name, value])
                        } else if (type == "int"){
                            slidersToUpdate.push([i + '_' + name, parseInt(rawValue, 10)])
                        }
                    }
                }
            }
            for (var i=0; i<slidersToUpdate.length; i++){
                var sliderElement = document.getElementById(slidersToUpdate[i][0]);
                var sliderLastMoved = sliderElement.getAttribute("data-lastMoved");
                if ((sliderLastMoved === undefined) || ((Date.now()/1000 - sliderLastMoved) > 1)){
                    // Only update sliders if they are being moved in the last 1 sec
                    sliderElement.value = slidersToUpdate[i][1];
                }
            }
            updateAllSliderLabels();
        }

        // State handling
        function updateState(){
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function () {
                if (this.readyState != 4) return;
                if (this.status == 200) {
                    if (this.responseText == 'Maybe old'){
                        document.getElementById("errorIndicator").innerHTML = 'Plugin appears to be offline';
                    } else {
                            document.getElementById("errorIndicator").innerHTML = 'Plugin appears to be offline';
                        if (this.responseXML != undefined){
                            document.getElementById("errorIndicator").innerHTML = '';
                            document.getElementById("state").value = this.responseText;
                            syncUIWithState(this.responseXML);
                            lastReceivedStateText = this.responseText;
                            lastReceivedStateXml = this.responseXML;
                        }
                    }
                } else {
                    document.getElementById("errorIndicator").innerHTML = 'Server appears to be offline';
                    document.getElementById("state").value = '';
                }
            };
            xhr.open('GET', '/update_state', true);
            xhr.send();
        }

        function triggerPostState(){
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function () {
                if (this.readyState != 4) return;
                if (this.status == 200) {
                    // Do nothing
                }
            };
            xhr.open('GET', '/trigger_post_state', true);
            xhr.send();
        }

        function getSystemStats(){
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function () {
                if (this.readyState != 4) return;
                if (this.status == 200) {
                    document.getElementById("systemStats").value = this.responseText;
                }
            };
            xhr.open('GET', '/get_system_stats', true);
            xhr.send();
        }
        
    </script>
</head>

<body>
    <h1>Source, a Freesound-powered sampler</h1>
    <span id="errorIndicator"></span><br>

    <div class="controls_card">
        <b>Preset</b><br>
        Preset number:</label><input name="presetIdx" value="" type="number">
        <button onclick="savePreset()">Save</button>
        <button onclick="loadPreset()">Load</button><br>
        Preset name:</label><input name="presetName" value="" type="text">

        <br><br>
        <b>Query</b><br>
        Query:<input name="query" value="" type="text" placeholder="percussion"><br>
        Num sounds:<input name="numSounds" value="" type="text" placeholder="16"><br>
        Max sound length:<input name="maxSoundLength" value="" type="text" placeholder="0.5"><br>
        <button onclick="makeQuery()">Go!</button>
    </div>

    <div class="controls_card">
        <b>Reverb</b><br>
        <input type="range" id="0_roomSize" name="roomSize" min="0.0" max="1.0" value="0.5" step="0.01" oninput="setReverbParameters()">
        roomSize: <span id="0_roomSizeLabel"></span><br>
        <input type="range" id="0_damping" name="damping" min="0.0" max="1.0" value="0.5" step="0.01" oninput="setReverbParameters()">
        damping: <span id="0_dampingLabel"></span><br>
        <input type="range" id="0_wetLevel" name="wetLevel" min="0.0" max="1.0" value="0.0" step="0.01" oninput="setReverbParameters()">
        wetLevel: <span id="0_wetLevelLabel"></span><br>
        <input type="range" id="0_dryLevel" name="dryLevel" min="0.0" max="1.0" value="1.0" step="0.01" oninput="setReverbParameters()">
        dryLevel: <span id="0_dryLevelLabel"></span><br>
        <input type="range" id="0_width" name="width" min="0.0" max="1.0" value="1.0" step="0.01" oninput="setReverbParameters()">
        width: <span id="0_widthLabel"></span><br>
        <input type="range" id="0_freezeMode" name="freezeMode" min="0.0" max="1.0" value="0.0" step="0.01" oninput="setReverbParameters()">
        freezeMode: <span id="0_freezeModeLabel"></span>
    </div>

    <div class="controls_card">
        <b>System stats</b><br>
        <button onclick="getSystemStats();">Get system stats</button>
        <textarea id="systemStats" style="width:100%;height:100px;"></textarea>
    </div>

    <div class="controls_card">
        <b>Global options</b><br>
        Num voices:<input name="numVoices" value="" type="number" onchange="setNumVoices()"><br>
        MIDI root note offset:<input name="midiRootNoteOffset" value="" type="number"
            onchange="setMidiRootNoteOffset()"><br>
        MIDI in channel:<input name="midiInChannel" value="" type="number" onchange="setMidiInChannel()"><br>
        MIDI thru:<input name="midiThru" value="" type="checkbox" onchange="setMidiThru()"><br>
    </div>

    <div class="controls_card">
        <b>Volatile state</b><br>
        <div id="volatileState"></div>
    </div>
    
    <div class="cards_container_slide">
        <div id="allSoundsEditor" style="background-color: honeydew;"></div>
        <div id="individualSoundEditors"></div>
    </div>

    <h3>State</h3>
    <button onclick="triggerPostState();">Trigger post state</button><button onclick="startAutoUpdate();">Start auto update</button><button onclick="stopAutoUpdate();">Stop auto update</button>
    <textarea id="state" style="width:100%;height:500px;"></textarea>

</body>
</html>
