<!DOCTYPE html>
<html>
<head>
<title>Source, a Freesound Commmunity Sampler</title>
<script src="https://code.jquery.com/jquery-3.6.0.js"></script>
<script src="https://unpkg.com/wavesurfer.js"></script>
<script src="https://unpkg.com/wavesurfer.js/dist/plugin/wavesurfer.regions.min.js"></script>
<script src="https://unpkg.com/wavesurfer.js/dist/plugin/wavesurfer.cursor.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.6.0/nouislider.css" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.6.0/nouislider.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Rubik+Distressed&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Varela+Round&amp;display=swap" rel="stylesheet"/>
<style>

                /** Define global background variable for dark mode switch **/

                :root {
                    --font-default:'Varela Round', sans-serif;
                    --background-color: #f2f1f1;
                    --font-family :var(--font-default);
                    --knob-inner-back: linear-gradient(45deg, #dad9d9, #ffffff);
                    --knob-inner-shadow:  5px -5px 6px #e3e3e3,-5px 5px 6px #ffffff;
                    --general-color : purple;
                    --white-keys: #f2f1f1;
                    --black-keys: #711771d1;
                    --sound-list-button: 5px -5px 10px #d3d2d2,-5px 5px 10px #ffffff;
                    --parameter-knobs-shadow: -5px 5px 10px #eaeaea,5px -5px 10px #ffffff;
                    --parameter-header-shadow: 5px -5px 2px #ececec, -5px 5px 17px #fff;
                    --slider-thumb-shadow: -5px 5px 10px #c2c1c1,5px -5px 10px #ffffff;
                    --query-button-shadow: 3px -3px 6px #d3d2d2, -3px 3px 6px #ffffff;
                    --waveform-soundlist-shadow: -5px -5px 0px #d4d2d2,5px 5px 100px #ffffff;
                    --launch-mode-shadow:  5px -5px 10px #d3d2d2,-5px 5px 10px #ffffff;
                    --parameter-knob-background: #f2f1f1;
                    --outer-box-shadow: 5px -5px 10px #c6c0c0, -5px 5px 40px #fffdfd;
                    --adsr-header-shadow: rgb(211, 210, 210)0px -5px 10px, rgb(255, 255, 255) -5px 5px 10px;
                    --query-text-shadow: inset 5px -5px 10px #dcdbdb,inset -5px 5px 10px #ffffff;
                    --slider-track-shadow: -5px 5px 10px #c2c1c1,5px -5px 10px #ffffff;
                    --icon-background: purple;
                    --icon-shadow: 5px -5px 10px #d3d2d2,-5px 5px 10px #ffffff;
                    --white-key-shadow:  -5px 5px 10px #e7e7e7,5px -5px 10px #ffffff;
                    --adsr-shadow: rgb(204, 219, 232) 3px 3px 6px 0px inset, rgba(255, 255, 255, 0.5) -3px -3px 6px 1px inset;
                    --inner-box-border: #80008033;
                    --query-icon: rgba(118, 20, 148, 0.7);
                    --black-key-hover: purple;
                    --knob-progress-color: purple;
                }

                * {
                    user-select: none;
                }

                body {
                    box-sizing: border-box;
                    font-family: var(--font-default);
                    display:flex;
                    justify-content: center;
                    align-items: center;
                }

                .container {
                display: grid;
                box-shadow:  -5px -5px 10px #5a5a5a,
                     5px 5px 10px #5a5a5a;
                border-radius: 10px;
                grid-template-columns: repeat(10,1fr);
                grid-template-rows: 0px repeat(10,1fr) 40px;
                grid-template-areas:
                    "header header header header"
                    "main main . sidebar"
                    "footer footer footer footer";
                column-gap: 10px;
                background-color:var(--background-color);
                height: 900px;
                width: 1000px;
                }

                .query-parameters {
                    display:grid;
                    grid-row: 2/3;
                    grid-column: 3/9;
                    grid-template-rows: repeat(3,1fr);
                    grid-template-columns: repeat(3,1fr);
                    margin-top: 100px;

                }

                /**General settings **/
                p {
                    user-select: none;
                }


                #q-par {
                    display:flex;
                    justify-content: space-around;
                    align-items:center;
                    height: auto;
                    grid-row:3/5;
                    grid-column:1/6;
                    gap: 40px;
                    font-weight: bold;
                    font-size: 10px;
                }

                #q-par-labels {
                    display:flex;
                    justify-content: space-around;
                    grid-row:2;
                    height:auto;
                    grid-column: 1/6;
                    gap:70px;
                }

                #q-par-labels p {
                    font-size:12px;
                    font-weight: bold;
                }


                .query-search {
                    display: flex;
                    grid-row: 1/2;
                    grid-column:1/4;
                    border: none;
                    width:100%;
                    height: auto;
                    background: var(--background-color);
                    justify-content: center;
                    align-items: center;
                    margin-top:-40px;

                }
                .query-box{
                  font-family: var(--font-default);
                    font-size: 12px;
                    border: none;
                    width:100px;
                    height: 20px;
                    border-radius: 5px;
                    background-color: transparent;
                    color: var(--general-color);
                }

                .query-text {
                    display:flex;
                    justify-content: center;
                    align-items: center;
                    border: none;
                    width:155px;
                    height: 30px;
                    border-radius: 5px;
                    background-color: var(--background-color);
                    box-shadow: var(--query-text-shadow);

                }


                .query-button{
                    display:flex;
                    width: 40px;
                    height: 30px ;
                    border-radius: 8px;
                    background: var(--background-color);
                    box-shadow: var(--query-button-shadow);
                    justify-content: center;
                    align-items: center;
                            }

                .query-icon{
                    width: auto;
                    height: auto;

                }

                svg {
                    filter: drop-shadow(1px 1px 1px rgba(183, 181, 181, 0.4));

                    border-radius: 10px;
                    }

                .query-animation {
                    transform: scale(1);
                    animation: query-pulse 1s infinite;
                }
                @keyframes query-pulse {
                    0% {
                        transform: scale(0.55);
                        box-shadow: 0 0 0 0 var(--query-icon);
                    }

                    70% {
                        transform: scale(0.8);
                        box-shadow: 0 0 0 10px rgba(0, 0, 0, 0);
                    }
                    }


                .slider-regular {
                    position: relative;
                    display: flex;
                    width: 100px;
                    height: 20px;
                    text-align: center;
                    justify-content: center;
                    border-radius: 5px;
                    background: var(--background-color);
                    box-shadow:  var(--sound-list-button);
                    margin-top:5px;
                }
                .slider-regular-down {
                    display: flex;
                    width: 20px;
                    height: 20px;
                    text-align: center;
                    justify-content: center;
                    border-radius: 5px;
                    background: var(--background-color);
                    box-shadow:  var(--sound-list-button);
                    margin-top:40px;
                    appearance: none !important;
                    position: relative;
                    border-radius: 3px;
                    border: none;
                    box-shadow:  var(--slider-thumb-shadow);
                    background: var(--background-color);
                    cursor: pointer;
                }

                .double-slider,.single-slider {
                    width:180px;
                    height:20px;
                    border: none;
                    background-color: transparent;
                    margin-top: 5px;
                }


                .single-slider {
                    width: 120px;
                }

                .single-slider-octave {
                    height: 85px;
                    background-color: transparent;
                    border: none;

                }

                .single-slider-pitch {
                    height: 85px;
                    background-color: transparent;
                    border: none;

                }

                .noUi-touch-area{
                    border-radius: 3px;
                    height: 30px;
                    width: 25px;
                    box-shadow:  var(--slider-thumb-shadow);
                    background: var(--background-color);
                    border: none;
                }
                .noUi-base .noUi-connects {
                    justify-content: center;
                    border-radius: 5px;
                    background: var(--background-color);
                    box-shadow:  var(--query-text-shadow);
                    border: none;
                }

                .noUi-connect {
                    background-color: var(--inner-box-border);
                    height: 3px;
                    margin-top: 9px;
                }

                .noUi-handle {
                    border: none;
                    border-radius: 5px;
                    background-color: transparent;
                    cursor: default;
                    box-shadow: none;
                }

                .noUi-base .noUi-origin .noUi-handle::after , .double-slider .noUi-base .noUi-origin .noUi-handle::before{
                    background:none;

                }

                .noUi-handle::before, .noUi-handle::after {
                    content: none;
                }

                .noUi-horizontal .noUi-tooltip {
                -webkit-transform: translate(-50%, 0);
                transform: translate(-50%, 0);
                left: 12px;
                bottom: 0px;
                font-size: 9px;
                font-family: var(--font-default);
                background: transparent;
                border: none;
                color: var(--general-color);
                }

                .single-slider-octave .noUi-tooltip, .single-slider-pitch .noUi-tooltip {
                    top: 12px;
                    right:1px;
                    background-color: transparent;
                    border: none;
                    font-size: 10px;
                    font-family: var(--font-default);
                    color: var(--general-color);

                }
                .single-slider-octave .noUi-touch-area, .single-slider-pitch .noUi-touch-area {
                    border-radius: 3px;
                    height: 20px;
                    width: 25px;
                    box-shadow: var(--slider-thumb-shadow);
                    background: var(--background-color);
                    border: none;
                }

                .single-slider-octave .noUi-tooltip {
                    right: 7px;

                }
                input[type="range"] {
                    width:100px;
                    background-color: transparent;
                }

                input[type="range"]::-ms-fill-lower {
                    background-color: var(--inner-box-border);
                    }
                input[type="range"]::-moz-range-progress {
                    background-color: var(--inner-box-border);
                    }
                input[type="range"]::-webkit-slider-thumb {
                    -moz-appearance: none !important;
                    appearance: none !important;
                    position: relative;
                    border-radius: 3px;
                    height: 60px;
                    width: 20px;
                    background: var(--background-color);
                    box-shadow:  var(--slider-thumb-shadow);
                    cursor: pointer;
                    }
                input[type="range"]::-moz-range-thumb {
                    -moz-appearance: none !important;
                    appearance: none !important;
                    position: relative;
                    border-radius: 3px;
                    height: 30px;
                    width: 20px;
                    border: none;
                    box-shadow:  var(--slider-thumb-shadow);
                    background: var(--background-color);
                    cursor: pointer;
                    }
                .range-text {
                        position: absolute;
                        top: 4px;
                        font-family: var(--font-default);
                        user-select: none;
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        background: transparent;
                        text-align: center;
                        height: 10px;
                        width: 10px;
                        margin-left: 80px;
                        font-size:10px;
                        }



                input[type="range"]::-ms-fill-lower{
                    background-color: pink;
                }

                :root {
                --colorMain: white;
                --brShadow: -6px 6px 15px rgb(80, 1, 80);
                --tlShadow: 6px -6px 15px rgb(238, 197, 182);
                }


                .source-icon{
                    display:grid;
                    grid-row:1/2;
                    grid-column: 1/11;
                    transform: rotate(-0deg);
                    text-align:center;
                    margin-left: 50px;
                    margin-top: 65px;
                    color: var(--colorMain);
                    font-size: 3.2em;
                    font-weight: bold;
                    font-family: 'Rubik Distressed', cursive;
                    text-transform: uppercase;
                    text-shadow: var(--brShadow),
                                var(--tlShadow);

                    &::before, &::after {
                        position: absolute;
                        background: var(--colorMain);
                        content: '';
                        border-radius: 10%;

                    }

                    &::before {
                    left: 0;
                    width: 100px;
                    height: 100px;
                    top: -150px;
                    z-index: 10;
                    box-shadow: inset var(--brShadow),
                                inset var(--tlShadow) ;

                    }
                    &::after {
                    left: -50px;
                    width: 200px;
                    height: 200px;
                    top: -200px;
                    box-shadow: var(--brShadow),
                                var(--tlShadow) ;
                    }
                }

                .mode-button {
                    grid-column: 5/6;
                    width: 50px;
                    height: 20px;
                    border-radius: 8px;
                    background: var(--background-color);
                    box-shadow:  var(--sound-list-button);
                    margin-top:20px;
                    margin-left:125px;
                    font-size:10px;
                    font-family: var(--font-default);
                    color: var(--general-color);
                    text-shadow: none;

                }

                .mode-button p {
                    margin-top:5px;
                }


                input[type="button"] {
                    width: auto;
                    height: auto;
                    border: none;
                }
                *:focus {
                    outline: none;
                }

                .waveform {
                    display: grid;
                    grid-row: 3/5;
                    grid-column: 2/6;
                    background: var(--background-color);
                    margin-top: 10px;
                    border-radius: 10px;
                    z-index:1000;
                    grid-template-rows: repeat(4,1fr);
                    box-shadow:  var(--waveform-soundlist-shadow);

                }
                #waveform {
                    grid-row:1/4;
                    grid-column: 1/6;
                    z-index:4000;
                }

                #waveform wave {
                    width: 100%;
                    height: 100%;
                }
                .launch-mode {
                    display: grid;
                    grid-row: 4/5;
                    grid-column: 1/6;
                    grid-template-columns: repeat(6,1fr);
                    background: var(--background-color);
                    border-radius: 5px;
                    box-shadow: var(--launch-mode-shadow);
                    z-index: 2;
                    justify-content: center;
                    align-items: center;
                }

                .left-arrow {
                    grid-column: 2/3;
                    width: 100%;
                    height: 100%;
                    display:flex;
                    align-items: end;
                    flex-direction: column;
                    margin-right: 15px;
                }

                .left-arrow-inner {
                    width: 0;
                    height: 0;
                    margin-top: 10px;
                    background: var(--background-color);
                    border-top: 10px solid transparent;
                    border-bottom: 10px solid transparent;
                    border-right:10px solid var(--icon-background);
                    margin-right:15px;
                }

                .left-arrow-inner:hover{
                    border-right:10px solid var(--inner-box-border);
                }


                .right-arrow {
                    grid-column: 5/6;
                    width: 100%;
                    height: 100%;
                    display:flex;
                    align-items: start;
                    flex-direction: column;
                    background-color: transparent;

                }

                .right-arrow-inner {
                    width: 0;
                    height: 0;
                    margin-top: 10px;
                    background: var(--background-color);
                    border-top: 10px solid transparent;
                    border-bottom: 10px solid transparent;
                    border-left: 10px solid var(--icon-background);
                    border-right: transparent;
                    margin-left: 15px;

                }
                .play-button {
                    width: 0;
                    height: 0;
                    background: var(--background-color);
                    border-top: 7px solid transparent;
                    border-bottom: 7px solid transparent;
                    border-left: 15px solid var(--icon-background);
                    border-right: transparent;
                    margin-left: 20px;
                    margin-top: 2px;

                }

                .right-arrow-inner:hover{
                    border-left: 10px solid var(--inner-box-border);
                }

                .outer-box{
                    display: grid;
                    grid-column: 3/5;
                    width: 100%;
                    height: 100%;
                    border: none;
                    border-radius: 5%;
                    align-items: center;
                    justify-content: center;
                    text-align: center;
                    z-index: 1;
                    background: var(--background-color);
                    box-shadow: var(--outer-box-shadow);

                                        }

                .inner-box {
                    display: flex;
                    width: 80px;
                    height: 25px;
                    border: none;
                    z-index: 2;
                    box-shadow: var(--query-text-shadow);
                    border-radius: 5%;
                    align-items: center;
                    justify-content: center;
                    text-align: center;
                    border: 0.02em solid var(--inner-box-border);
                    }

                .outer-box .inner-box p {
                    color: var(--general-color);
                    font-size: 11px;
                }
                .adsr {
                    grid-row: 5/7;
                    grid-column: 2/6;
                    display:flex;
                    box-shadow: var(--adsr-shadow);
                    margin-top: 10px;
                    border-radius: 10px;
                    border: none;
                    background-color: transparent;

                }

                #adsr-envelope{
                  max-width: 100%;
                  max-height: 100%;
                  flex:1;
                  border: none;
                    }

                .adsr-envelope-knobs {
                    display: grid;
                    grid-gap:5px;
                    grid-row: 7/10;
                    grid-column: 2/6;
                    grid-template-columns: repeat(4,1fr);
                    grid-template-rows: 40px repeat(2,1fr);
                    border-radius: 3%;
                    background: var(--background-color);
                    box-shadow:  var(--parameter-knobs-shadow);
                    margin-top: 10px;

                }

                .adsr-header {
                    display: grid;
                    grid-row:1/2;
                    grid-column: 1/6;
                    grid-template-columns: repeat(6,1fr);
                    background: var(--background-color);
                    border-radius: 5px;
                    box-shadow: var(--launch-mode-shadow);
                    z-index: 2;
                    justify-content: center;
                    align-items: center;
                    border-radius: 8px;
                    box-shadow: var(--adsr-header-shadow);
                }


                .adsr-first-knob {
                    display: flex;
                    grid-row: 2/3;
                    grid-column: 1/6;
                    justify-content: space-around;
                }
                .adsr-second-knob {
                    grid-row: 3/4;
                    grid-column: 1/6;
                    display: flex;
                    align-content: center;
                    justify-content: center;
                    gap:60px;
                    padding-top: 5px;
                    padding-bottom: 5px;


                }

                .canvas {
                    display:flex;
                }

                .knob-inner {
                    display: flex;
                    text-align: center;
                    margin-left: 40px;
                    width:32px;
                    height: 32px;
                    margin-top:-60px;
                    border-radius: 50px;
                    background: var(--knob-inner-back);
                    box-shadow:  var(--knob-inner-shadow);
                }

                .knob-1 p,
                .knob-12 p,
                .knob-2000 p,
                .knob-100 p,
                .knob-reverb p{
                    font-size: 12px;
                    width: 100px;
                    font-weight: normal;
                    font-family: var(--font-family);
                }


                /***5px 5px 6px #9d9d9d, 5px -5px 70px #fff This is for bumpy knob? what to do**/
                .knob-circle {
                    width: 30px;
                    height: 30px;
                    border-radius: 50%;
                    margin: 0% auto;
                    margin-left: 1px;
                    border: 1px solid purple;
                }

                .sound-list {
                    display:grid;
                    grid-row: 3/7;
                    grid-column: 6/10;
                    margin-top: 10px;
                    border-radius: 10px;
                    background: var(--background-color);
                    grid-template-rows:  repeat(6,1fr);
                    grid-template-columns: repeat(2,1fr);
                    box-shadow: var(--waveform-soundlist-shadow);
                }

                .sound-list-options {
                    display: flex;
                    grid-row: 6/7;
                    grid-column: 1/4;
                    height: 100%;
                    background: var(--background-color);
                    border-radius: 5px;
                    box-shadow: var(--launch-mode-shadow);
                    z-index: 2;
                    justify-content: center;
                    align-items: center;
                    gap:15px;

                }

                .sound-list-buttons {
                    display:flex;
                    align-items: center;
                    justify-content: center;
                    width: 50px;
                    height: 20px;
                    border-radius: 8px;
                    background: var(--background-color);
                    box-shadow: var(--sound-list-button);
                    z-index: 3;
                }

                .remove-icon {
                    width: 25px;
                    height:10px;
                    border-radius: 2px;
                    background-color: var(--icon-background);
                    box-shadow:  var(--icon-shadow);

                }

                .remove-icon:hover,
                .stop-icon:hover{
                    background-color: var(--inner-box-border);
                }

                .stop-icon {
                    width: 13px;
                    height:13px;
                    border-radius: 2px;
                    background-color: var(--icon-background);
                    box-shadow:  var(--icon-shadow);
                }


                #sound-dropdown {
                    grid-row:1/6;
                    grid-column:1/3;
                    width: 100%;
                    height: 100%;
                    border: none;
                    border-radius: 5%;
                    background: transparent;
                    color: var(--general-color);

                }

                p {
                    color: var(--general-color);
                }

                .parameter-knobs {
                    display: grid;
                    grid-gap:5px;
                    grid-row: 7/10;
                    grid-column: 6/10;
                    grid-template-columns: repeat(4,1fr);
                    grid-template-rows: 40px repeat(2,1fr);
                    border-radius: 3%;
                    background: var(--background-color);
                    box-shadow:  var(--parameter-knobs-shadow);
                    margin-top: 12px;
                }


                .modulation-velocity-header {
                    display: grid;
                    grid-row:1/2;
                    grid-column: 1/6;
                    grid-template-columns: repeat(6,1fr);
                    background: var(--background-color);
                    border-radius: 5px;
                    box-shadow: var(--launch-mode-shadow);
                    z-index: 2;
                    justify-content: center;
                    align-items: center;
                    border-radius: 8px;
                    box-shadow: var(--adsr-header-shadow);
                }

                .modulation-velocity-knob-area {
                    grid-row: 2/3;
                    grid-column: 1/6;
                    display: flex;
                    align-content: center;
                    justify-content: center;
                    gap:60px;
                    padding-top: 5px;
                    padding-bottom: 5px;
                }

                .reverb-knob-area {
                    display: flex;
                    align-content: center;
                    justify-content: space-around;
                    grid-row: 3/4;
                    grid-column: 1/6;
                }


                .keyboard {
                    display:grid;
                    grid-row:10/12;
                    grid-column: 2/10;
                    grid-template-rows: repeat(2,1fr);
                    border-radius :5px;
                }
                #keyboard {
                    grid-row:2/3;
                    grid-column:1/10;
                    display:grid;
                    grid-template-columns: repeat(10,1fr);
                    border: none;
                    height: 100px;
                  }
                .keyboard-header{
                    display: grid;
                    grid-row:1/2;
                    grid-column: 1/10;
                    grid-template-columns: repeat(6,1fr);
                    background: var(--background-color);
                    border-radius: 5px;
                    box-shadow: var(--launch-mode-shadow);
                    z-index: 2;
                    justify-content: center;
                    align-items: center;
                    border-radius: 8px;
                    box-shadow: var(--adsr-header-shadow);;
                }
                .keys {
                    margin-top: 5px;
                    margin-left:-25px;
                    grid-column: 2/10;
                }
                #keyboard li:first-child {
                    border-radius: 5px 0 5px 5px;
                    }

                #keyboard li:last-child {
                    border-radius: 0 5px 5px 5px;
                    }
                .white-key,
                .black-key {
                    position: relative;
                    float: left;
                    display: flex;
                    align-items: flex-end;
                    padding: 0.5rem 0;
                    user-select: none;
                    cursor: pointer;
                }

                .white-key:hover {
                    box-shadow:  -5px 5px 10px #bdb9b9, 5px -5px 10px #bdb9b9;
                }

                .black-key:hover{
                    background-color: var(--black-key-hover);
                }
                .white-key {
                    height: 4.1rem;
                    width: 0.9rem;
                    z-index: 1;
                    border-left: 1px solid hsl(0, 0%, 84%);
                    border-bottom: 1px solid hsl(0, 0%, 84%);
                    border-radius: 0 0 5px 5px;
                    background: var(--white-keys);
                    box-shadow: var(--white-key-shadow);
                    color: var(--black-30);
                    }
                .black-key {
                    height: 2.2rem;
                    width: 0.48rem;
                    margin: 0 0 0 -0.3rem;
                    z-index: 2;
                    border: 1px solid var(--black-keys);
                    border-radius: 0 0 3px 3px;
                    box-shadow: -1px -1px 2px var(--white-20) inset,
                        0 -5px 2px 3px var(--black-60) inset, 0 2px 4px var(--black-50);
                    background: var(--black-keys);
                    color: var(--white-50);
                    }

                .flash {
                  -webkit-animation: flash linear 1s infinite;
                        animation: flash linear 1s infinite;
                }
                .offset {
                    margin: 0 0 0 -0.5rem;
                    }

                    @-webkit-keyframes flash {
                        0% { opacity: 1; }
                        50% { opacity: .1; }
                        100% { opacity: 1; }
                    }
                    @keyframes flash {
                        0% { opacity: 1; }
                        50% { opacity: .1; }
                        100% { opacity: 1; }
                    }

                .white-key p {
                    color: var(--icon-background);
                    margin-bottom: -5px;
                    margin-left:1px;
                    font-size: 7px;
                    font-weight: bold;
                }


            </style>
<script>

                $(function(){
                    $(".knob-1").knob({
                        'min':0,
                        'max':1,
                        'step':0.01,
                        'width':45,
                        'height':45,
                        'displayInput': true,
                        'thickness': 0.2,
                        'angleOffset':180,
                        'fgColor': 'purple',
                        'bgColor':'#dad9d9',
                        'font': 'var(--font-default)',
                        'change': function(v) {
                            ss.setSoundParameter(this['$'][0]['id'],v,0,1);
                            if (adsrList.includes(this['$'][0]['id'])){
                                drawAdsrEnvelope();
                            }
                        }
                    });

                    $(".knob-reverb").knob({
                        'min':0,
                        'max':1,
                        'step':0.01,
                        'width':45,
                        'height':45,
                        'displayInput': true,
                        'thickness': 0.2,
                        'angleOffset':180,
                        'fgColor': 'purple',
                        'bgColor':'#dad9d9',
                        'font': 'var(--font-default)',
                        'change': function(v) {
                            //Set reverb parameter to the new value
                            reverbParams[this['$'][0]['id']] = v;
                            ss.setReverbParameters();
                        }
                    });

                    $(".knob-100").knob({
                        'min':0,
                        'max':100,
                        'step':0.01,
                        'width':45,
                        'height':45,
                        'displayInput': true,
                        'thickness': 0.2,
                        'angleOffset':180,
                        'fgColor': 'purple',
                        'bgColor':'#dad9d9',
                        'change': function(v) {
                            ss.setSoundParameter(this['$'][0]['id'],v,0,1);
                        }
                    });


                    $(".knob-12").knob({
                        'min':-12,
                        'max':12,
                        'step':0.01,
                        'width':45,
                        'height':45,
                        'displayInput': true,
                        'thickness': 0.2,
                        'angleOffset':180,
                        'fgColor': 'purple',
                        'bgColor':'#dad9d9',
                        'change': function(v) {
                            ss.setSoundParameter(this['$'][0]['id'],v,0,1);
                        }
                    });

                    $(".knob-2000").knob({
                        'min':10,
                        'max':20000,
                        'step':1,
                        'width':45,
                        'height':45,
                        'displayInput': true,
                        'thickness': 0.2,
                        'angleOffset':180,
                        'fgColor': 'purple',
                        'bgColor':'#dad9d9',
                        'change': function(v) {
                            ss.setSoundParameter(this['$'][0]['id'],v,0,1)
                        }
                    });
                });



                let ss = undefined;  // Will keep source plugin state and has util methods to interact with it
                let httpPort = undefined;
                let useHttps = undefined;
                let hostname = undefined;

                //Define a global selected sound
                var selectedSoundUUID = null;

                //Sound list for play and remove
                let playStopSoundList = [];

                //Midi note list to stop previous one
                let loopTriggerMidiOnOffSet = new Set();
                let midiOnOffList = [];

                //ADSR lists
                let adsrList = ["attack","decay","release","sustain", "filterAttack","filterDecay","filterRelease","filterSustain"]
                let launchModes = ['default','loop', 'loopfb'];
                let gateTriggerModes = ['gate','trigger'];
                let adsrModes = ['filter', 'amplitude'];
                let modVelocityModes = ['modulation','velocity'];
                //Reverb parameters
                let reverbParams = {'roomSize':0, 'damping':0, 'wetLevel':0, 'dryLevel':0, 'width':0,'freezeMode':0}

                //Knob parameters
                let knobParameterNamesAmp = ["attack", "decay", "sustain", "release","gain","pan",
                                            "mod2CutoffAmt", "mod2GainAmt", "mod2PitchAmt","vel2CutoffAmt", "vel2GainAmt"]
                let knobParameterNamesFilter = ["filterAttack", "filterDecay","filterRelease","filterCutoff","filterRessonance",
                                                "mod2CutoffAmt", "mod2GainAmt", "mod2PitchAmt", "vel2CutoffAmt", "vel2GainAmt"]
                //ADSR initial dictionary
                let DefaultParams = {
                        attackTime: 0.1,
                        decayTime: 0.1,
                        sustainLevel: 0.1,
                        releaseTime: 0.1,
                        gateTime: 1,
                        peakLevel: 1,
                        epsilon: 0.001,
                        attackCurve: "exp",
                        decayCurve: "exp",
                        releaseCurve: "exp",
                        };

                //Wavecolor
                var wavesurferColor = 'purple';

                var adsrBackgroundColor = '#f2f1f1';


                var expStrength = 2;  // For sliders

                window.AudioContext = window.AudioContext || window.webkitAudioContext; // Audio context used for loading audio for drawing waveforms
                const audioContext = new AudioContext();

                let lastUIAction = 0;

                var wavesurfer = null;

                var slider = null;
                var singleSlider = null;
                var launchSlider = null;

                var newInnerBoxBorder = null;


                class StateSynchronizer {  // Class to synchronize with plugin's state and interact with it

                    constructor(wsPort, useWss) {
                        this.state = undefined;
                        this.volatileState = undefined;
                        this.volatileStateRequestTimer = undefined;
                        this.volatileStateRequestTimerInterval = 100;
                        this.parser = new DOMParser();

                        this.wsPort = wsPort;
                        this.useWss = useWss;
                        this.wsConnection = this.configureWSConnection();

                        this.afterStateUpdatesFullStateRequestTimer = undefined;
                        this.afterStateUpdatesFullStateRequestTimerInterval = 1000;
                    }

                    scheduleExtraFullStateRequestAfterBurstOfMessages () {
                        // Because sometimes there can be state syncing issues if messages arrive in wrong orders or due to
                        // other whings we did not contemplate, once a burst of state update messages has finished, we call request
                        // once more a full state update to make sure everything is perfectly in sync.
                        if (this.afterStateUpdatesFullStateRequestTimer !== undefined){
                            clearTimeout(this.afterStateUpdatesFullStateRequestTimer);
                            this.afterStateUpdatesFullStateRequestTimer = undefined;
                        }
                        this.afterStateUpdatesFullStateRequestTimer = setTimeout(() => {
                            this.requestFullState();
                        }, this.afterStateUpdatesFullStateRequestTimerInterval);
                    }

                    configureWSConnection () {
                        let wsUrl = "";
                        if (this.useWss){
                            wsUrl = "wss://" + hostname + ":" + this.wsPort + "/source_coms/";
                        } else {
                            wsUrl = "ws://" + hostname + ":" + this.wsPort + "/source_coms/";
                        }
                        console.log("Connecting to WS server: " + wsUrl);
                        let socket = new WebSocket(wsUrl);

                        let self = this;

                        socket.onopen = function(e) {
                            console.log("[WS open] Connection established");

                            // Once connection established, request full state once and start polling volatile state
                            self.requestFullState();
                            self.volatileStateRequestTimer = setInterval(function () {
                                self.requestVolatileState();
                            }, self.volatileStateRequestTimerInterval);

                            //Clear all sounds from previous session
                            ss.clearAllSounds();
                        };

                        socket.onclose = function(event) {
                            if (event.wasClean) {
                                console.log(`[WS close] Connection closed cleanly, code=${event.code} reason=${event.reason}`);
                            } else {
                                console.log('[WS close] Connection died');
                            }
                            setTimeout(() => {
                                self.configureWSConnection (); // Start again connection if it fails, wait 2 seconds
                            }, 2000);

                        };

                        socket.onerror = function(error) {
                            console.log(`[WS error] ${error.message}`);
                        };

                        socket.onmessage = function(event) {
                            const msgTypeSeparatorPosition = event.data.indexOf(':');
                            const msgType = event.data.slice(0, msgTypeSeparatorPosition);
                            const rawData = event.data.slice(msgTypeSeparatorPosition + 1, event.data.length);


                            //PROBLEM HERE IS THAT FULL STATE MSG IS COMING BUT VOLATILE IS MORE? HOW TO SOLVE THIS?
                            if (msgType === "/full_state"){
                                const updateIdSeparatorPosition = rawData.indexOf(';');
                                const updateId = parseInt(rawData.slice(0, updateIdSeparatorPosition), 10);
                                const dataToParse = rawData.slice(updateIdSeparatorPosition + 1, rawData.length);
                                self.state = self.parser.parseFromString(dataToParse, "text/xml");

                            } else if (msgType === "/volatile_state"){
                                self.volatileState = self.parser.parseFromString(rawData, "text/xml");
                                updateVolatileUI();

                            } else if (msgType === "/state_update"){

                                if (ss.state === undefined){
                                    // If no state is present, ignore stat update messages as these will fail
                                    // also request full state to get in sync again
                                    self.requestFullState();
                                    return;
                                }

                                const rawDataParts = rawData.split(';');
                                const updateType = rawDataParts[0];
                                const updateId = parseInt(rawDataParts[1], 10);
                                const restOfDataSliced = rawDataParts.slice(2, rawDataParts.length);

                                if (updateType === 'propertyChanged'){
                                    const treeUUID = restOfDataSliced[0];
                                    const treeType = restOfDataSliced[1];
                                    const propertyName = restOfDataSliced[2];
                                    const propertyValue = restOfDataSliced[3];

                                    const elementToUpdate = self.state.querySelector("[uuid='" + treeUUID + "']");
                                    if (elementToUpdate !== null){
                                        elementToUpdate.setAttribute(propertyName, propertyValue);


                                        // If property was found, trigger corresponding UI updates
                                        if (treeType === "SOUND"){
                                            // If what changed is a property of a sound or sound sample, then update the sound list
                                            var sound = ss.getSoundFromSoundUUID(treeUUID);
                                            //If sound exists and not in the deleted mode,
                                            if ((sound !== null) && (propertyName !== "willBeDeleted" && propertyName === "downloadCompleted")){
                                                console.log(propertyName);
                                                updateSoundList(sound.getAttribute('uuid'));
                                            } else {

                                            }

                                            // If the property name is that of a slider (sound parameter), then update the slider as well
                                            if (isSoundParameter(propertyName)){
                                                // NOTE: in that case, treeUUID will always correspond to a SOUND element
                                                updateSoundParameter(treeUUID, propertyName, propertyValue, elementToUpdate);
                                            }
                                        } else if (treeType === "SOUND_SAMPLE"){
                                            var sound = ss.getSoundFromSoundSampleUUID(treeUUID);

                                            //If the property belongs to querying, add the sounds to the sound list
                                            if ((sound !== null) && (propertyName !== "willBeDeleted" && propertyName === "downloadCompleted")){
                                                console.log('sound_sample',propertyName);
                                                updateSoundList(sound.getAttribute('uuid'));
                                            } else {
                                                // We might receive property change messages from sounds that are being deleted and that still exist in our state
                                                // We can ignore these messages, but lets print a warning if a message refers to some unexpected property
                                                if (propertyName !== "willBeDeleted"){
                                                    console.log('WARNING: property change for unexisting sound different from "willBeDeleted": ', propertyName, propertyValue);
                                                }
                                            }

                                        } else if ((treeType === "SOURCE_STATE") || (treeType === "PRESET")){
                                            // If one of the main state or preset state properties changed, update main preset parameters as it will be contained in one of these
                                        } else if (treeType === "MIDI_CC_MAPPING"){
                                        }
                                    }

                                } else if (updateType === 'addedChild'){
                                    const parentTreeUUID = restOfDataSliced[0];
                                    const parentTreeType = restOfDataSliced[1];
                                    const indexInParentChildren = parseInt(restOfDataSliced[2], 10);
                                    const childXmlString = restOfDataSliced.slice(3, restOfDataSliced.length).join(';');
                                    // Add new child element to the state
                                    var elementToUpdate;
                                    if (parentTreeType === "PRESET"){
                                        // If adding child of type preset, add it to the main SOURCE_STATE node regardless of the SOURCE_STATE uuid which some times changes
                                        elementToUpdate = ss.state.childNodes[0];
                                    } else {
                                        elementToUpdate = self.state.querySelector("[uuid='" + parentTreeUUID + "']");
                                    }
                                    if (elementToUpdate !== null){
                                        var nodeToAdd = self.parser.parseFromString(childXmlString, "text/xml").childNodes[0];
                                        if (indexInParentChildren < 0){
                                            elementToUpdate.appendChild(nodeToAdd);
                                        } else {
                                            var beforeNode = elementToUpdate.childNodes[indexInParentChildren];
                                            elementToUpdate.insertBefore(nodeToAdd, beforeNode);
                                        }

                                        // If new sounds or midi cc mappings are added, recreate sounds section
                                        if ((nodeToAdd.tagName === "MIDI_CC_MAPPING") || (nodeToAdd.tagName === "SOUND")){
                                            updateSoundList();
                                        }
                                    }

                                } else if (updateType === 'removedChild'){
                                    const childToRemoveUUID = restOfDataSliced[0];
                                    const childToRemoveType = restOfDataSliced[1];

                                    // Remove the selected element from the state
                                    const stateElementToRemove = self.state.querySelector("[uuid='" + childToRemoveUUID + "']");
                                    if (stateElementToRemove !== null){
                                        stateElementToRemove.remove();

                                        // Trigger corresponding UI updates
                                        const domElementToUpdate = document.getElementById(childToRemoveUUID);
                                        if (domElementToUpdate !== null){
                                            domElementToUpdate.remove();
                                        }


                                    }
                                }

                                self.scheduleExtraFullStateRequestAfterBurstOfMessages();
                            }
                        };

                        return socket;

                    }

                    sendMessageToPlugin(address, args){
                        const message = address + ':' + args.join(';');
                        this.wsConnection.send(message);
                    }

                    requestFullState(){
                        this.sendMessageToPlugin('/get_state', ["full"]);
                    }

                    requestVolatileState(){
                        this.sendMessageToPlugin('/get_state', ["volatile"]);
                    }

                    // Util methods to get state info

                    getSounds(){
                        return ss.state.getElementsByTagName('SOUND');
                    }

                    getSoundSamplerSounds(sound){  // sound = sound xml state
                        if (sound !== null){
                            return sound.getElementsByTagName('SOUND_SAMPLE');
                        } else {
                            return [];
                        }

                    }

                    getSoundDuration(selectedSoundUUID){
                        var sound = ss.getSoundFromSoundUUID(selectedSoundUUID);
                        var samplerSounds = ss.getSoundSamplerSounds(sound);
                        return samplerSounds[0].getAttribute('duration')
                    }

                    getFirstSoundSampleSound(sound) {  // sound = sound xml state
                        return this.getSoundSamplerSounds(sound)[0];
                    }

                    getSoundFromSoundUUID(soundUUID){
                        return ss.state.querySelector("[uuid='" + soundUUID + "']");
                    }

                    getSoundFromSoundSampleUUID(soundSampleUUID){
                        const soundSample = ss.state.querySelector("[uuid='" + soundSampleUUID + "']");
                        return ss.getSoundFromSoundUUID(soundSample.parentElement.getAttribute('uuid'));
                    }

                    getMidiMappingStateFromMappingUUID(mappingUUID){
                        return ss.state.querySelector("[uuid='" + mappingUUID + "']");
                    }

                    getSoundMidiMappings(sound){  // sound = sound xml state
                        return sound.getElementsByTagName('MIDI_CC_MAPPING');
                    }

                    findSoundIdxFromSoundUUID(soundUUID){
                        var sounds = ss.getSounds();
                        for (var i=0; i<sounds.length; i++) {
                            if (sounds[i].getAttribute("uuid") == soundUUID){
                                return i + 1;
                            }
                        }
                        return -1
                    }

                    findSoundIdxFromSourceSamplerSoundUUID(samplerSoundUUID){
                        var sounds = ss.getSounds();
                        for (var i=0; i<sounds.length; i++) {
                            var samplerSounds = this.getSoundSamplerSounds(sounds[i]);
                            for (var j=0; j<samplerSounds.length; j++) {
                                var samplerSound = samplerSounds[j];
                                if (samplerSound.getAttribute("uuid") == samplerSoundUUID){
                                    return i + 1;
                                }
                            }
                        }
                        return -1
                    }

                    getTmpFilesLocation(){
                        return this.state.getElementsByTagName('SOURCE_STATE')[0].getAttribute('tmpFilesLocation');
                    }

                    // Util methods to change things of the state

                    setSoundParameter(parameterName, parameterVal, parameterMin, parameterMax, resetMode=undefined){
                        if (resetMode !== undefined){
                            this.sendMessageToPlugin('/set_sound_parameter', [resetMode, parameterName, getProcessedSoundParameterValuLinToExp(parameterName,parameterVal, parameterMin, parameterMax)])

                        }else {
                            this.sendMessageToPlugin('/set_sound_parameter', [selectedSoundUUID, parameterName, getProcessedSoundParameterValuLinToExp(parameterName,parameterVal, parameterMin, parameterMax)])
                        }
                    }

                    setSoundParameterInt(elementName, val){
                        saveCurrentUserActionTime();
                        this.sendMessageToPlugin('/set_sound_parameter_int', [selectedSoundUUID, elementName, val]);
                    }

                    getSoundParameterValue(soundUUID, soundParameterName){
                        let sound = this.getSoundFromSoundUUID(soundUUID);
                        let soundParameterVal = sound.getAttribute(soundParameterName);
                        return soundParameterVal;
                    }

                    addSoundsByQuery(){
                        var VolatileState = ss.volatileState.getElementsByTagName('VOLATILE_STATE')[0];
                        var isQuerying = VolatileState.getAttribute('isQuerying');
                        //Block querying if a query is still going on
                        if (isQuerying ==0){
                        var query = document.getElementsByName('query')[0].value;
                        var numSounds = $('.single-slider')[0].noUiSlider.get()[0];
                        var minSoundLength = $('.double-slider')[0].noUiSlider.get()[0];
                        var maxSoundLength = $('.double-slider')[0].noUiSlider.get()[1];
                        var noteLayoutType = $('#noteLayout p').text();
                        this.sendMessageToPlugin('/add_sounds_from_query', [query, numSounds, minSoundLength, maxSoundLength,noteLayoutType])
                        $('#noteLayout p').text('contiguous');
                        }

                    }

                    reapplyLayout(noteMappingType){
                        this.sendMessageToPlugin('/reapply_layout', [noteMappingType]);
                    }

                    clearAllSounds(){
                        this.sendMessageToPlugin('/clear_all_sounds', [])
                    }

                    setMidiInChannel(midiInChannel) {
                        this.sendMessageToPlugin('/set_midi_in_channel', [midiInChannel])
                    }

                    setReverbParameters() {
                        var reverbParameterList = Object.keys(reverbParams).map(function(key){
                            return reverbParams[key];
                        })
                        this.sendMessageToPlugin('/set_reverb_parameters', reverbParameterList)
                    }

                    setNumVoices() {
                        var numVoices = document.getElementsByName('numVoices')[0].value;
                        this.sendMessageToPlugin('/set_polyphony', [numVoices])
                    }

                    playSound(){
                        //Add sound to the list to stop if a new sound is selected
                        playStopSoundList.push(selectedSoundUUID);


                        if (playStopSoundList.length > 1) {
                            //Stop the previous sound and remove it
                            ss.stopSound(playStopSoundList[0]);
                            playStopSoundList.shift();
                        }
                        var sound = ss.getSoundFromSoundUUID(selectedSoundUUID);
                        var samplerSounds = ss.getSoundSamplerSounds(sound);

                        this.sendMessageToPlugin('/play_sound', [selectedSoundUUID])

                    }

                    stopSound(soundUUID){

                        //Kind of a hack for stopping sound from the button below sound list
                        if (soundUUID === 'stop') {
                            var soundUUID = selectedSoundUUID;
                        }
                        this.sendMessageToPlugin('/stop_sound', [soundUUID])
                    }

                    removeSound(soundUUID){
                        this.sendMessageToPlugin('/remove_sound', [soundUUID])
                    }

                    savePreset(){
                        var name = document.getElementsByName('presetName')[0].value;
                        var idx = document.getElementsByName('presetIdx')[0].value;
                        this.sendMessageToPlugin('/save_preset', [name, idx])
                    }

                    loadPreset() {
                        var idx = document.getElementsByName('presetIdx')[0].value;
                        this.sendMessageToPlugin('/load_preset', [idx])
                    }

                    nextPreset(){
                        var idx = document.getElementsByName('presetIdx')[0].value;
                        if (idx == undefined){
                            idx = -1;
                        } else {
                            idx = parseInt(idx, 10);
                            if (isNaN(idx)){
                                idx = -1;
                            }
                        }
                        this.sendMessageToPlugin('/load_preset', [idx + 1])
                    }

                    sendMidiNoteOn(rootNote){
                        this.sendMessageToPlugin('/note_on',[rootNote, 120, 0]);
                    }

                    sendMidiNoteOff(rootNote){
                        this.sendMessageToPlugin('/note_off', [rootNote, 120, 0]);
                    }


                    previousPreset(){
                        var idx = document.getElementsByName('presetIdx')[0].value;
                        if (idx == undefined){
                            idx = 1;
                        } else {
                            idx = parseInt(idx, 10);

                            if (isNaN(idx)){
                                idx = 1;
                            }
                        }
                        if (idx < 1){
                            idx = 1; //Will become 0 when subtracted 1
                        }
                        this.sendMessageToPlugin('/load_preset', [idx - 1])
                    }

                    rootNote(){
                        var sound = ss.getSoundFromSoundUUID(selectedSoundUUID);
                        var samplerSounds = ss.getSoundSamplerSounds(sound);
                        var samplerSound = samplerSounds[0];
                        this.sendMessageToPlugin('/set_sampler_sound_root_note',[selectedSoundUUID,samplerSound.getAttribute('uuid'),60]);

                    }


                    createUpdateMapping(soundUUID, mappingID){
                        var ccNumber = document.getElementById(mappingID + '_mappingCCNumber').value;
                        var name = document.getElementById(mappingID + '_mappingParameterName').value;
                        var minRange = parseFloat(document.getElementById(mappingID + '_mappingMinRange').value, 10);
                        var maxRange = parseFloat(document.getElementById(mappingID + '_mappingMaxRange').value, 10);
                        this.sendMessageToPlugin('/add_or_update_cc_mapping', [soundUUID, mappingID, ccNumber, name, minRange, maxRange]);
                        if (mappingID == ""){
                            // Remove this element from DOM because this one is only while creating a new mappping
                            document.getElementById('newMappingPlaceholder_' + soundUUID).innerHTML = "";
                        }
                    }

                    removeMidiMapping(soundUUID, mappingID){
                        if (mappingID != ""){
                            this.sendMessageToPlugin('/remove_cc_mapping', [soundUUID, mappingID]);
                            // No need to remove the element itself because it will be removed when updating state
                        } else {
                            document.getElementById('newMappingPlaceholder_' + soundUUID).innerHTML = "";  // Remove new mapping palceholder as the mapping was not yet created
                        }
                    }

                }

                document.addEventListener("DOMContentLoaded", function () {

                    // Main funciont: reads some configuration properties form the URL and starte the StateSynchronizer
                    // Once the StateSyncronizer is started, it will start to receive updates when changes happen in
                    // the plugin's state. These updates will triger renders of appropriate parts of the UI.
                    const queryString = window.location.search;
                    const urlParams = new URLSearchParams(queryString);

                    // If hostname is passed as a parameter, use it for WS and HTTP communications
                    // Otherwise set it to the hostname of the current location
                    if (urlParams.get('hostname') !== null){
                        hostname = urlParams.get('hostname');
                    } else {
                        if (location.hostname !== ""){
                            hostname = location.hostname;
                        } else {
                            hostname = 'localhost';
                        }
                    }

                    // Get websockets/http connection config parameters (or use defaults)
                    if (urlParams.get('wsPort') !== null){
                        wsPort = urlParams.get('wsPort');
                    } else {
                        wsPort = "8125";
                    }
                    if (urlParams.get('useWss') !== null){
                        useWss = urlParams.get('useWss') == '1';
                    } else {
                        useWss = false;
                    }
                    if (urlParams.get('httpPort') !== null){
                        httpPort = urlParams.get('httpPort');
                    } else {
                        httpPort = "8124";
                    }
                    useHttps = useWss;


                    // Start state synchronizer
                    ss = new StateSynchronizer(wsPort, useWss);



                });

                // Util methods

                function updateOctave(obj){
                        var octaveVal = obj.value;
                        var keyboardParent = document.getElementById('keyboard');
                        var keyboardOctaveVal = keyboardParent.children[0].textContent.split("")[1];
                            for(var i=0; i < keyboardParent.children.length; i++){
                                keyboardParent.children[i].id = 12 * (parseInt(octaveVal) + 2) + i;
                            }

                        keyboardParent.children[0].children[0].textContent = "C"+octaveVal;
                        keyboardParent.children[12].children[0].textContent = "C"+(parseInt(octaveVal)+1);

                    }


                function sendMidiMessage(obj){

                        if (obj){
                            var midiNote = obj.id;

                            var launchMode = $("#outer-box-keyboard > #inner-box-launch > p").text();
                            var loopMode = $('#outer-box-launch > #inner-box-launch > p').text();
                            //If mode is gate, the sound should stop as soon as key is released
                            var int00 = 0;
                            if (launchMode === "gate"){
                                $('#'+obj.id).mousedown(function(){
                                        ss.sendMidiNoteOn(midiNote);
                                        int00 = setInterval(function() { console.log('hold?'); }, 50);
                                    }).mouseup(function() {
                                        clearInterval(int00);
                                        ss.sendMidiNoteOff(midiNote);
                                    });

                            }else{
                                //If trigger+loop is selected, the sounds are stopped when the key is hit twice

                                        if (loopTriggerMidiOnOffSet.has(midiNote)){
                                            //Stop that loop sound
                                            ss.sendMidiNoteOff(midiNote);
                                            //Remove that sound from the midionofflist
                                            loopTriggerMidiOnOffSet.delete(midiNote);
                                            if (['loop','loopfb'].includes(loopMode)){
                                            $('#'+midiNote).removeClass('flash');
                                            }
                                        }else {
                                            //Add new sound MIDI note
                                            loopTriggerMidiOnOffSet.add(midiNote);
                                            // Start playing that sound
                                            ss.sendMidiNoteOn(midiNote);
                                            if (['loop','loopfb'].includes(loopMode)){
                                                $('#'+midiNote).addClass('flash');
                                            }

                                          }
                                //If it's not loop and only trigger, play until the end
                                //But if another key is hit, just stop the previous sound
                                }
                        }else {
                          console.log('not obj');
                        }
                      }

                function updateGlobalSoundUUID(){
                    //Update the global sound UUID
                    selectedSoundUUID = $("select#sound-dropdown option").filter(':selected').data('uuid');

                    //Draw the ADSR Envelope for the selected sound
                    drawAdsrEnvelope();

                    //Draw the waveform for the selected sound
                    drawSoundWaveform();

                    //Update the sliders with the new sound
                    updateAllParameterElements();

                    //Update the launch mode
                    updateLaunchMode();

                    //Set midi root of the selected sound
                };

                function updateAllParameterElements(){
                    updateKnobElements();

                }

                function updateKnobElements(){
                    //A workaround for filter/amplitude ADSR selection
                    if ($('#attack') !== null){
                        var iterateList = knobParameterNamesAmp;
                    } else {
                        var iterateList = knobParameterNamesFilter;
                    }
                    for (var i=0; i < iterateList.length;i++){
                        var element = iterateList[i];
                        var elementVal = ss.getSoundParameterValue(selectedSoundUUID, element);
                        $('#'+element).val(elementVal).trigger('change');
                    }
                    if ($('#filterADSR2CutoffAmt').length == 0){
                      updateAmplitudeADSR();
                    }else {
                      updateFilterADSR();
                    }
                }

                function updateFilterADSR(){
                    var iterateList = ['filterAttack','filterDecay','filterRelease','filterSustain','filterADSR2CutoffAmount','filterCutoff','filterRessonance'];
                    for (var i=0; i < iterateList.length;i++){
                        var element = iterateList[i];
                        var elementVal = ss.getSoundParameterValue(selectedSoundUUID, element);
                        $('#'+element).val(elementVal).trigger('change');
                    }

                }

                function updateAmplitudeADSR(){
                    var iterateList = ['attack','decay','release','sustain','pan','gain'];
                    for (var i=0; i < iterateList.length;i++){
                        var element = iterateList[i];
                        var elementVal = ss.getSoundParameterValue(selectedSoundUUID, element);
                        $('#'+element).val(elementVal).trigger('change');
                    }        }


                function updateAmplitudeADSR(){
                    var iterateList = ['attack','decay','release','sustain'];
                    for (var i=0; i < iterateList.length;i++){
                        var element = iterateList[i];
                        var elementVal = ss.getSoundParameterValue(selectedSoundUUID, element);
                        $('#'+element).val(elementVal).trigger('change');
                    }        }


                window.onload = function(){

                    var rangeInput = document.getElementById('q-par');
                    rangeInput.addEventListener('click',function() {
                        const isInput = event.target.nodeName === 'INPUT';
                        var rangeTextName = event.target.id;
                        var rangeText = document.getElementById('range-text-'+rangeTextName);
                        if (rangeText !== null){
                            let newVal = event.target.value;
                            rangeText.innerHTML = newVal; //Set range text equal to input position



                        }
                    })
                    slider = $('.double-slider');

                    noUiSlider.create(slider[0], {
                        start: [0, 90],
                        step: 1,
                        connect: true,
                        tooltips:true,
                        format: wNumb({decimals: 0}),
                        range: {
                            'min': 1,
                            'max': 100,
                        },

                });


                singleSlider = $('.single-slider');

                noUiSlider.create(singleSlider[0], {
                    start: 1,
                    step: 1,
                    connect: true,
                    tooltips:true,
                    format: wNumb({decimals: 0}),
                    range: {
                        'min': 1,
                        'max': 20,
                    },

                });

                }


                function switchColorModes(obj){

                    ss.setMidiInChannel(1);

                    if ($('.mode-button').attr('value') === "0"){
                        var newVal = "1";
                        var newBackground = '#3e424a';
                        var newInnerKnobBack = 'linear-gradient(145deg, #42474f, #383b43)';
                        var newInnerKnobShadow = '8px -8px 16px #191a1e,-8px 8px 16px #636a76';
                        var newGeneralColor = 'white';
                        var newBlackKeys = '#3e424a';
                        var newSoundListButton = "-7px 7px 14px #2b2e34,7px -7px 14px #515660";
                        var newParameterKnobShadow = "-5px 5px 10px #33363d,5px -5px 10px #494e57";
                        var newParameterHeaderShadow = "8px -8px 16px #1b1f20,-8px 8px 16px #41494c";
                        var newSliderThumbShadow = "7px 7px 19px #1a1c1f, -7px -7px 19px #626875";
                        var newQueryButtonShadow = "8px -8px 16px #1b1f20,-8px 8px 16px #41494c";
                        var newWaveformShadow = "inset 6px -6px 12px #272c2e,inset -6px 6px 12px #353c3e";
                        var newLaunchModeShadow = "-5px -5px 10px #222429,5px 5px 200px #5a606b";
                        var newBrShadow = "-6px 6px 15px rgba(95, 185, 185, 1)";
                        var newtlShadow = "6px -6px 15px rgba(95, 185, 185)";
                        var newParameterKnobBackground = "linear-gradient(225deg, #42474f, #383b43)";
                        var newLaunchOuterBoxShadow = "-5px -5px 10px #222429,5px 5px 10px #5a606b";
                        var newAdsrHeaderShadow ="-5px -5px 10px #222429,5px 5px 200px #5a606b";
                        var newQueryTextShadow = "inset 5px 5px 3px #35383f,inset -5px -5px 3px #474c55";
                        var newSliderTrackShadow = "5px 5px 10px #1f2125, -5px -5px 15px #5d636f";
                        var newIconShadow = "none";
                        var newIconBackground = "#838486";
                        var newWhiteKeyShadow = "-1px 1px 5px #b7b7b6, 1px -1px 5px #fff";
                        var newAdsrShadow = "inset 6px -6px 12px #272c2e,inset -6px 6px 12px #353c3e";
                        newInnerBoxBorder = "#5fb9b9a1";
                        var newQueryIcon = "#5fb9b9a1";
                        var newBlackHover = "black";
                        var newKnobProgressColor = "cyan";


                        //Change the waveform color
                        wavesurferColor = '#5fb9b9a1';

                        //Change the background of ADSR Envelope
                        adsrBackgroundColor = '#3e424a';


                        //Change the progress color of knobs
                        $(".knob-1,.knob-100,.knob-12,.knob-2000,.knob-reverb").trigger('configure',
                        {
                        'fgColor': newKnobProgressColor,
                        }
                        );
                        if (wavesurfer){
                            wavesurfer.setWaveColor('#5fb9b9a1');
                        }

                        if (selectedSoundUUID) {
                            drawAdsrEnvelope();
                        }

                    }else{
                        var newVal = "0";
                        var newBackground = '#f2f1f1';
                        var newInnerKnobBack = 'linear-gradient(45deg, #dad9d9, #ffffff)';
                        var newInnerKnobShadow = '5px -5px 6px #e3e3e3,-5px 5px 6px #ffffff';
                        var newGeneralColor = 'purple';
                        var newBlackKeys = '#711771d1';
                        var newSoundListButton = "5px -5px 10px #d3d2d2,-5px 5px 10px #ffffff";
                        var newParameterKnobShadow = "-5px 5px 10px #eaeaea, 5px -5px 10px #ffffff";
                        var newParameterHeaderShadow = "5px -5px 2px #ececec, -5px 5px 17px #fff";
                        var newQueryButtonShadow = "3px -3px 6px #d3d2d2,-3px 3px 6px #ffffff";
                        var newWaveformShadow = "-5px -5px 0px #d4d2d2,5px 5px 100px #ffffff";
                        var newLaunchModeShadow = "5px -5px 10px #d3d2d2,-5px 5px 10px #ffffff";
                        var newBrShadow = "-6px 6px 15px rgb(80, 1, 80)";
                        var newtlShadow = "6px -6px 15px rgb(238, 197, 182)";
                        var newParameterKnobBackground = "#f2f1f1";
                        var newLaunchOuterBoxShadow = "5px -5px 10px #c6c0c0, -5px 5px 40px #fffdfd";
                        var newAdsrHeaderShadow = "rgb(211, 210, 210)0px -5px 10px, rgb(255, 255, 255) -5px 5px 10px";
                        var newQueryTextShadow = "inset 5px -5px 10px #dcdbdb,inset -5px 5px 10px #ffffff";
                        var newSliderTrackShadow = " -5px 5px 10px #32353b,5px -5px 10px #4a4f59";
                        var newSliderThumbShadow = "-5px 5px 10px #c2c1c1,5px -5px 10px #ffffff";
                        var newWhiteKeyShadow = " -5px 5px 10px #e7e7e7,5px -5px 10px #ffffff";
                        var newAdsrShadow = "rgb(204, 219, 232) 3px 3px 6px 0px inset, rgba(255, 255, 255, 0.5) -3px -3px 6px 1px inset";
                        var newIconBackground = "purple";
                        var newIconShadow = " 5px -5px 10px #d3d2d2,-5px 5px 10px #ffffff";
                        newInnerBoxBorder = "#80008033";
                        var newQueryIcon = "rgba(118, 20, 148, 0.7)";
                        var newBlackHover = "purple";
                        var newKnobProgressColor = "purple";

                        wavesurferColor = 'purple;'
                        adsrBackgroundColor = '#f2f1f1';

                        if (wavesurfer){
                            wavesurfer.setWaveColor('purple');
                        }

                        $(".knob-1,.knob-100,.knob-12,.knob-2000,.knob-reverb").trigger('configure',
                        {
                        'fgColor': newKnobProgressColor,
                        }
                        );

                        if (selectedSoundUUID){
                            drawAdsrEnvelope();
                        }


                    }
                    document.documentElement.style.setProperty('--background-color', newBackground);
                    document.documentElement.style.setProperty('--knob-inner-back', newInnerKnobBack);
                    document.documentElement.style.setProperty('--knob-inner-shadow', newInnerKnobShadow);
                    document.documentElement.style.setProperty('--general-color', newGeneralColor);
                    document.documentElement.style.setProperty('--black-keys',newBlackKeys);
                    document.documentElement.style.setProperty('--sound-list-button',newSoundListButton);
                    document.documentElement.style.setProperty('--parameter-knobs-shadow',newParameterKnobShadow);
                    document.documentElement.style.setProperty('--parameter-header-shadow',newParameterHeaderShadow);
                    document.documentElement.style.setProperty('--query-button-shadow', newQueryButtonShadow);
                    document.documentElement.style.setProperty('--waveform-soundlist-shadow', newWaveformShadow);
                    document.documentElement.style.setProperty('--launch-mode-shadow',newLaunchModeShadow);
                    document.documentElement.style.setProperty('--brShadow',newBrShadow);
                    document.documentElement.style.setProperty('--tlShadow', newtlShadow);
                    document.documentElement.style.setProperty('--parameter-knob-background', newParameterKnobBackground);
                    document.documentElement.style.setProperty('--outer-box-shadow', newLaunchOuterBoxShadow);
                    document.documentElement.style.setProperty('--adsr-header-shadow',newAdsrHeaderShadow);
                    document.documentElement.style.setProperty('--query-text-shadow', newQueryTextShadow);
                    document.documentElement.style.setProperty('--slider-track-shadow', newSliderTrackShadow);
                    document.documentElement.style.setProperty('--slider-thumb-shadow', newSliderThumbShadow);
                    document.documentElement.style.setProperty('--icon-background',newIconBackground);
                    document.documentElement.style.setProperty('--icon-shadow',newIconShadow);
                    document.documentElement.style.setProperty('--white-key-shadow', newWhiteKeyShadow);
                    document.documentElement.style.setProperty('--adsr-shadow', newAdsrShadow);
                    document.documentElement.style.setProperty('--inner-box-border', newInnerBoxBorder);
                    document.documentElement.style.setProperty('--query-icon', newQueryIcon);
                    document.documentElement.style.setProperty('--black-key-hover', newBlackHover);
                    document.documentElement.style.setProperty('--knob-progress-color', newKnobProgressColor);
                    $('.mode-button').attr('value',newVal);


                }

                function updateReverseState(){
                    var val = $('#reverse').attr('value');
                    if (val === 1){
                        $('#reverse').attr('value',0);
                        ss.setSoundParameterInt('reverse',val);
                        ss.playSound();
                        return null;
                    }else{
                        $('#reverse').attr('value',1);
                        ss.setSoundParameterInt('reverse',val);
                        ss.playSound();
                        return null;
                                }



                }
                function saveCurrentUserActionTime(){
                    lastUIAction = (new Date()).getTime();
                }

                function msSinceLastUserAction(){
                    return (new Date()).getTime() - lastUIAction;
                }

                function linToExp(x){
                    return (Math.pow(x,expStrength));
                }

                function expToLin(x){
                    return (Math.pow(x,1/expStrength));
                }

                function sliderShouldBehaveExponentially(sliderElement){
                    var name = sliderElement.name;
                    if (name != null){
                        if ((name.toLowerCase().indexOf("attack") > -1) ||
                            (name.toLowerCase().indexOf("decay") > -1) ||
                            (name.toLowerCase().indexOf("release") > -1) ||
                            (name == "filterCutoff")
                        ){
                            return true;
                        }
                    }

                    return false;
                }

                function getProcessedSoundParameterValuLinToExp(parameterName, parameterVal, parameterMin, parameterMax){
                    var value = parseFloat(parameterVal, 10);
                    return value;
                }

                function getProcessedSoundParameterValueExpToLin(sliderElement, valueRaw){
                    if (sliderShouldBehaveExponentially(sliderElement) == true){
                        return expToLin(valueRaw/sliderElement.max)*sliderElement.max;
                    } else {
                        return valueRaw;
                    }
                }

                function getMidiControllableParameterNames(){
                    // --> Start auto-generated code B
                    parameterNames = ["startPosition", "endPosition", "loopStartPosition", "loopEndPosition", "playheadPosition", "freezePlayheadSpeed", "filterCutoff", "filterRessonance", "gain", "pan", "pitch"]
                    // --> End auto-generated code B
                    return parameterNames;
                }

                function getAllSoundParameterNames(){
                    // --> Start auto-generated code C
                    parameterNames = ["launchMode", "startPosition", "endPosition", "loopStartPosition", "loopEndPosition", "loopXFadeNSamples", "reverse", "noteMappingMode", "numSlices", "playheadPosition", "freezePlayheadSpeed", "filterCutoff", "filterRessonance", "filterKeyboardTracking", "filterAttack", "filterDecay", "filterSustain", "filterRelease", "filterADSR2CutoffAmt", "gain", "attack", "decay", "sustain", "release", "pan", "pitch", "pitchBendRangeUp", "pitchBendRangeDown", "mod2CutoffAmt", "mod2GainAmt", "mod2PitchAmt", "mod2PlayheadPos", "vel2CutoffAmt", "vel2GainAmt", "midiChannel"]
                    // --> End auto-generated code C
                    return parameterNames;
                }

                function isSoundParameter(parameterName){
                    return getAllSoundParameterNames().indexOf(parameterName) > -1;
                }

                function getAllSoundParameterTypes(){
                    // --> Start auto-generated code D
                    parameterTypes = ["int", "float", "float", "float", "float", "int", "int", "int", "int", "float", "float", "float", "float", "float", "float", "float", "float", "float", "float", "float", "float", "float", "float", "float", "float", "float", "float", "float", "float", "float", "float", "float", "float", "float", "int"]
                    // --> End auto-generated code D
                    return parameterTypes;
                }

                function getParameterType(parameterName){
                    return getAllSoundParameterTypes()[getAllSoundParameterNames().indexOf(parameterName)];
                }

                // Methods to update different parts of the UI


                function addNewMIDIMappingEditor(soundUUID) {
                        document.getElementById('newMappingPlaceholder_' + soundUUID).innerHTML = createMIDIMappingEditorFromRawParams(soundUUID, "", 0, "", 0.0, 1.0);
                    }

                function createMIDIMappingEditor(soundUUID, mapping){ // mapping xml form state
                    var mappingUUID = mapping.getAttribute('uuid');
                    var ccNumber = parseInt(mapping.getAttribute('ccNumber'), 10);
                    var name = mapping.getAttribute('parameterName');
                    var minRange = parseFloat(mapping.getAttribute('minRange'), 10);
                    var maxRange = parseFloat(mapping.getAttribute('maxRange'), 10);
                    return createMIDIMappingEditorFromRawParams(soundUUID, mappingUUID, ccNumber, name, minRange, maxRange);
                }

                function createMIDIMappingEditorFromRawParams(soundUUID, mappingUUID, ccNumber, parameterName, minRange, maxRange){
                    html = '<div id="' + mappingUUID + '" data-sound-id="' + soundUUID + '" class="midiMapping">';
                    html += 'CC number: <input id="' + mappingUUID + '_mappingCCNumber" value="' + ccNumber + '" type="number"><br>';
                    html += 'Parameter: <select class="select-css" id="' + mappingUUID + '_mappingParameterName">';
                    var availableParams = getMidiControllableParameterNames();
                    for (var i=0; i<availableParams.length; i++){
                        if (availableParams[i] != parameterName){
                            html += '<option value="' + availableParams[i] + '">&nbsp;&nbsp;' + availableParams[i] + '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</option>';
                        } else {
                            html += '<option value="' + availableParams[i] + '" selected>&nbsp;&nbsp;' + availableParams[i] + '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</option>';
                        }
                    }
                    html += '</select><br>';
                    html += '<input type="range" id="' + mappingUUID + '_mappingMinRange"  min="0" max="1.0" value="' + minRange + '" step="0.01"> min: <span id="' + mappingUUID + '_mappingMinRangeLabel"></span><br>';
                    html += '<input type="range" id="' + mappingUUID + '_mappingMaxRange"  min="0" max="1.0" value="' + maxRange + '" step="0.01"> max: <span id="' + mappingUUID + '_mappingMaxRangeLabel"></span><br>';
                    html += '<button onclick="ss.createUpdateMapping(\'' + soundUUID + '\',\'' + mappingUUID + '\')">save</button><button onclick="ss.removeMidiMapping(\'' + soundUUID + '\',\'' + mappingUUID + '\')">x</button>';
                    html += '</div>';
                    return html;
                }
                function updateSoundParameter(soundUUID, parameterName, parameterValue){
                    const sliderElement = document.getElementById(soundUUID + '_' + parameterName);
                    if (sliderElement === null){
                        return;
                    }
                    if (parameterValue === undefined){
                        var sound =  ss.getSoundFromSoundUUID(soundUUID);
                        parameterValue = sound.getAttribute(parameterName);
                    }
                    const parameterType = getParameterType(parameterName);
                    if (parameterType == "float"){
                        sliderElement.value = getProcessedSoundParameterValueExpToLin(sliderElement, parseFloat(parameterValue, 10));
                    } else if (parameterType == "int"){
                        sliderElement.value = parseInt(parameterValue, 10);
                    }
                    updateSliderLabel(sliderElement);
                }

                function updateMIDIMappingEditor(mappingUUID){
                    var mapping = ss.getMidiMappingStateFromMappingUUID(mappingUUID);
                    var ccNumber = parseInt(mapping.getAttribute('ccNumber'), 10);
                    var name = mapping.getAttribute('parameterName');
                    var minRange = parseFloat(mapping.getAttribute('minRange'), 10);
                    var maxRange = parseFloat(mapping.getAttribute('maxRange'), 10);

                    document.getElementById(mappingUUID + '_mappingCCNumber').value = ccNumber;
                    document.getElementById(mappingUUID + '_mappingParameterName').value = name;
                    document.getElementById(mappingUUID + '_mappingMinRange').value = minRange;
                    document.getElementById(mappingUUID + '_mappingMinRangeLabel').innerHTML = minRange;
                    document.getElementById(mappingUUID + '_mappingMaxRange').value = maxRange;
                    document.getElementById(mappingUUID + '_mappingMaxRangeLabel').innerHTML = maxRange;
                }


               function changeADSRElementId(obj){
                var currentMode = $('#outer-box-adsr #inner-box-launch p').text();
                var currentModeIndex = adsrModes.indexOf(currentMode.toLowerCase());
                var nextModeIndex = currentModeIndex;

                //Get the direction of arrow
                var direction = obj.className;
                var nextModeIndex = leftRightUpdate(direction, currentModeIndex,2);
                var progressColor = getComputedStyle(document.documentElement).getPropertyValue('--knob-progress-color');

                   if (nextModeIndex === 0){
                       $('#attack').attr("id","filterAttack");
                       $('#decay').attr("id","filterDecay");
                       $('#sustain').attr("id","filterSustain");
                       $('#release').attr("id", "filterRelease");
                       $('#gain').attr("id","filterCutoff");
                       $('#filterCutoff>p').text("cutoff");
                       $('#filterCutoff').trigger('configure', {
                        'min':10,
                        'max':20000,
                       });
                       $('.adsr-second-knob').empty();
                       $('.adsr-second-knob').append(`
                        <div class="knob-2000" id="filterCutoff">
                            <div class="knob-inner"></div>
                            <p style="margin-left:7.5px;">cutoff</p>
                        </div>
                        <div class="knob-1" id="filterRessonance">
                            <div class="knob-inner"></div>
                            <p style="margin-left:9px;">ressonance</p>
                        </div>
                            <div class="knob-100" id="filterADSR2CutoffAmt">
                                <div class="knob-inner"></div>
                                <p style="margin-left:8px;">cutoff amount</p>
                            </div>
                       `);

                     $("#filterCutoff").knob({
                        'min':10,
                        'max':20000,
                        'step':1,
                        'width':45,
                        'height':45,
                        'displayInput': true,
                        'thickness': 0.2,
                        'angleOffset':180,
                        'fgColor': progressColor,
                        'bgColor':'#dad9d9',
                        'change': function(v) {
                            ss.setSoundParameter(this['$'][0]['id'],v,0,1)
                        }
                    });
                    $("#filterRessonance").knob({
                        'min':0,
                        'max':1,
                        'step':0.01,
                        'width':45,
                        'height':45,
                        'displayInput': true,
                        'thickness': 0.2,
                        'angleOffset':180,
                        'fgColor': progressColor,
                        'bgColor':'#dad9d9',
                        'font': 'var(--font-default)',
                        'change': function(v) {
                            ss.setSoundParameter(this['$'][0]['id'],v,0,1);
                            if (adsrList.includes(this['$'][0]['id'])){
                                drawAdsrEnvelope();
                            }
                        }
                    });
                    $("#filterADSR2CutoffAmt").knob({
                        'min':0,
                        'max':100,
                        'step':0.01,
                        'width':45,
                        'height':45,
                        'displayInput': true,
                        'thickness': 0.2,
                        'angleOffset':180,
                        'fgColor': progressColor,
                        'bgColor':'#dad9d9',
                        'change': function(v) {
                            ss.setSoundParameter(this['$'][0]['id'],v,0,1);
                        }
                    });

                       updateFilterADSR();
                   }else{
                       $('#filterAttack').attr("id","attack");
                       $('#filterDecay').attr("id","decay");
                       $('#filterSustain').attr("id","sustain");
                       $('#filterRelease').attr("id", "release");
                       $('.adsr-second-knob').empty();
                       $('.adsr-second-knob').append(`
                        <div class="knob-2000" id="gain">
                            <div class="knob-inner"></div>
                            <p style="margin-left:7.5px;">gain</p>
                        </div>
                        <div class="knob-1" id="pan">
                            <div class="knob-inner"></div>
                            <p style="margin-left:9px;">pan</p>
                        </div>
                       `);
                       $("#gain").knob({
                        'min':-80,
                        'max':12,
                        'step':1,
                        'width':45,
                        'height':45,
                        'displayInput': true,
                        'thickness': 0.2,
                        'angleOffset':180,
                        'fgColor': progressColor,
                        'bgColor':'#dad9d9',
                        'change': function(v) {
                            ss.setSoundParameter(this['$'][0]['id'],v,0,1)
                        }
                    });
                    $("#pan").knob({
                        'min':-1,
                        'max':1,
                        'step':0.01,
                        'width':45,
                        'height':45,
                        'displayInput': true,
                        'thickness': 0.2,
                        'angleOffset':180,
                        'fgColor': progressColor,
                        'bgColor':'#dad9d9',
                        'font': 'var(--font-default)',
                        'change': function(v) {
                            ss.setSoundParameter(this['$'][0]['id'],v,0,1);
                            if (adsrList.includes(this['$'][0]['id'])){
                                drawAdsrEnvelope();
                            }
                        }
                    });
                    }
                    var newAdsrText = adsrModes[nextModeIndex];
                    $('#outer-box-adsr #inner-box-launch p').text(newAdsrText);

                       //Only update for ADSR elements should be added
                       updateAmplitudeADSR();
                   }

                function changeModulationVelocityID(obj){
                    var currentMode = $('#outer-box-modulation-velocity #inner-box-launch p').text();
                    var currentModeIndex = modVelocityModes.indexOf(currentMode.toLowerCase());
                    var nextModeIndex = currentModeIndex;

                    //Get the direction of arrow
                    var direction = obj.className;
                    var nextModeIndex = leftRightUpdate(direction, currentModeIndex,2);

                    var newText = modVelocityModes[nextModeIndex];
                    $('#outer-box-modulation-velocity #inner-box-launch p').text(newText);

                    var progressColor = getComputedStyle(document.documentElement).getPropertyValue('--knob-progress-color');

                    if (nextModeIndex === 1) {
                        $('.modulation-velocity-knob-area').empty();
                        $('.modulation-velocity-knob-area').append(`<div class="knob-100" id="vel2CutoffAmt">
                                                                    <div class="knob-inner"></div>
                                                                    <p style="margin-left:7px;">cutoff</p>
                                                                    </div>
                                                                    <div class="knob-1" id="vel2GainAmt">
                                                                        <div class="knob-inner"></div>
                                                                    <p style="margin-left:7px;">gain</p>
                                                                    </div>`);
                        $('#vel2CutoffAmt').knob({
                        'min':0,
                        'max':100,
                        'step':0.01,
                        'width':45,
                        'height':45,
                        'displayInput': true,
                        'thickness': 0.2,
                        'angleOffset':180,
                        'fgColor': progressColor,
                        'bgColor':'#dad9d9',
                        'change': function(v) {
                            ss.setSoundParameter(this['$'][0]['id'],v,0,1);
                        }
                    });
                    $('#vel2GainAmt').knob({
                        'min':0,
                        'max':1,
                        'step':0.01,
                        'width':45,
                        'height':45,
                        'displayInput': true,
                        'thickness': 0.2,
                        'angleOffset':180,
                        'fgColor': progressColor,
                        'bgColor':'#dad9d9',
                        'font': 'var(--font-default)',
                        'change': function(v) {
                            ss.setSoundParameter(this['$'][0]['id'],v,0,1);
                            if (adsrList.includes(this['$'][0]['id'])){
                                drawAdsrEnvelope();
                            }
                        }
                    });}
                    else{
                        $('.modulation-velocity-knob-area').empty();
                        $('.modulation-velocity-knob-area').append(`
                                                                    <div class="knob-12" id="mod2GainAmt">
                                                                        <div class="knob-inner"></div>
                                                                        <p style="margin-left:7.5px;">gain</p>
                                                                    </div>
                                                                    <div class="knob-100" id="mod2CutoffAmt">
                                                                        <div class="knob-inner"></div>
                                                                        <p style="margin-left:7.5px;">cutoff</p>
                                                                    </div>
                                                                    <div class="knob-12" id="mod2PitchAmt">
                                                                        <div class="knob-inner"></div>
                                                                        <p style="margin-left:7px;">pitch</p>
                                                                    </div>
                                                               `);
                        $('#mod2GainAmt').knob({
                        'min':-12,
                        'max':12,
                        'step':0.01,
                        'width':45,
                        'height':45,
                        'displayInput': true,
                        'thickness': 0.2,
                        'angleOffset':180,
                        'fgColor': progressColor,
                        'bgColor':'#dad9d9',
                        'change': function(v) {
                            ss.setSoundParameter(this['$'][0]['id'],v,0,1);
                        }
                    });
                        $('#mod2PitchAmt').knob({
                        'min':-12,
                        'max':12,
                        'step':0.01,
                        'width':45,
                        'height':45,
                        'displayInput': true,
                        'thickness': 0.2,
                        'angleOffset':180,
                        'fgColor': progressColor,
                        'bgColor':'#dad9d9',
                        'change': function(v) {
                            ss.setSoundParameter(this['$'][0]['id'],v,0,1);
                        }
                    });
                        $('#mod2CutoffAmt').knob({
                        'min':0,
                        'max':100,
                        'step':0.01,
                        'width':45,
                        'height':45,
                        'displayInput': true,
                        'thickness': 0.2,
                        'angleOffset':180,
                        'fgColor': progressColor,
                        'bgColor':'#dad9d9',
                        'change': function(v) {
                            ss.setSoundParameter(this['$'][0]['id'],v,0,1);
                        }
                    });
                    }}

               function changeNoteLayout(){
                    if ($('#noteLayout p').text() === 'contiguous'){
                        var newNoteLayout = 'interleaved';
                        var noteLayoutVal = 1;
                    }else {
                        var newNoteLayout = 'contiguous';
                        var noteLayoutVal = 0;
                    }
                    $('#noteLayout p').text(newNoteLayout);
                    ss.reapplyLayout(noteLayoutVal);
               }


                function updateMainPresetParameters(){
                    var sourceState = ss.state.getElementsByTagName('SOURCE_STATE')[0];
                    document.getElementsByName('presetIdx')[0].value = sourceState.getAttribute('currentPresetIndex');
                    document.getElementsByName('midiInChannel')[0].value = sourceState.getAttribute('globalMidiInChannel');

                    var presetState = sourceState.getElementsByTagName('PRESET')[0];
                    document.getElementsByName('presetName')[0].value = presetState.getAttribute('name');
                    document.getElementsByName('numVoices')[0].value = presetState.getAttribute('numVoices');

                }


                function leftRightUpdate(direction, currentModeIndex,n){
                    var nextModeIndex = null;
                    if (direction == 'left-arrow-inner'){
                            nextModeIndex = currentModeIndex - 1;
                            if (nextModeIndex < 0) {
                                nextModeIndex = 1;
                            }

                        }else{
                            nextModeIndex = currentModeIndex + 1;
                            if (nextModeIndex == n) {
                                nextModeIndex = 0;
                            }
                        }
                    return nextModeIndex;
                }

                function updateLaunchMode(obj) {
                    var currentMode = $("#outer-box-launch > #inner-box-launch > p").text();
                    var currentModeIndex = launchModes.indexOf(currentMode.toLowerCase());
                    var nextModeIndex = currentModeIndex;

                    //If it's not sound change but launch mode change
                    //Get the next launch mode
                    if (obj !== undefined){
                        //Get the direction of arrow
                        var direction = obj.className;
                        var nextModeIndex = leftRightUpdate(direction, currentModeIndex,3);
                        var newText = launchModes[nextModeIndex];
                        ss.setSoundParameterInt('launchMode', nextModeIndex);
                        $("#outer-box-launch > #inner-box-launch > p").text(newText);

                        var startP = ss.getSoundParameterValue(selectedSoundUUID,'startPosition');
                        var endP = ss.getSoundParameterValue(selectedSoundUUID,'endPosition');

                            //Load looper area if the launch mode is loop or loopfb
                            if (nextModeIndex > 0){
                                //If launch mode changes, stop all sounds
                                for (midiRoot of loopTriggerMidiOnOffSet.values()) {
                                    ss.sendMidiNoteOff(midiRoot);
                                    }
                                //Clear the set
                                loopTriggerMidiOnOffSet.clear();

                                wavesurfer.regions.clear();
                                //Get the duration to create fitting region
                                var soundLength = ss.getSoundDuration(selectedSoundUUID);
                                var regionStart = 0;
                                var regionEnd = soundLength/4;

                                if (startP !== 0 & endP !==1){
                                    var regionStart = startP*soundLength;
                                    var regionEnd = endP*soundLength;
                                }
                                wavesurfer.addRegion({
                                                start: regionStart,
                                                end: regionEnd,
                                                loop: false,
                                                color: 'hsla(240, 3%, 94%, 0.5)'
                                                    })
                            wavesurfer.on('region-updated', region =>{


                                //Set the start and end of the looped sound
                                ss.setSoundParameter('startPosition', region.start/soundLength,0,1);
                                ss.setSoundParameter('endPosition', region.end/soundLength,0,1);
                                ss.setSoundParameter('loopStartPosition', region.start/soundLength,0,1);
                                ss.setSoundParameter('loopEndPosition', region.end/soundLength,0,1);

                            })
                        }else {
                            wavesurfer.regions.clear();
                            $('select#sound-dropdown option').each(function(index,element){
                                var soundListUUID = $(element).data('uuid');
                                ss.setSoundParameter('startPosition', 0,0,1,resetMode=soundListUUID);
                                ss.setSoundParameter('endPosition', 1,0,1,resetMode=soundListUUID);
                                ss.setSoundParameter('loopStartPosition', 0,0,1,resetMode=soundListUUID);
                                ss.setSoundParameter('loopEndPosition', 1,0,1,resetMode=soundListUUID);

                            });                }
                    //If its sound change
                    }else {
                        ss.setSoundParameterInt('launchMode', nextModeIndex);
                        wavesurfer.regions.clear();
                        var startP = ss.getSoundParameterValue(selectedSoundUUID,'startPosition');
                        var endP = ss.getSoundParameterValue(selectedSoundUUID,'endPosition');

                            //Load looper area if the launch mode is loop or loopfb
                            if (nextModeIndex > 0){
                                //Get the duration to create fitting region
                                var soundLength = ss.getSoundDuration(selectedSoundUUID);
                                var regionStart = 0;
                                var regionEnd = soundLength/4;

                                if (startP !== 0 & endP !== 1){
                                    var regionStart = startP*soundLength;
                                    var regionEnd = endP*soundLength;
                                    console.log('new start and end ', endP, startP,regionStart, regionEnd);
                                }
                                wavesurfer.addRegion({
                                                start: regionStart,
                                                end: regionEnd,
                                                loop: false,
                                                color: 'hsla(400, 100%, 30%, 0.5)'
                                                    })
                                console.log(ss.getSoundParameterValue(selectedSoundUUID,'startPosition'),
                                ss.getSoundParameterValue(selectedSoundUUID,'endPosition'),
                                ss.getSoundParameterValue(selectedSoundUUID,'loopStartPosition'),
                                ss.getSoundParameterValue(selectedSoundUUID,'loopEndPosition'));
                            wavesurfer.on('region-updated', region =>{

                                //Set the start and end of the looped sound
                                ss.setSoundParameter('startPosition', region.start/soundLength,0,1);
                                ss.setSoundParameter('endPosition', region.end/soundLength,0,1);
                                ss.setSoundParameter('loopStartPosition', region.start/soundLength,0,1);
                                ss.setSoundParameter('loopEndPosition', region.end/soundLength,0,1);

                            })
                        }

                    }
            }

                function updateGateTriggerMode(obj){
                    var currentMode = $("#outer-box-keyboard > #inner-box-launch > p").text();
                    var currentModeIndex = gateTriggerModes.indexOf(currentMode.toLowerCase());
                    var nextModeIndex = currentModeIndex;

                    //Get the direction of arrow
                    var direction = obj.className;
                    if (direction == 'left-arrow-inner'){
                            nextModeIndex = currentModeIndex - 1;
                            if (nextModeIndex < 0) {
                                nextModeIndex = 1;
                            }

                        }else{
                            nextModeIndex = currentModeIndex + 1;
                            if (nextModeIndex == 2) {
                                nextModeIndex = 0;
                            }
                        }
                    var newText = gateTriggerModes[nextModeIndex];

                    //Stop sounds from previous mode
                    for (midiRoot of loopTriggerMidiOnOffSet.values()) {
                                  ss.sendMidiNoteOff(midiRoot);
                                  $('#'+midiRoot).removeClass('flash');
                                  }
                    for (midiRoot of midiOnOffList.values()) {
                                  ss.sendMidiNoteOff(midiRoot);
                                  }
                    $("#outer-box-keyboard > #inner-box-launch > p").text(newText);
                }

                function removeSoundFromList(){

                    //Stop the sound first
                    ss.stopSound(selectedSoundUUID);

                    var sound = ss.getSoundFromSoundUUID(selectedSoundUUID);
                    var samplerSounds = ss.getSoundSamplerSounds(sound);
                    var samplerSound = samplerSounds[0];
                    //Remove the sound from sound list
                    $("select#sound-dropdown option").filter(":contains('" + samplerSound.getAttribute('name')+"')").remove();

                    //Remove the sound from state
                    ss.removeSound(selectedSoundUUID);


                }
                function updateSoundList(soundUUID){
                    var sound = ss.getSoundFromSoundUUID(soundUUID);
                    console.log('updating sound list',soundUUID);

                    if (sound === null){
                        // Sound can be null if triggering this method in a delayed way and sound does not longer exist
                        return;
                    }
                    //Wait until the query is done
                    var samplerSounds = ss.getSoundSamplerSounds(sound);
                    var samplerSound = samplerSounds[0];
                    //If sound exists and loaded, don't add id
                            $("div.sound-list select").append($('<option>')
                                .text(samplerSound.getAttribute('name'))
                                .data({
                                    uuid: soundUUID,
                                    sound: samplerSound.getAttribute('name'),
                                })
                                );
                }


                function updateVolatileUI(){
                    // Update the audio meters and the voice allocation section
                    // Also update other things like query status


                    //Launch Mode Check
                    checkBox = document.getElementById('loopfb');

                    var VolatileState = ss.volatileState.getElementsByTagName('VOLATILE_STATE')[0];

                    var isQuerying = VolatileState.getAttribute('isQuerying') != "0";
                    var queryingIndicator = document.getElementById('query-indicator');
                    if (isQuerying){
                        queryingIndicator.classList.add('query-animation');

                    } else {
                        queryingIndicator.classList.remove('query-animation');
                    }

                }

               function drawSoundWaveform(){
                    var sound = ss.getSoundFromSoundUUID(selectedSoundUUID);
                    var samplerSound = ss.getSoundSamplerSounds(sound);
                    var sourceSamplerSoundUUID = samplerSound[0].getAttribute('uuid');

                    const canvas = document.getElementById("waveform");
                    if (canvas !== null){
                            if (httpPort !== undefined){
                                let url = 'http' + (useHttps ? 's':'') + '://' + hostname + ':' + httpPort + '/sounds_data/' + sourceSamplerSoundUUID + '.wav';
                                //let url = ss.getTmpFilesLocation() + '/' + sourceSamplerSoundUUID + '.wav'; // Not supported because of CORS...

                                //Remove the previous sounds wave element
                                $('wave').remove();
                                wavesurfer = WaveSurfer.create({
                                                            container: document.querySelector('#waveform'),
                                                            waveColor: wavesurferColor,
                                                            progressColor: 'transparent',
                                                            backend: 'MediaElement',
                                                            cursorWidth: 0,
                                                            responsive: 'true',
                                                            height: '100',
                                                            plugins: [ WaveSurfer.regions.create({}),
                                                            WaveSurfer.cursor.create({
                                                            showTime: true,
                                                            opacity: 1,
                                                            customShowTimeStyle: {
                                                                'background-color': '#000',
                                                                color: '#fff',
                                                                padding: '2px',
                                                                'font-size': '10px'
                                                            }
                                                        })

                                                            ]

                                                });
                            wavesurfer.load(url);
                    }
                }
            }



                function drawAdsrEnvelope(){

                var DefaultParamsMod = {
                    attackTime: ss.getSoundParameterValue(selectedSoundUUID, 'filterAttack'),
                    decayTime: ss.getSoundParameterValue(selectedSoundUUID, 'filterDecay'),
                    sustainLevel: ss.getSoundParameterValue(selectedSoundUUID, 'filterSustain'),
                    releaseTime: ss.getSoundParameterValue(selectedSoundUUID, 'filterRelease'),
                    gateTime: 1,
                    peakLevel: 1,
                    epsilon: 0.001,
                    attackCurve: "exp",
                    decayCurve: "exp",
                    releaseCurve: "exp",
                    };

                var DefaultParamsAmp = {
                    attackTime: ss.getSoundParameterValue(selectedSoundUUID, 'attack'),
                    decayTime: ss.getSoundParameterValue(selectedSoundUUID, 'decay'),
                    sustainLevel: ss.getSoundParameterValue(selectedSoundUUID, 'sustain'),
                    releaseTime: ss.getSoundParameterValue(selectedSoundUUID, 'release'),
                    gateTime: 1,
                    peakLevel: 1,
                    epsilon: 0.001,
                    attackCurve: "exp",
                    decayCurve: "exp",
                    releaseCurve: "exp",
                    };

                    //If the page has just loaded, operate on default parameter values
                    startTime = -1;

                    var env = new ADSREnvelope(DefaultParamsMod);
                    var ampEnv = new ADSREnvelope(DefaultParamsAmp);


                    var canvas = document.getElementById("adsr-envelope");
                    var context = canvas.getContext("2d");

                    var contextAmp = canvas.getContext("2d");
                    var x, i;

                    duration = (((env.duration / 5)|0) + 1) * 5;

                    context.fillStyle = adsrBackgroundColor;
                    context.fillRect(0, 0, canvas.width, canvas.height);

                    //Filter ADSR
                    context.strokeStyle = "#000000";
                    context.lineWidth = 0.8;

                    for (i = 1; i < duration; i++) {
                        x = (((i / duration) * canvas.width)|0) + 0.5;

                        context.beginPath();
                        context.moveTo(x, 0);
                        context.lineTo(x, canvas.height);
                        context.stroke();
                    }

                    //Amplitude ADSR
                    contextAmp.strokeStyle = newInnerBoxBorder;
                    contextAmp.lineWidth = 0.8;

                    for (i = 1; i < duration; i++) {
                        x = (((i / duration) * canvas.width)|0) + 0.5;

                        contextAmp.beginPath();
                        contextAmp.moveTo(x, 0);
                        contextAmp.lineTo(x, canvas.height);
                        contextAmp.stroke();
                    }

                    //Draw two envelopes for modulation and amplitude
                    drawByEnvelope(contextAmp, duration, ampEnv,1.4,"#5fb9b9a1", 'amp');
                    drawByEnvelope(context, duration, env,1.4, "rgba(118, 20, 148, 1)", 'modulation');


                    function drawByEnvelope(context, duration, env, lineWidth, strokeStyle, type) {
                    var t, v, y, x;
                    var i, imax;
                    var canvas = document.getElementById("adsr-envelope");


                    context.strokeStyle = strokeStyle;
                    context.lineWidth = lineWidth;
                    context.lineCap = "round";

                    context.beginPath();
                    for (i = 0, imax = canvas.width; i < imax; i++) {
                        t = (i / imax) * duration;
                        v = env.valueAt(t);
                        y = canvas.height - (canvas.height * v);
                        x = (i / imax) * canvas.width;

                        context.lineTo(x, y);
                    }
                    context.stroke();

                    }}


    (function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.ADSREnvelope = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
module.exports = require("./lib");

},{"./lib":9}],2:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _slicedToArray = (function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"]) _i["return"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError("Invalid attempt to destructure non-iterable instance"); } }; })();

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var _ADSRParams = require("./ADSRParams");

var _ADSRParams2 = _interopRequireDefault(_ADSRParams);

var ADSREnvelope = (function () {
  function ADSREnvelope(opts) {
    _classCallCheck(this, ADSREnvelope);

    this._ = new _ADSRParams2["default"](opts);
  }

  _createClass(ADSREnvelope, [{
    key: "valueAt",
    value: function valueAt() {
      var time = arguments.length <= 0 || arguments[0] === undefined ? 0 : arguments[0];

      return this._.valueAt(time);
    }
  }, {
    key: "applyTo",
    value: function applyTo(audioParam, playbackTime) {
      this.getWebAudioAPIMethods(playbackTime).forEach(function (_ref) {
        var _ref2 = _slicedToArray(_ref, 3);

        var method = _ref2[0];
        var value = _ref2[1];
        var time = _ref2[2];

        audioParam[method](value, time);
      });

      return this;
    }
  }, {
    key: "getWebAudioAPIMethods",
    value: function getWebAudioAPIMethods() {
      var playbackTime = arguments.length <= 0 || arguments[0] === undefined ? 0 : arguments[0];

      return this._.methods(playbackTime);
    }
  }, {
    key: "clone",
    value: function clone() {
      return new ADSREnvelope({
        attackTime: this._.attackTime,
        decayTime: this._.decayTime,
        sustainLevel: this._.sustainLevel,
        releaseTime: this._.releaseTime,
        gateTime: this._.gateTime,
        peakLevel: this._.peakLevel,
        epsilon: this._.epsilon,
        attackCurve: this._.attackCurve,
        decayCurve: this._.decayCurve,
        releaseCurve: this._.releaseCurve
      });
    }
  }, {
    key: "duration",
    set: function set(value) {
      this._.setDuration(value);
    },
    get: function get() {
      return this._.duration;
    }
  }, {
    key: "attackTime",
    set: function set(value) {
      this._.setAttackTime(value);
    },
    get: function get() {
      return this._.attackTime;
    }
  }, {
    key: "decayTime",
    set: function set(value) {
      this._.setDecayTime(value);
    },
    get: function get() {
      return this._.decayTime;
    }
  }, {
    key: "sustainTime",
    set: function set(value) {
      this._.setSustainTime(value);
    },
    get: function get() {
      return this._.sustainTime;
    }
  }, {
    key: "sustainLevel",
    set: function set(value) {
      this._.setSustainLevel(value);
    },
    get: function get() {
      return this._.sustainLevel;
    }
  }, {
    key: "releaseTime",
    set: function set(value) {
      this._.setReleaseTime(value);
    },
    get: function get() {
      return this._.releaseTime;
    }
  }, {
    key: "gateTime",
    set: function set(value) {
      this._.setGateTime(value);
    },
    get: function get() {
      return this._.gateTime;
    }
  }, {
    key: "peakLevel",
    set: function set(value) {
      this._.setPeakLevel(value);
    },
    get: function get() {
      return this._.peakLevel;
    }
  }, {
    key: "epsilon",
    set: function set(value) {
      this._.setEpsilon(value);
    },
    get: function get() {
      return this._.epsilon;
    }
  }, {
    key: "attackCurve",
    set: function set(value) {
      this._.setAttackCurve(value);
    },
    get: function get() {
      return this._.attackCurve;
    }
  }, {
    key: "decayCurve",
    set: function set(value) {
      this._.setDecayCurve(value);
    },
    get: function get() {
      return this._.decayCurve;
    }
  }, {
    key: "releaseCurve",
    set: function set(value) {
      this._.setReleaseCurve(value);
    },
    get: function get() {
      return this._.releaseCurve;
    }
  }]);

  return ADSREnvelope;
})();

exports["default"] = ADSREnvelope;
module.exports = exports["default"];
},{"./ADSRParams":3}],3:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _slicedToArray = (function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"]) _i["return"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError("Invalid attempt to destructure non-iterable instance"); } }; })();

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var _EnvelopeBuilder = require("./EnvelopeBuilder");

var _EnvelopeBuilder2 = _interopRequireDefault(_EnvelopeBuilder);

var _EnvelopeValue = require("./EnvelopeValue");

var _EnvelopeValue2 = _interopRequireDefault(_EnvelopeValue);

var _defaultValues = require("./defaultValues");

var _defaultValues2 = _interopRequireDefault(_defaultValues);

var _utilsDefaults = require("./utils/defaults");

var _utilsDefaults2 = _interopRequireDefault(_utilsDefaults);

var _utilsConstrain = require("./utils/constrain");

var _utilsConstrain2 = _interopRequireDefault(_utilsConstrain);

var _utilsIsFiniteNumber = require("./utils/isFiniteNumber");

var _utilsIsFiniteNumber2 = _interopRequireDefault(_utilsIsFiniteNumber);

var _constants = require("./constants");

var EPSILON = 2.220446049250313e-16;

var ADSRParams = (function () {
  function ADSRParams() {
    var opts = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

    _classCallCheck(this, ADSRParams);

    this.attackTime = time((0, _utilsDefaults2["default"])(opts.attackTime, _defaultValues2["default"].attackTime));
    this.decayTime = time((0, _utilsDefaults2["default"])(opts.decayTime, _defaultValues2["default"].decayTime));
    this.sustainLevel = level((0, _utilsDefaults2["default"])(opts.sustainLevel, _defaultValues2["default"].sustainLevel));
    this.releaseTime = time((0, _utilsDefaults2["default"])(opts.releaseTime, _defaultValues2["default"].releaseTime));
    this.peakLevel = time((0, _utilsDefaults2["default"])(opts.peakLevel, _defaultValues2["default"].peakLevel));
    this.epsilon = epsilon((0, _utilsDefaults2["default"])(opts.epsilon, _defaultValues2["default"].epsilon));
    this.attackCurve = curve((0, _utilsDefaults2["default"])(opts.attackCurve, _defaultValues2["default"].attackCurve));
    this.decayCurve = curve((0, _utilsDefaults2["default"])(opts.decayCurve, _defaultValues2["default"].decayCurve));
    this.releaseCurve = curve((0, _utilsDefaults2["default"])(opts.releaseCurve, _defaultValues2["default"].releaseCurve));
    this.gateTime = _defaultValues2["default"].gateTime;

    if ((0, _utilsIsFiniteNumber2["default"])(opts.sustainTime)) {
      this.setSustainTime(opts.sustainTime);
    }
    if ((0, _utilsIsFiniteNumber2["default"])(opts.gateTime)) {
      this.setGateTime(opts.gateTime);
    }
    if ((0, _utilsIsFiniteNumber2["default"])(opts.duration)) {
      this.setDuration(opts.duration);
    }

    this.update();
  }

  _createClass(ADSRParams, [{
    key: "valueAt",
    value: function valueAt(time) {
      return _EnvelopeValue2["default"].at(this.envelope, time);
    }
  }, {
    key: "methods",
    value: function methods(playbackTime) {
      return this.envelope.map(function (_ref) {
        var _ref2 = _slicedToArray(_ref, 3);

        var type = _ref2[0];
        var value = _ref2[1];
        var time = _ref2[2];

        return [method(type), value, playbackTime + time];
      });
    }
  }, {
    key: "setDuration",
    value: function setDuration(value) {
      var duration = time(value);

      this.setGateTime(duration - this.releaseTime);
    }
  }, {
    key: "setAttackTime",
    value: function setAttackTime(value) {
      this.attackTime = time(value);
      this.update();
    }
  }, {
    key: "setDecayTime",
    value: function setDecayTime(value) {
      this.decayTime = time(value);
      this.update();
    }
  }, {
    key: "setSustainTime",
    value: function setSustainTime(value) {
      var sustainTime = time(value);

      this.setGateTime(this.attackTime + this.decayTime + sustainTime);
    }
  }, {
    key: "setSustainLevel",
    value: function setSustainLevel(value) {
      this.sustainLevel = level(value);
      this.update();
    }
  }, {
    key: "setReleaseTime",
    value: function setReleaseTime(value) {
      this.releaseTime = time(value);
      this.update();
    }
  }, {
    key: "setGateTime",
    value: function setGateTime(value) {
      this.gateTime = time(value);
      this.update();
    }
  }, {
    key: "setPeakLevel",
    value: function setPeakLevel(value) {
      this.peakLevel = time(value);
      this.update();
    }
  }, {
    key: "setEpsilon",
    value: function setEpsilon(value) {
      this.epsilon = epsilon(value);
      this.update();
    }
  }, {
    key: "setAttackCurve",
    value: function setAttackCurve(value) {
      this.attackCurve = curve(value);
      this.update();
    }
  }, {
    key: "setDecayCurve",
    value: function setDecayCurve(value) {
      this.decayCurve = curve(value);
      this.update();
    }
  }, {
    key: "setReleaseCurve",
    value: function setReleaseCurve(value) {
      this.releaseCurve = curve(value);
      this.update();
    }
  }, {
    key: "update",
    value: function update() {
      this.sustainTime = Math.max(0, this.gateTime - this.attackTime - this.decayTime);
      this.duration = this.gateTime + this.releaseTime;
      this.envelope = _EnvelopeBuilder2["default"].build(this);
    }
  }]);

  return ADSRParams;
})();

exports["default"] = ADSRParams;

function time(value) {
  return Math.max(0, value) || 0;
}

function level(value) {
  return (0, _utilsConstrain2["default"])(+value, 0, 1) || 0;
}

function epsilon(value) {
  return (0, _utilsConstrain2["default"])(+value, EPSILON, 1e-2) || 1e-3;
}

function curve(type) {
  return type === "exp" ? "exp" : "lin";
}

function method(type) {
  switch (type) {
    case _constants.SET:
      return "setValueAtTime";
    case _constants.LIN:
      return "linearRampToValueAtTime";
    case _constants.EXP:
      return "exponentialRampToValueAtTime";
    default:
    // do nothing
  }
}
module.exports = exports["default"];
},{"./EnvelopeBuilder":4,"./EnvelopeValue":6,"./constants":7,"./defaultValues":8,"./utils/constrain":10,"./utils/defaults":11,"./utils/isFiniteNumber":12}],4:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

var _EnvelopeReducer = require("./EnvelopeReducer");

var _EnvelopeReducer2 = _interopRequireDefault(_EnvelopeReducer);

var _utilsLinlin = require("./utils/linlin");

var _utilsLinlin2 = _interopRequireDefault(_utilsLinlin);

var _utilsLinexp = require("./utils/linexp");

var _utilsLinexp2 = _interopRequireDefault(_utilsLinexp);

var _constants = require("./constants");

function build(params) {
  var envelope = buildEnvelope(params);

  envelope = _EnvelopeReducer2["default"].reduce(envelope);

  return envelope;
}

function getCurveItems(curveType, epsilon) {
  if (curveType === "exp") {
    return { zero: epsilon, calc: _utilsLinexp2["default"], type: _constants.EXP };
  }
  return { zero: 0, calc: _utilsLinlin2["default"], type: _constants.LIN };
}

function buildEnvelope(params) {
  var attackTime = params.attackTime;
  var decayTime = params.decayTime;
  var gateTime = params.gateTime;
  var releaseTime = params.releaseTime;

  var envType = 0;

  envType += 0 < attackTime ? 4 : 0;
  envType += 0 < decayTime ? 2 : 0;
  envType += 0 < releaseTime ? 1 : 0;

  switch (envType) {
    case 0:
      return buildSustainEnvelope(params);
    case 1:
      return buildSustainReleaseEnvelope(params);
    case 2:
      if (gateTime <= decayTime) {
        return buildDecayEnvelope(params);
      }
      return buildDecaySustainEnvelope(params);
    case 3:
      if (gateTime <= decayTime) {
        return buildDecayReleaseEnvelope(params);
      }
      return buildDecaySustainReleaseEnvelope(params);
    case 4:
      if (gateTime <= attackTime) {
        return buildAttackEnvelope(params);
      }
      return buildAttackSustainEnvelope(params);
    case 5:
      if (gateTime <= attackTime) {
        return buildAttackReleaseEnvelope(params);
      }
      return buildAttackSustainReleaseEnvelope(params);
    case 6:
      if (gateTime <= attackTime) {
        return buildAttackEnvelope(params);
      }
      if (gateTime <= attackTime + decayTime) {
        return buildAttackDecayEnvelope(params);
      }
      return buildAttackDecaySustainEnvelope(params);
    case 7:
      if (gateTime <= attackTime) {
        return buildAttackReleaseEnvelope(params);
      }
      if (gateTime <= attackTime + decayTime) {
        return buildAttackDecayReleaseEnvelope(params);
      }
      return buildAttackDecaySustainReleaseEnvelope(params);
    default:
    // do nothing
  }
}

function buildSustainEnvelope(params) {
  //
  //
  // ----------*
  //           |
  //           +---------
  // 0         12
  //
  var result = [];
  var t0 = 0;
  var t1 = params.gateTime;
  var t2 = params.gateTime;
  var v0 = params.sustainLevel * params.peakLevel;
  var v1 = params.sustainLevel * params.peakLevel;
  var v2 = 0;

  result.push([_constants.SET, v0, t0]);
  result.push([_constants.SET, v1, t1]);
  result.push([_constants.SET, v2, t2]);

  return result;
}

function buildSustainReleaseEnvelope(params) {
  //
  //
  // ----------*
  //            \
  //             +-------
  // 0         1 2
  var result = [];
  var r = getCurveItems(params.releaseCurve, params.epsilon);
  var t0 = 0;
  var t1 = params.gateTime;
  var t2 = params.gateTime + params.releaseTime;
  var v0 = Math.max(r.zero, params.sustainLevel * params.peakLevel);
  var v1 = Math.max(r.zero, params.sustainLevel * params.peakLevel);
  var v2 = r.zero;

  result.push([_constants.SET, v0, t0]);
  result.push([_constants.SET, v1, t1]);
  result.push([r.type, v2, t2]);

  return result;
}

function buildDecaySustainEnvelope(params) {
  // +
  //  \
  //   +-------*
  //           |
  //           +---------
  // 0 1       23
  var result = [];
  var d = getCurveItems(params.decayCurve, params.epsilon);
  var t0 = 0;
  var t1 = params.decayTime;
  var t2 = params.gateTime;
  var t3 = params.gateTime;
  var v0 = Math.max(d.zero, params.peakLevel);
  var v1 = Math.max(d.zero, params.sustainLevel * params.peakLevel);
  var v2 = Math.max(d.zero, params.sustainLevel * params.peakLevel);
  var v3 = 0;

  result.push([_constants.SET, v0, t0]);
  result.push([d.type, v1, t1]);
  result.push([_constants.SET, v2, t2]);
  result.push([_constants.SET, v3, t3]);

  return result;
}

function buildDecayEnvelope(params) {
  // +
  //  \
  //   *
  //   |
  //   +-----------------
  // 0 12
  var result = [];
  var d = getCurveItems(params.decayCurve, params.epsilon);
  var t0 = 0;
  var t1 = params.gateTime;
  var t2 = params.gateTime;
  var v0 = Math.max(d.zero, params.peakLevel);
  var vx = Math.max(d.zero, params.sustainLevel * params.peakLevel);
  var v1 = d.calc(t1, 0, params.decayTime, v0, vx);
  var v2 = 0;

  result.push([_constants.SET, v0, t0]);
  result.push([d.type, v1, t1]);
  result.push([_constants.SET, v2, t2]);

  return result;
}

function buildDecaySustainReleaseEnvelope(params) {
  // +
  //  \
  //   +-------*
  //            \
  //             +-------
  // 0 1       2 3
  var result = [];
  var d = getCurveItems(params.decayCurve, params.epsilon);
  var r = getCurveItems(params.releaseCurve, params.epsilon);
  var t0 = 0;
  var t1 = params.decayTime;
  var t2 = params.gateTime;
  var t3 = params.gateTime + params.releaseTime;
  var v0 = Math.max(d.zero, r.zero, params.peakLevel);
  var v1 = Math.max(d.zero, r.zero, params.sustainLevel * params.peakLevel);
  var v2 = Math.max(d.zero, r.zero, params.sustainLevel * params.peakLevel);
  var v3 = r.zero;

  result.push([_constants.SET, v0, t0]);
  result.push([d.type, v1, t1]);
  result.push([_constants.SET, v2, t2]);
  result.push([r.type, v3, t3]);

  return result;
}

function buildDecayReleaseEnvelope(params) {
  // +
  //  \
  //   *
  //    \
  //     +---------------
  // 0 1 2
  var result = [];
  var d = getCurveItems(params.decayCurve, params.epsilon);
  var r = getCurveItems(params.releaseCurve, params.epsilon);
  var t0 = 0;
  var t1 = params.gateTime;
  var t2 = params.gateTime + params.releaseTime;
  var v0 = Math.max(d.zero, r.zero, params.peakLevel);
  var vx = Math.max(d.zero, r.zero, params.sustainLevel * params.peakLevel);
  var v1 = d.calc(t1, 0, params.decayTime, v0, vx);
  var v2 = Math.max(d.zero, r.zero);

  result.push([_constants.SET, v0, t0]);
  result.push([d.type, v1, t1]);
  result.push([r.type, v2, t2]);

  return result;
}

function buildAttackSustainEnvelope(params) {
  //     +
  //    /|
  //   / +-----*
  //  /        |
  // +         +---------
  // 0   12    34
  var result = [];
  var a = getCurveItems(params.attackCurve, params.epsilon);
  var t0 = 0;
  var t1 = params.attackTime;
  var t2 = params.attackTime;
  var t3 = params.gateTime;
  var t4 = params.gateTime;
  var v0 = a.zero;
  var v1 = Math.max(a.zero, params.peakLevel);
  var v2 = params.sustainLevel * params.peakLevel;
  var v3 = params.sustainLevel * params.peakLevel;
  var v4 = 0;

  result.push([_constants.SET, v0, t0]);
  result.push([a.type, v1, t1]);
  result.push([_constants.SET, v2, t2]);
  result.push([_constants.SET, v3, t3]);
  result.push([_constants.SET, v4, t4]);

  return result;
}

function buildAttackEnvelope(params) {
  //
  //
  //   *
  //  /|
  // + +-----------------
  // 0 12
  var result = [];
  var a = getCurveItems(params.attackCurve, params.epsilon);
  var t0 = 0;
  var t1 = params.gateTime;
  var t2 = params.gateTime;
  var v0 = a.zero;
  var vx = Math.max(a.zero, params.peakLevel);
  var v1 = a.calc(t1, 0, params.attackTime, v0, vx);
  var v2 = 0;

  result.push([_constants.SET, v0, t0]);
  result.push([a.type, v1, t1]);
  result.push([_constants.SET, v2, t2]);

  return result;
}

function buildAttackSustainReleaseEnvelope(params) {
  //     +
  //    /|
  //   / +-----*
  //  /         \
  // +           +-------
  // 0   12    3 4
  var result = [];
  var a = getCurveItems(params.attackCurve, params.epsilon);
  var r = getCurveItems(params.releaseCurve, params.epsilon);
  var t0 = 0;
  var t1 = params.attackTime;
  var t2 = params.attackTime;
  var t3 = params.gateTime;
  var t4 = params.gateTime + params.releaseTime;
  var v0 = a.zero;
  var v1 = Math.max(a.zero, params.peakLevel);
  var v2 = Math.max(r.zero, params.sustainLevel * params.peakLevel);
  var v3 = Math.max(r.zero, params.sustainLevel * params.peakLevel);
  var v4 = r.zero;

  result.push([_constants.SET, v0, t0]);
  result.push([a.type, v1, t1]);
  result.push([_constants.SET, v2, t2]);
  result.push([_constants.SET, v3, t3]);
  result.push([r.type, v4, t4]);

  return result;
}

function buildAttackReleaseEnvelope(params) {
  //
  //
  //   *
  //  / \
  // +   +---------------
  // 0 1 2
  var result = [];
  var a = getCurveItems(params.attackCurve, params.epsilon);
  var r = getCurveItems(params.releaseCurve, params.epsilon);
  var t0 = 0;
  var t1 = params.gateTime;
  var t2 = params.gateTime + params.releaseTime;
  var v0 = a.zero;
  var vx = Math.max(a.zero, params.peakLevel);
  var v1 = a.calc(t1, 0, params.attackTime, v0, vx);
  var v2 = r.zero;

  result.push([_constants.SET, v0, t0]);
  result.push([a.type, v1, t1]);
  result.push([r.type, v2, t2]);

  return result;
}

function buildAttackDecaySustainEnvelope(params) {
  //     +
  //    / \
  //   /   +---*
  //  /        |
  // +         +---------
  // 0   1 2   34
  var result = [];
  var a = getCurveItems(params.attackCurve, params.epsilon);
  var d = getCurveItems(params.decayCurve, params.epsilon);
  var t0 = 0;
  var t1 = params.attackTime;
  var t2 = params.attackTime + params.decayTime;
  var t3 = params.gateTime;
  var t4 = params.gateTime;
  var v0 = a.zero;
  var v1 = Math.max(a.zero, d.zero, params.peakLevel);
  var v2 = Math.max(d.zero, params.sustainLevel * params.peakLevel);
  var v3 = Math.max(d.zero, params.sustainLevel * params.peakLevel);
  var v4 = 0;

  result.push([_constants.SET, v0, t0]);
  result.push([a.type, v1, t1]);
  result.push([d.type, v2, t2]);
  result.push([_constants.SET, v3, t3]);
  result.push([_constants.SET, v4, t4]);

  return result;
}

function buildAttackDecayEnvelope(params) {
  //     +
  //    / \
  //   /   *
  //  /    |
  // +     +-------------
  // 0   1 23
  var result = [];
  var a = getCurveItems(params.attackCurve, params.epsilon);
  var d = getCurveItems(params.decayCurve, params.epsilon);
  var t0 = 0;
  var t1 = params.attackTime;
  var t2 = params.gateTime;
  var t3 = params.gateTime;
  var v0 = a.zero;
  var v1 = Math.max(a.zero, d.zero, params.peakLevel);
  var vx = Math.max(d.zero, params.sustainLevel * params.peakLevel);
  var v2 = d.calc(t2, params.attackTime, params.attackTime + params.decayTime, v1, vx);
  var v3 = 0;

  result.push([_constants.SET, v0, t0]);
  result.push([a.type, v1, t1]);
  result.push([d.type, v2, t2]);
  result.push([_constants.SET, v3, t3]);

  return result;
}

function buildAttackDecaySustainReleaseEnvelope(params) {
  //     +
  //    / \
  //   /   +---*
  //  /         \
  // +           +-------
  // 0   1 2   3 4
  var result = [];
  var a = getCurveItems(params.attackCurve, params.epsilon);
  var d = getCurveItems(params.decayCurve, params.epsilon);
  var r = getCurveItems(params.releaseCurve, params.epsilon);
  var t0 = 0;
  var t1 = params.attackTime;
  var t2 = params.attackTime + params.decayTime;
  var t3 = params.gateTime;
  var t4 = params.gateTime + params.releaseTime;
  var v0 = a.zero;
  var v1 = Math.max(a.zero, d.zero, params.peakLevel);
  var v2 = Math.max(d.zero, r.zero, params.sustainLevel * params.peakLevel);
  var v3 = Math.max(d.zero, r.zero, params.sustainLevel * params.peakLevel);
  var v4 = Math.max(d.zero, r.zero);

  result.push([_constants.SET, v0, t0]);
  result.push([a.type, v1, t1]);
  result.push([d.type, v2, t2]);
  result.push([_constants.SET, v3, t3]);
  result.push([r.type, v4, t4]);

  return result;
}

function buildAttackDecayReleaseEnvelope(params) {
  //     +
  //    / \
  //   /   *
  //  /     \
  // +       +-----------
  // 0   1 2 3
  var result = [];
  var a = getCurveItems(params.attackCurve, params.epsilon);
  var d = getCurveItems(params.decayCurve, params.epsilon);
  var r = getCurveItems(params.releaseCurve, params.epsilon);
  var t0 = 0;
  var t1 = params.attackTime;
  var t2 = params.gateTime;
  var t3 = params.gateTime + params.releaseTime;
  var v0 = a.zero;
  var v1 = Math.max(a.zero, d.zero, params.peakLevel);
  var vx = Math.max(d.zero, params.sustainLevel * params.peakLevel);
  var v2 = d.calc(t2, params.attackTime, params.attackTime + params.decayTime, v1, vx);
  var v3 = Math.max(d.zero, r.zero);

  result.push([_constants.SET, v0, t0]);
  result.push([a.type, v1, t1]);
  result.push([d.type, v2, t2]);
  result.push([r.type, v3, t3]);

  return result;
}

exports["default"] = { build: build };
module.exports = exports["default"];
},{"./EnvelopeReducer":5,"./constants":7,"./utils/linexp":13,"./utils/linlin":14}],5:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _constants = require("./constants");

function reduce(envelope) {
  envelope = envelope.filter(function (items) {
    return isFinite(items[_constants.TIME]);
  });

  var changed = undefined;

  do {
    changed = false;

    if (2 <= envelope.length) {
      var a = envelope[envelope.length - 2];
      var b = envelope[envelope.length - 1];

      if (a[_constants.VALUE] === b[_constants.VALUE]) {
        envelope.pop();
      }
    }

    for (var i = envelope.length - 2; i >= 0; i--) {
      var a = envelope[i];
      var b = envelope[i + 1];

      if (a[_constants.TYPE] === _constants.SET) {
        if (b[_constants.TYPE] !== _constants.SET) {
          if (a[_constants.VALUE] === b[_constants.VALUE] || a[_constants.TIME] === b[_constants.TIME]) {
            b[_constants.TYPE] = _constants.SET;
            changed = true;
          }
        } else if (a[_constants.TIME] === b[_constants.TIME]) {
          envelope.splice(i, 1);
          changed = true;
        }
      }
    }
  } while (changed && envelope.length);

  return envelope;
}

exports["default"] = { reduce: reduce };
module.exports = exports["default"];
},{"./constants":7}],6:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

var _utilsLinlin = require("./utils/linlin");

var _utilsLinlin2 = _interopRequireDefault(_utilsLinlin);

var _utilsLinexp = require("./utils/linexp");

var _utilsLinexp2 = _interopRequireDefault(_utilsLinexp);

var _constants = require("./constants");

function at(envelope, time) {
  for (var i = 0, imax = envelope.length - 1; i < imax; i++) {
    var e0 = envelope[i];
    var e1 = envelope[i + 1];

    if (e0[_constants.TIME] <= time && time < e1[_constants.TIME]) {
      switch (e1[_constants.TYPE]) {
        case _constants.LIN:
          return (0, _utilsLinlin2["default"])(time, e0[_constants.TIME], e1[_constants.TIME], e0[_constants.VALUE], e1[_constants.VALUE]);
        case _constants.EXP:
          return (0, _utilsLinexp2["default"])(time, e0[_constants.TIME], e1[_constants.TIME], e0[_constants.VALUE], e1[_constants.VALUE]);
        default:
          return e0[_constants.VALUE];
      }
    }
  }

  return envelope.length ? envelope[envelope.length - 1][_constants.VALUE] : 0;
}

exports["default"] = { at: at };
module.exports = exports["default"];
},{"./constants":7,"./utils/linexp":13,"./utils/linlin":14}],7:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
var SET = 0;
exports.SET = SET;
var LIN = 1;
exports.LIN = LIN;
var EXP = 2;

exports.EXP = EXP;
var TYPE = 0;
exports.TYPE = TYPE;
var VALUE = 1;
exports.VALUE = VALUE;
var TIME = 2;
exports.TIME = TIME;
},{}],8:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = {
  attackTime: 0.01,
  decayTime: 0.3,
  sustainLevel: 0.5,
  releaseTime: 1,
  gateTime: Infinity,
  peakLevel: 1,
  epsilon: 1e-3,
  attackCurve: "lin",
  decayCurve: "lin",
  releaseCurve: "lin"
};
module.exports = exports["default"];
},{}],9:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

var _ADSREnvelope = require("./ADSREnvelope");

var _ADSREnvelope2 = _interopRequireDefault(_ADSREnvelope);

exports["default"] = _ADSREnvelope2["default"];
module.exports = exports["default"];
},{"./ADSREnvelope":2}],10:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = constrain;

function constrain(value, minValue, maxValue) {
  return Math.max(minValue, Math.min(value, maxValue));
}

module.exports = exports["default"];
},{}],11:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = defaults;

function defaults(value, defaultValue) {
  return typeof value !== "undefined" ? value : defaultValue;
}

module.exports = exports["default"];
},{}],12:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = isFiniteNumber;

function isFiniteNumber(value) {
  return typeof value === "number" && isFinite(value);
}

module.exports = exports["default"];
},{}],13:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = linexp;

function linexp(value, inMin, inMax, outMin, outMax) {
  return Math.pow(outMax / outMin, (value - inMin) / (inMax - inMin)) * outMin;
}

module.exports = exports["default"];
},{}],14:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = linlin;

function linlin(value, inMin, inMax, outMin, outMax) {
  return (value - inMin) / (inMax - inMin) * (outMax - outMin) + outMin;
}

module.exports = exports["default"];
},{}]},{},[1])(1)
});(function(factory) {
    if (typeof define === "function" && define.amd) {
      // AMD. Register as an anonymous module.
      define([], factory);
    } else if (typeof exports === "object") {
      // Node/CommonJS
      module.exports = factory();
    } else {
      // Browser globals
      window.wNumb = factory();
    }
  })(function() {
    "use strict";

    var FormatOptions = [
      "decimals",
      "thousand",
      "mark",
      "prefix",
      "suffix",
      "encoder",
      "decoder",
      "negativeBefore",
      "negative",
      "edit",
      "undo"
    ];

    // General

    // Reverse a string
    function strReverse(a) {
      return a
        .split("")
        .reverse()
        .join("");
    }

    // Check if a string starts with a specified prefix.
    function strStartsWith(input, match) {
      return input.substring(0, match.length) === match;
    }

    // Check is a string ends in a specified suffix.
    function strEndsWith(input, match) {
      return input.slice(-1 * match.length) === match;
    }

    // Throw an error if formatting options are incompatible.
    function throwEqualError(F, a, b) {
      if ((F[a] || F[b]) && F[a] === F[b]) {
        throw new Error(a);
      }
    }

    // Check if a number is finite and not NaN
    function isValidNumber(input) {
      return typeof input === "number" && isFinite(input);
    }

    // Provide rounding-accurate toFixed method.
    // Borrowed: http://stackoverflow.com/a/21323330/775265
    function toFixed(value, exp) {
      value = value.toString().split("e");
      value = Math.round(+(value[0] + "e" + (value[1] ? +value[1] + exp : exp)));
      value = value.toString().split("e");
      return (+(value[0] + "e" + (value[1] ? +value[1] - exp : -exp))).toFixed(exp);
    }

    // Formatting

    // Accept a number as input, output formatted string.
    function formatTo(
      decimals,
      thousand,
      mark,
      prefix,
      suffix,
      encoder,
      decoder,
      negativeBefore,
      negative,
      edit,
      undo,
      input
    ) {
      var originalInput = input,
        inputIsNegative,
        inputPieces,
        inputBase,
        inputDecimals = "",
        output = "";

      // Apply user encoder to the input.
      // Expected outcome: number.
      if (encoder) {
        input = encoder(input);
      }

      // Stop if no valid number was provided, the number is infinite or NaN.
      if (!isValidNumber(input)) {
        return false;
      }

      // Rounding away decimals might cause a value of -0
      // when using very small ranges. Remove those cases.
      if (decimals !== false && parseFloat(input.toFixed(decimals)) === 0) {
        input = 0;
      }

      // Formatting is done on absolute numbers,
      // decorated by an optional negative symbol.
      if (input < 0) {
        inputIsNegative = true;
        input = Math.abs(input);
      }

      // Reduce the number of decimals to the specified option.
      if (decimals !== false) {
        input = toFixed(input, decimals);
      }

      // Transform the number into a string, so it can be split.
      input = input.toString();

      // Break the number on the decimal separator.
      if (input.indexOf(".") !== -1) {
        inputPieces = input.split(".");

        inputBase = inputPieces[0];

        if (mark) {
          inputDecimals = mark + inputPieces[1];
        }
      } else {
        // If it isn't split, the entire number will do.
        inputBase = input;
      }

      // Group numbers in sets of three.
      if (thousand) {
        inputBase = strReverse(inputBase).match(/.{1,3}/g);
        inputBase = strReverse(inputBase.join(strReverse(thousand)));
      }

      // If the number is negative, prefix with negation symbol.
      if (inputIsNegative && negativeBefore) {
        output += negativeBefore;
      }

      // Prefix the number
      if (prefix) {
        output += prefix;
      }

      // Normal negative option comes after the prefix. Defaults to '-'.
      if (inputIsNegative && negative) {
        output += negative;
      }

      // Append the actual number.
      output += inputBase;
      output += inputDecimals;

      // Apply the suffix.
      if (suffix) {
        output += suffix;
      }

      // Run the output through a user-specified post-formatter.
      if (edit) {
        output = edit(output, originalInput);
      }

      // All done.
      return output;
    }

    // Accept a sting as input, output decoded number.
    function formatFrom(
      decimals,
      thousand,
      mark,
      prefix,
      suffix,
      encoder,
      decoder,
      negativeBefore,
      negative,
      edit,
      undo,
      input
    ) {
      var originalInput = input,
        inputIsNegative,
        output = "";

      // User defined pre-decoder. Result must be a non empty string.
      if (undo) {
        input = undo(input);
      }

      // Test the input. Can't be empty.
      if (!input || typeof input !== "string") {
        return false;
      }

      // If the string starts with the negativeBefore value: remove it.
      // Remember is was there, the number is negative.
      if (negativeBefore && strStartsWith(input, negativeBefore)) {
        input = input.replace(negativeBefore, "");
        inputIsNegative = true;
      }

      // Repeat the same procedure for the prefix.
      if (prefix && strStartsWith(input, prefix)) {
        input = input.replace(prefix, "");
      }

      // And again for negative.
      if (negative && strStartsWith(input, negative)) {
        input = input.replace(negative, "");
        inputIsNegative = true;
      }

      // Remove the suffix.
      // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/slice
      if (suffix && strEndsWith(input, suffix)) {
        input = input.slice(0, -1 * suffix.length);
      }

      // Remove the thousand grouping.
      if (thousand) {
        input = input.split(thousand).join("");
      }

      // Set the decimal separator back to period.
      if (mark) {
        input = input.replace(mark, ".");
      }

      // Prepend the negative symbol.
      if (inputIsNegative) {
        output += "-";
      }

      // Add the number
      output += input;

      // Trim all non-numeric characters (allow '.' and '-');
      output = output.replace(/[^0-9\.\-.]/g, "");

      // The value contains no parse-able number.
      if (output === "") {
        return false;
      }

      // Covert to number.
      output = Number(output);

      // Run the user-specified post-decoder.
      if (decoder) {
        output = decoder(output);
      }

      // Check is the output is valid, otherwise: return false.
      if (!isValidNumber(output)) {
        return false;
      }

      return output;
    }

    // Framework

    // Validate formatting options
    function validate(inputOptions) {
      var i,
        optionName,
        optionValue,
        filteredOptions = {};

      if (inputOptions["suffix"] === undefined) {
        inputOptions["suffix"] = inputOptions["postfix"];
      }

      for (i = 0; i < FormatOptions.length; i += 1) {
        optionName = FormatOptions[i];
        optionValue = inputOptions[optionName];

        if (optionValue === undefined) {
          // Only default if negativeBefore isn't set.
          if (optionName === "negative" && !filteredOptions.negativeBefore) {
            filteredOptions[optionName] = "-";
            // Don't set a default for mark when 'thousand' is set.
          } else if (optionName === "mark" && filteredOptions.thousand !== ".") {
            filteredOptions[optionName] = ".";
          } else {
            filteredOptions[optionName] = false;
          }

          // Floating points in JS are stable up to 7 decimals.
        } else if (optionName === "decimals") {
          if (optionValue >= 0 && optionValue < 8) {
            filteredOptions[optionName] = optionValue;
          } else {
            throw new Error(optionName);
          }

          // These options, when provided, must be functions.
        } else if (
          optionName === "encoder" ||
          optionName === "decoder" ||
          optionName === "edit" ||
          optionName === "undo"
        ) {
          if (typeof optionValue === "function") {
            filteredOptions[optionName] = optionValue;
          } else {
            throw new Error(optionName);
          }

          // Other options are strings.
        } else {
          if (typeof optionValue === "string") {
            filteredOptions[optionName] = optionValue;
          } else {
            throw new Error(optionName);
          }
        }
      }

      // Some values can't be extracted from a
      // string if certain combinations are present.
      throwEqualError(filteredOptions, "mark", "thousand");
      throwEqualError(filteredOptions, "prefix", "negative");
      throwEqualError(filteredOptions, "prefix", "negativeBefore");

      return filteredOptions;
    }

    // Pass all options as function arguments
    function passAll(options, method, input) {
      var i,
        args = [];

      // Add all options in order of FormatOptions
      for (i = 0; i < FormatOptions.length; i += 1) {
        args.push(options[FormatOptions[i]]);
      }

      // Append the input, then call the method, presenting all
      // options as arguments.
      args.push(input);
      return method.apply("", args);
    }

    function wNumb(options) {
      if (!(this instanceof wNumb)) {
        return new wNumb(options);
      }

      if (typeof options !== "object") {
        return;
      }

      options = validate(options);

      // Call 'formatTo' with proper arguments.
      this.to = function(input) {
        return passAll(options, formatTo, input);
      };

      // Call 'formatFrom' with proper arguments.
      this.from = function(input) {
        return passAll(options, formatFrom, input);
      };
    }

    return wNumb;
  });(function(e) {
    if (typeof define === "function" && define.amd) {
        define(["jquery"], e)
    } else {
        e(jQuery)
    }
})(function(e) {
    "use strict";
    var t = {},
        n = Math.max,
        r = Math.min;
    t.c = {};
    t.c.d = e(document);
    t.c.t = function(e) {
        return e.originalEvent.touches.length - 1
    };
    t.o = function() {
        var n = this;
        this.o = null;
        this.$ = null;
        this.i = null;
        this.g = null;
        this.v = null;
        this.cv = null;
        this.x = 0;
        this.y = 0;
        this.w = 0;
        this.h = 0;
        this.$c = null;
        this.c = null;
        this.t = 0;
        this.isInit = false;
        this.fgColor = null;
        this.pColor = null;
        this.dH = null;
        this.cH = null;
        this.eH = null;
        this.rH = null;
        this.scale = 1;
        this.relative = false;
        this.relativeWidth = false;
        this.relativeHeight = false;
        this.$div = null;
        this.run = function() {
            var t = function(e, t) {
                var r;
                for (r in t) {
                    n.o[r] = t[r]
                }
                n._carve().init();
                n._configure()._draw()
            };
            if (this.$.data("kontroled")) return;
            this.$.data("kontroled", true);
            this.extend();
            this.o = e.extend({
                min: this.$.data("min") !== undefined ? this.$.data("min") : 0,
                max: this.$.data("max") !== undefined ? this.$.data("max") : 100,
                stopper: true,
                readOnly: this.$.data("readonly") || this.$.attr("readonly") === "readonly",
                cursor: this.$.data("cursor") === true && 30 || this.$.data("cursor") || 0,
                thickness: this.$.data("thickness") && Math.max(Math.min(this.$.data("thickness"), 1), .01) || .35,
                lineCap: this.$.data("linecap") || "butt",
                width: this.$.data("width") || 200,
                height: this.$.data("height") || 200,
                displayInput: this.$.data("displayinput") == null || this.$.data("displayinput"),
                displayPrevious: this.$.data("displayprevious"),
                fgColor: this.$.data("fgcolor") || "#87CEEB",
                inputColor: this.$.data("inputcolor"),
                font: this.$.data("font") || "Arial",
                fontWeight: this.$.data("font-weight") || "bold",
                inline: false,
                step: this.$.data("step") || 1,
                rotation: this.$.data("rotation"),
                draw: null,
                change: null,
                cancel: null,
                release: null,
                format: function(e) {
                    return e
                },
                parse: function(e) {
                    return parseFloat(e)
                }
            }, this.o);
            this.o.flip = this.o.rotation === "anticlockwise" || this.o.rotation === "acw";
            if (!this.o.inputColor) {
                this.o.inputColor = this.o.fgColor
            }
            if (this.$.is("fieldset")) {
                this.v = {};
                this.i = this.$.find("input");
                this.i.each(function(t) {
                    var r = e(this);
                    n.i[t] = r;
                    n.v[t] = n.o.parse(r.val());
                    r.bind("change blur", function() {
                        var e = {};
                        e[t] = r.val();
                        n.val(n._validate(e))
                    })
                });
                this.$.find("legend").remove()
            } else {
                this.i = this.$;
                this.v = this.o.parse(this.$.val());
                this.v === "" && (this.v = this.o.min);
                this.$.bind("change blur", function() {
                    n.val(n._validate(n.o.parse(n.$.val())))
                })
            }!this.o.displayInput && this.$.hide();
            this.$c = e(document.createElement("canvas")).attr({
                width: this.o.width,
                height: this.o.height
            });
            this.$div = e('<div style="' + (this.o.inline ? "display:inline;" : "") + "width:" + this.o.width + "px;height:" + this.o.height + "px;" + '"></div>');
            this.$.wrap(this.$div).before(this.$c);
            this.$div = this.$.parent();
            if (typeof G_vmlCanvasManager !== "undefined") {
                G_vmlCanvasManager.initElement(this.$c[0])
            }
            this.c = this.$c[0].getContext ? this.$c[0].getContext("2d") : null;
            if (!this.c) {
                throw {
                    name: "CanvasNotSupportedException",
                    message: "Canvas not supported. Please use excanvas on IE8.0.",
                    toString: function() {
                        return this.name + ": " + this.message
                    }
                }
            }
            this.scale = (window.devicePixelRatio || 1) / (this.c.webkitBackingStorePixelRatio || this.c.mozBackingStorePixelRatio || this.c.msBackingStorePixelRatio || this.c.oBackingStorePixelRatio || this.c.backingStorePixelRatio || 1);
            this.relativeWidth = this.o.width % 1 !== 0 && this.o.width.indexOf("%");
            this.relativeHeight = this.o.height % 1 !== 0 && this.o.height.indexOf("%");
            this.relative = this.relativeWidth || this.relativeHeight;
            this._carve();
            if (this.v instanceof Object) {
                this.cv = {};
                this.copy(this.v, this.cv)
            } else {
                this.cv = this.v
            }
            this.$.bind("configure", t).parent().bind("configure", t);
            this._listen()._configure()._xy().init();
            this.isInit = true;
            this.$.val(this.o.format(this.v));
            this._draw();
            return this
        };
        this._carve = function() {
            if (this.relative) {
                var e = this.relativeWidth ? this.$div.parent().width() * parseInt(this.o.width) / 100 : this.$div.parent().width(),
                    t = this.relativeHeight ? this.$div.parent().height() * parseInt(this.o.height) / 100 : this.$div.parent().height();
                this.w = this.h = Math.min(e, t)
            } else {
                this.w = this.o.width;
                this.h = this.o.height
            }
            this.$div.css({
                width: this.w + "px",
                height: this.h + "px"
            });
            this.$c.attr({
                width: this.w,
                height: this.h
            });
            if (this.scale !== 1) {
                this.$c[0].width = this.$c[0].width * this.scale;
                this.$c[0].height = this.$c[0].height * this.scale;
                this.$c.width(this.w);
                this.$c.height(this.h)
            }
            return this
        };
        this._draw = function() {
            var e = true;
            n.g = n.c;
            n.clear();
            n.dH && (e = n.dH());
            e !== false && n.draw()
        };
        this._touch = function(e) {
            var r = function(e) {
                var t = n.xy2val(e.originalEvent.touches[n.t].pageX, e.originalEvent.touches[n.t].pageY);
                if (t == n.cv) return;
                if (n.cH && n.cH(t) === false) return;
                n.change(n._validate(t));
                n._draw()
            };
            this.t = t.c.t(e);
            r(e);
            t.c.d.bind("touchmove.k", r).bind("touchend.k", function() {
                t.c.d.unbind("touchmove.k touchend.k");
                n.val(n.cv)
            });
            return this
        };
        this._mouse = function(e) {
            var r = function(e) {
                var t = n.xy2val(e.pageX, e.pageY);
                if (t == n.cv) return;
                if (n.cH && n.cH(t) === false) return;
                n.change(n._validate(t));
                n._draw()
            };
            r(e);
            t.c.d.bind("mousemove.k", r).bind("keyup.k", function(e) {
                if (e.keyCode === 27) {
                    t.c.d.unbind("mouseup.k mousemove.k keyup.k");
                    if (n.eH && n.eH() === false) return;
                    n.cancel()
                }
            }).bind("mouseup.k", function(e) {
                t.c.d.unbind("mousemove.k mouseup.k keyup.k");
                n.val(n.cv)
            });
            return this
        };
        this._xy = function() {
            var e = this.$c.offset();
            this.x = e.left;
            this.y = e.top;
            return this
        };
        this._listen = function() {
            if (!this.o.readOnly) {
                this.$c.bind("mousedown", function(e) {
                    e.preventDefault();
                    n._xy()._mouse(e)
                }).bind("touchstart", function(e) {
                    e.preventDefault();
                    n._xy()._touch(e)
                });
                this.listen()
            } else {
                this.$.attr("readonly", "readonly")
            }
            if (this.relative) {
                e(window).resize(function() {
                    n._carve().init();
                    n._draw()
                })
            }
            return this
        };
        this._configure = function() {
            if (this.o.draw) this.dH = this.o.draw;
            if (this.o.change) this.cH = this.o.change;
            if (this.o.cancel) this.eH = this.o.cancel;
            if (this.o.release) this.rH = this.o.release;
            if (this.o.displayPrevious) {
                this.pColor = this.h2rgba(this.o.fgColor, "0.4");
                this.fgColor = this.h2rgba(this.o.fgColor, "0.6")
            } else {
                this.fgColor = this.o.fgColor
            }
            return this
        };
        this._clear = function() {
            this.$c[0].width = this.$c[0].width
        };
        this._validate = function(e) {
            var t = ~~((e < 0 ? -.5 : .5) + e / this.o.step) * this.o.step;
            return Math.round(t * 100) / 100
        };
        this.listen = function() {};
        this.extend = function() {};
        this.init = function() {};
        this.change = function(e) {};
        this.val = function(e) {};
        this.xy2val = function(e, t) {};
        this.draw = function() {};
        this.clear = function() {
            this._clear()
        };
        this.h2rgba = function(e, t) {
            var n;
            e = e.substring(1, 7);
            n = [parseInt(e.substring(0, 2), 16), parseInt(e.substring(2, 4), 16), parseInt(e.substring(4, 6), 16)];
            return "rgba(" + n[0] + "," + n[1] + "," + n[2] + "," + t + ")"
        };
        this.copy = function(e, t) {
            for (var n in e) {
                t[n] = e[n]
            }
        }
    };
    t.Dial = function() {
        t.o.call(this);
        this.startAngle = null;
        this.xy = null;
        this.radius = null;
        this.lineWidth = null;
        this.cursorExt = null;
        this.w2 = null;
        this.PI2 = 2 * Math.PI;
        this.extend = function() {
            this.o = e.extend({
                bgColor: this.$.data("bgcolor") || "#EEEEEE",
                angleOffset: this.$.data("angleoffset") || 0,
                angleArc: this.$.data("anglearc") || 360,
                inline: true
            }, this.o)
        };
        this.val = function(e, t) {
            if (null != e) {
                e = this.o.parse(e);
                if (t !== false && e != this.v && this.rH && this.rH(e) === false) {
                    return
                }
                this.cv = this.o.stopper ? n(r(e, this.o.max), this.o.min) : e;
                this.v = this.cv;
                this.$.val(this.o.format(this.v));
                this._draw()
            } else {
                return this.v
            }
        };
        this.xy2val = function(e, t) {
            var i, s;
            i = Math.atan2(e - (this.x + this.w2), -(t - this.y - this.w2)) - this.angleOffset;
            if (this.o.flip) {
                i = this.angleArc - i - this.PI2
            }
            if (this.angleArc != this.PI2 && i < 0 && i > -.5) {
                i = 0
            } else if (i < 0) {
                i += this.PI2
            }
            s = i * (this.o.max - this.o.min) / this.angleArc + this.o.min;
            this.o.stopper && (s = n(r(s, this.o.max), this.o.min));
            return s
        };
        this.listen = function() {
            var t = this,
                i, s, o = function(e) {
                    e.preventDefault();
                    var o = e.originalEvent,
                        u = o.detail || o.wheelDeltaX,
                        a = o.detail || o.wheelDeltaY,
                        f = t._validate(t.o.parse(t.$.val())) + (u > 0 || a > 0 ? t.o.step : u < 0 || a < 0 ? -t.o.step : 0);
                    f = n(r(f, t.o.max), t.o.min);
                    t.val(f, false);
                    if (t.rH) {
                        clearTimeout(i);
                        i = setTimeout(function() {
                            t.rH(f);
                            i = null
                        }, 100);
                        if (!s) {
                            s = setTimeout(function() {
                                if (i) t.rH(f);
                                s = null
                            }, 200)
                        }
                    }
                },
                u, a, f = 1,
                l = {
                    37: -t.o.step,
                    38: t.o.step,
                    39: t.o.step,
                    40: -t.o.step
                };
            this.$.bind("keydown", function(i) {
                var s = i.keyCode;
                if (s >= 96 && s <= 105) {
                    s = i.keyCode = s - 48
                }
                u = parseInt(String.fromCharCode(s));
                if (isNaN(u)) {
                    s !== 13 && s !== 8 && s !== 9 && s !== 189 && (s !== 190 || t.$.val().match(/\./)) && i.preventDefault();
                    if (e.inArray(s, [37, 38, 39, 40]) > -1) {
                        i.preventDefault();
                        var o = t.o.parse(t.$.val()) + l[s] * f;
                        t.o.stopper && (o = n(r(o, t.o.max), t.o.min));
                        t.change(t._validate(o));
                        t._draw();
                        a = window.setTimeout(function() {
                            f *= 2
                        }, 30)
                    }
                }
            }).bind("keyup", function(e) {
                if (isNaN(u)) {
                    if (a) {
                        window.clearTimeout(a);
                        a = null;
                        f = 1;
                        t.val(t.$.val())
                    }
                } else {
                    t.$.val() > t.o.max && t.$.val(t.o.max) || t.$.val() < t.o.min && t.$.val(t.o.min)
                }
            });
            this.$c.bind("mousewheel DOMMouseScroll", o);
            this.$.bind("mousewheel DOMMouseScroll", o)
        };
        this.init = function() {
            if (this.v < this.o.min || this.v > this.o.max) {
                this.v = this.o.min
            }
            this.$.val(this.v);
            this.w2 = this.w / 2;
            this.cursorExt = this.o.cursor / 100;
            this.xy = this.w2 * this.scale;
            this.lineWidth = this.xy * this.o.thickness;
            this.lineCap = this.o.lineCap;
            this.radius = this.xy - this.lineWidth / 2;
            this.o.angleOffset && (this.o.angleOffset = isNaN(this.o.angleOffset) ? 0 : this.o.angleOffset);
            this.o.angleArc && (this.o.angleArc = isNaN(this.o.angleArc) ? this.PI2 : this.o.angleArc);
            this.angleOffset = this.o.angleOffset * Math.PI / 180;
            this.angleArc = this.o.angleArc * Math.PI / 180;
            this.startAngle = 1.5 * Math.PI + this.angleOffset;
            this.endAngle = 1.5 * Math.PI + this.angleOffset + this.angleArc;
            var e = n(String(Math.abs(this.o.max)).length, String(Math.abs(this.o.min)).length, 2) + 2;
            this.o.displayInput && this.i.css({
                width: (this.w / 2 + 4 >> 0) + "px",
                height: (this.w / 3 >> 0) + "px",
                position: "absolute",
                "vertical-align": "middle",
                "margin-top": (this.w / 3 >> 0) + "px",
                "margin-left": "-" + (this.w * 3 / 4 + 2 >> 0) + "px",
                border: 0,
                background: "none",
                font: this.o.fontWeight + " " + (this.w / e >> 0) + "px " + this.o.font,
                "text-align": "center",
                color: this.o.inputColor || this.o.fgColor,
                padding: "0px",
                "-webkit-appearance": "none"
            }) || this.i.css({
                width: "0px",
                visibility: "hidden"
            })
        };
        this.change = function(e) {
            this.cv = e;
            this.$.val(this.o.format(e))
        };
        this.angle = function(e) {
            return (e - this.o.min) * this.angleArc / (this.o.max - this.o.min)
        };
        this.arc = function(e) {
            var t, n;
            e = this.angle(e);
            if (this.o.flip) {
                t = this.endAngle + 1e-5;
                n = t - e - 1e-5
            } else {
                t = this.startAngle - 1e-5;
                n = t + e + 1e-5
            }
            this.o.cursor && (t = n - this.cursorExt) && (n = n + this.cursorExt);
            return {
                s: t,
                e: n,
                d: this.o.flip && !this.o.cursor
            }
        };
        this.draw = function() {
            var e = this.g,
                t = this.arc(this.cv),
                n, r = 1;
            e.lineWidth = this.lineWidth;
            e.lineCap = this.lineCap;
            if (this.o.bgColor !== "none") {
                e.beginPath();
                e.strokeStyle = this.o.bgColor;
                e.arc(this.xy, this.xy, this.radius, this.endAngle - 1e-5, this.startAngle + 1e-5, true);
                e.stroke()
            }
            if (this.o.displayPrevious) {
                n = this.arc(this.v);
                e.beginPath();
                e.strokeStyle = this.pColor;
                e.arc(this.xy, this.xy, this.radius, n.s, n.e, n.d);
                e.stroke();
                r = this.cv == this.v
            }
            e.beginPath();
            e.strokeStyle = r ? this.o.fgColor : this.fgColor;
            e.arc(this.xy, this.xy, this.radius, t.s, t.e, t.d);
            e.stroke()
        };
        this.cancel = function() {
            this.val(this.v)
        }
    };
    e.fn.dial = e.fn.knob = function(n) {
        return this.each(function() {
            var r = new t.Dial;
            r.o = n;
            r.$ = e(this);
            r.run()
        }).parent()
    }
})(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.ADSREnvelope = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
module.exports = require("./lib");

},{"./lib":9}],2:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _slicedToArray = (function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"]) _i["return"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError("Invalid attempt to destructure non-iterable instance"); } }; })();

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var _ADSRParams = require("./ADSRParams");

var _ADSRParams2 = _interopRequireDefault(_ADSRParams);

var ADSREnvelope = (function () {
  function ADSREnvelope(opts) {
    _classCallCheck(this, ADSREnvelope);

    this._ = new _ADSRParams2["default"](opts);
  }

  _createClass(ADSREnvelope, [{
    key: "valueAt",
    value: function valueAt() {
      var time = arguments.length <= 0 || arguments[0] === undefined ? 0 : arguments[0];

      return this._.valueAt(time);
    }
  }, {
    key: "applyTo",
    value: function applyTo(audioParam, playbackTime) {
      this.getWebAudioAPIMethods(playbackTime).forEach(function (_ref) {
        var _ref2 = _slicedToArray(_ref, 3);

        var method = _ref2[0];
        var value = _ref2[1];
        var time = _ref2[2];

        audioParam[method](value, time);
      });

      return this;
    }
  }, {
    key: "getWebAudioAPIMethods",
    value: function getWebAudioAPIMethods() {
      var playbackTime = arguments.length <= 0 || arguments[0] === undefined ? 0 : arguments[0];

      return this._.methods(playbackTime);
    }
  }, {
    key: "clone",
    value: function clone() {
      return new ADSREnvelope({
        attackTime: this._.attackTime,
        decayTime: this._.decayTime,
        sustainLevel: this._.sustainLevel,
        releaseTime: this._.releaseTime,
        gateTime: this._.gateTime,
        peakLevel: this._.peakLevel,
        epsilon: this._.epsilon,
        attackCurve: this._.attackCurve,
        decayCurve: this._.decayCurve,
        releaseCurve: this._.releaseCurve
      });
    }
  }, {
    key: "duration",
    set: function set(value) {
      this._.setDuration(value);
    },
    get: function get() {
      return this._.duration;
    }
  }, {
    key: "attackTime",
    set: function set(value) {
      this._.setAttackTime(value);
    },
    get: function get() {
      return this._.attackTime;
    }
  }, {
    key: "decayTime",
    set: function set(value) {
      this._.setDecayTime(value);
    },
    get: function get() {
      return this._.decayTime;
    }
  }, {
    key: "sustainTime",
    set: function set(value) {
      this._.setSustainTime(value);
    },
    get: function get() {
      return this._.sustainTime;
    }
  }, {
    key: "sustainLevel",
    set: function set(value) {
      this._.setSustainLevel(value);
    },
    get: function get() {
      return this._.sustainLevel;
    }
  }, {
    key: "releaseTime",
    set: function set(value) {
      this._.setReleaseTime(value);
    },
    get: function get() {
      return this._.releaseTime;
    }
  }, {
    key: "gateTime",
    set: function set(value) {
      this._.setGateTime(value);
    },
    get: function get() {
      return this._.gateTime;
    }
  }, {
    key: "peakLevel",
    set: function set(value) {
      this._.setPeakLevel(value);
    },
    get: function get() {
      return this._.peakLevel;
    }
  }, {
    key: "epsilon",
    set: function set(value) {
      this._.setEpsilon(value);
    },
    get: function get() {
      return this._.epsilon;
    }
  }, {
    key: "attackCurve",
    set: function set(value) {
      this._.setAttackCurve(value);
    },
    get: function get() {
      return this._.attackCurve;
    }
  }, {
    key: "decayCurve",
    set: function set(value) {
      this._.setDecayCurve(value);
    },
    get: function get() {
      return this._.decayCurve;
    }
  }, {
    key: "releaseCurve",
    set: function set(value) {
      this._.setReleaseCurve(value);
    },
    get: function get() {
      return this._.releaseCurve;
    }
  }]);

  return ADSREnvelope;
})();

exports["default"] = ADSREnvelope;
module.exports = exports["default"];
},{"./ADSRParams":3}],3:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _slicedToArray = (function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"]) _i["return"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError("Invalid attempt to destructure non-iterable instance"); } }; })();

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var _EnvelopeBuilder = require("./EnvelopeBuilder");

var _EnvelopeBuilder2 = _interopRequireDefault(_EnvelopeBuilder);

var _EnvelopeValue = require("./EnvelopeValue");

var _EnvelopeValue2 = _interopRequireDefault(_EnvelopeValue);

var _defaultValues = require("./defaultValues");

var _defaultValues2 = _interopRequireDefault(_defaultValues);

var _utilsDefaults = require("./utils/defaults");

var _utilsDefaults2 = _interopRequireDefault(_utilsDefaults);

var _utilsConstrain = require("./utils/constrain");

var _utilsConstrain2 = _interopRequireDefault(_utilsConstrain);

var _utilsIsFiniteNumber = require("./utils/isFiniteNumber");

var _utilsIsFiniteNumber2 = _interopRequireDefault(_utilsIsFiniteNumber);

var _constants = require("./constants");

var EPSILON = 2.220446049250313e-16;

var ADSRParams = (function () {
  function ADSRParams() {
    var opts = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

    _classCallCheck(this, ADSRParams);

    this.attackTime = time((0, _utilsDefaults2["default"])(opts.attackTime, _defaultValues2["default"].attackTime));
    this.decayTime = time((0, _utilsDefaults2["default"])(opts.decayTime, _defaultValues2["default"].decayTime));
    this.sustainLevel = level((0, _utilsDefaults2["default"])(opts.sustainLevel, _defaultValues2["default"].sustainLevel));
    this.releaseTime = time((0, _utilsDefaults2["default"])(opts.releaseTime, _defaultValues2["default"].releaseTime));
    this.peakLevel = time((0, _utilsDefaults2["default"])(opts.peakLevel, _defaultValues2["default"].peakLevel));
    this.epsilon = epsilon((0, _utilsDefaults2["default"])(opts.epsilon, _defaultValues2["default"].epsilon));
    this.attackCurve = curve((0, _utilsDefaults2["default"])(opts.attackCurve, _defaultValues2["default"].attackCurve));
    this.decayCurve = curve((0, _utilsDefaults2["default"])(opts.decayCurve, _defaultValues2["default"].decayCurve));
    this.releaseCurve = curve((0, _utilsDefaults2["default"])(opts.releaseCurve, _defaultValues2["default"].releaseCurve));
    this.gateTime = _defaultValues2["default"].gateTime;

    if ((0, _utilsIsFiniteNumber2["default"])(opts.sustainTime)) {
      this.setSustainTime(opts.sustainTime);
    }
    if ((0, _utilsIsFiniteNumber2["default"])(opts.gateTime)) {
      this.setGateTime(opts.gateTime);
    }
    if ((0, _utilsIsFiniteNumber2["default"])(opts.duration)) {
      this.setDuration(opts.duration);
    }

    this.update();
  }

  _createClass(ADSRParams, [{
    key: "valueAt",
    value: function valueAt(time) {
      return _EnvelopeValue2["default"].at(this.envelope, time);
    }
  }, {
    key: "methods",
    value: function methods(playbackTime) {
      return this.envelope.map(function (_ref) {
        var _ref2 = _slicedToArray(_ref, 3);

        var type = _ref2[0];
        var value = _ref2[1];
        var time = _ref2[2];

        return [method(type), value, playbackTime + time];
      });
    }
  }, {
    key: "setDuration",
    value: function setDuration(value) {
      var duration = time(value);

      this.setGateTime(duration - this.releaseTime);
    }
  }, {
    key: "setAttackTime",
    value: function setAttackTime(value) {
      this.attackTime = time(value);
      this.update();
    }
  }, {
    key: "setDecayTime",
    value: function setDecayTime(value) {
      this.decayTime = time(value);
      this.update();
    }
  }, {
    key: "setSustainTime",
    value: function setSustainTime(value) {
      var sustainTime = time(value);

      this.setGateTime(this.attackTime + this.decayTime + sustainTime);
    }
  }, {
    key: "setSustainLevel",
    value: function setSustainLevel(value) {
      this.sustainLevel = level(value);
      this.update();
    }
  }, {
    key: "setReleaseTime",
    value: function setReleaseTime(value) {
      this.releaseTime = time(value);
      this.update();
    }
  }, {
    key: "setGateTime",
    value: function setGateTime(value) {
      this.gateTime = time(value);
      this.update();
    }
  }, {
    key: "setPeakLevel",
    value: function setPeakLevel(value) {
      this.peakLevel = time(value);
      this.update();
    }
  }, {
    key: "setEpsilon",
    value: function setEpsilon(value) {
      this.epsilon = epsilon(value);
      this.update();
    }
  }, {
    key: "setAttackCurve",
    value: function setAttackCurve(value) {
      this.attackCurve = curve(value);
      this.update();
    }
  }, {
    key: "setDecayCurve",
    value: function setDecayCurve(value) {
      this.decayCurve = curve(value);
      this.update();
    }
  }, {
    key: "setReleaseCurve",
    value: function setReleaseCurve(value) {
      this.releaseCurve = curve(value);
      this.update();
    }
  }, {
    key: "update",
    value: function update() {
      this.sustainTime = Math.max(0, this.gateTime - this.attackTime - this.decayTime);
      this.duration = this.gateTime + this.releaseTime;
      this.envelope = _EnvelopeBuilder2["default"].build(this);
    }
  }]);

  return ADSRParams;
})();

exports["default"] = ADSRParams;

function time(value) {
  return Math.max(0, value) || 0;
}

function level(value) {
  return (0, _utilsConstrain2["default"])(+value, 0, 1) || 0;
}

function epsilon(value) {
  return (0, _utilsConstrain2["default"])(+value, EPSILON, 1e-2) || 1e-3;
}

function curve(type) {
  return type === "exp" ? "exp" : "lin";
}

function method(type) {
  switch (type) {
    case _constants.SET:
      return "setValueAtTime";
    case _constants.LIN:
      return "linearRampToValueAtTime";
    case _constants.EXP:
      return "exponentialRampToValueAtTime";
    default:
    // do nothing
  }
}
module.exports = exports["default"];
},{"./EnvelopeBuilder":4,"./EnvelopeValue":6,"./constants":7,"./defaultValues":8,"./utils/constrain":10,"./utils/defaults":11,"./utils/isFiniteNumber":12}],4:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

var _EnvelopeReducer = require("./EnvelopeReducer");

var _EnvelopeReducer2 = _interopRequireDefault(_EnvelopeReducer);

var _utilsLinlin = require("./utils/linlin");

var _utilsLinlin2 = _interopRequireDefault(_utilsLinlin);

var _utilsLinexp = require("./utils/linexp");

var _utilsLinexp2 = _interopRequireDefault(_utilsLinexp);

var _constants = require("./constants");

function build(params) {
  var envelope = buildEnvelope(params);

  envelope = _EnvelopeReducer2["default"].reduce(envelope);

  return envelope;
}

function getCurveItems(curveType, epsilon) {
  if (curveType === "exp") {
    return { zero: epsilon, calc: _utilsLinexp2["default"], type: _constants.EXP };
  }
  return { zero: 0, calc: _utilsLinlin2["default"], type: _constants.LIN };
}

function buildEnvelope(params) {
  var attackTime = params.attackTime;
  var decayTime = params.decayTime;
  var gateTime = params.gateTime;
  var releaseTime = params.releaseTime;

  var envType = 0;

  envType += 0 < attackTime ? 4 : 0;
  envType += 0 < decayTime ? 2 : 0;
  envType += 0 < releaseTime ? 1 : 0;

  switch (envType) {
    case 0:
      return buildSustainEnvelope(params);
    case 1:
      return buildSustainReleaseEnvelope(params);
    case 2:
      if (gateTime <= decayTime) {
        return buildDecayEnvelope(params);
      }
      return buildDecaySustainEnvelope(params);
    case 3:
      if (gateTime <= decayTime) {
        return buildDecayReleaseEnvelope(params);
      }
      return buildDecaySustainReleaseEnvelope(params);
    case 4:
      if (gateTime <= attackTime) {
        return buildAttackEnvelope(params);
      }
      return buildAttackSustainEnvelope(params);
    case 5:
      if (gateTime <= attackTime) {
        return buildAttackReleaseEnvelope(params);
      }
      return buildAttackSustainReleaseEnvelope(params);
    case 6:
      if (gateTime <= attackTime) {
        return buildAttackEnvelope(params);
      }
      if (gateTime <= attackTime + decayTime) {
        return buildAttackDecayEnvelope(params);
      }
      return buildAttackDecaySustainEnvelope(params);
    case 7:
      if (gateTime <= attackTime) {
        return buildAttackReleaseEnvelope(params);
      }
      if (gateTime <= attackTime + decayTime) {
        return buildAttackDecayReleaseEnvelope(params);
      }
      return buildAttackDecaySustainReleaseEnvelope(params);
    default:
    // do nothing
  }
}

function buildSustainEnvelope(params) {
  //
  //
  // ----------*
  //           |
  //           +---------
  // 0         12
  //
  var result = [];
  var t0 = 0;
  var t1 = params.gateTime;
  var t2 = params.gateTime;
  var v0 = params.sustainLevel * params.peakLevel;
  var v1 = params.sustainLevel * params.peakLevel;
  var v2 = 0;

  result.push([_constants.SET, v0, t0]);
  result.push([_constants.SET, v1, t1]);
  result.push([_constants.SET, v2, t2]);

  return result;
}

function buildSustainReleaseEnvelope(params) {
  //
  //
  // ----------*
  //            \
  //             +-------
  // 0         1 2
  var result = [];
  var r = getCurveItems(params.releaseCurve, params.epsilon);
  var t0 = 0;
  var t1 = params.gateTime;
  var t2 = params.gateTime + params.releaseTime;
  var v0 = Math.max(r.zero, params.sustainLevel * params.peakLevel);
  var v1 = Math.max(r.zero, params.sustainLevel * params.peakLevel);
  var v2 = r.zero;

  result.push([_constants.SET, v0, t0]);
  result.push([_constants.SET, v1, t1]);
  result.push([r.type, v2, t2]);

  return result;
}

function buildDecaySustainEnvelope(params) {
  // +
  //  \
  //   +-------*
  //           |
  //           +---------
  // 0 1       23
  var result = [];
  var d = getCurveItems(params.decayCurve, params.epsilon);
  var t0 = 0;
  var t1 = params.decayTime;
  var t2 = params.gateTime;
  var t3 = params.gateTime;
  var v0 = Math.max(d.zero, params.peakLevel);
  var v1 = Math.max(d.zero, params.sustainLevel * params.peakLevel);
  var v2 = Math.max(d.zero, params.sustainLevel * params.peakLevel);
  var v3 = 0;

  result.push([_constants.SET, v0, t0]);
  result.push([d.type, v1, t1]);
  result.push([_constants.SET, v2, t2]);
  result.push([_constants.SET, v3, t3]);

  return result;
}

function buildDecayEnvelope(params) {
  // +
  //  \
  //   *
  //   |
  //   +-----------------
  // 0 12
  var result = [];
  var d = getCurveItems(params.decayCurve, params.epsilon);
  var t0 = 0;
  var t1 = params.gateTime;
  var t2 = params.gateTime;
  var v0 = Math.max(d.zero, params.peakLevel);
  var vx = Math.max(d.zero, params.sustainLevel * params.peakLevel);
  var v1 = d.calc(t1, 0, params.decayTime, v0, vx);
  var v2 = 0;

  result.push([_constants.SET, v0, t0]);
  result.push([d.type, v1, t1]);
  result.push([_constants.SET, v2, t2]);

  return result;
}

function buildDecaySustainReleaseEnvelope(params) {
  // +
  //  \
  //   +-------*
  //            \
  //             +-------
  // 0 1       2 3
  var result = [];
  var d = getCurveItems(params.decayCurve, params.epsilon);
  var r = getCurveItems(params.releaseCurve, params.epsilon);
  var t0 = 0;
  var t1 = params.decayTime;
  var t2 = params.gateTime;
  var t3 = params.gateTime + params.releaseTime;
  var v0 = Math.max(d.zero, r.zero, params.peakLevel);
  var v1 = Math.max(d.zero, r.zero, params.sustainLevel * params.peakLevel);
  var v2 = Math.max(d.zero, r.zero, params.sustainLevel * params.peakLevel);
  var v3 = r.zero;

  result.push([_constants.SET, v0, t0]);
  result.push([d.type, v1, t1]);
  result.push([_constants.SET, v2, t2]);
  result.push([r.type, v3, t3]);

  return result;
}

function buildDecayReleaseEnvelope(params) {
  // +
  //  \
  //   *
  //    \
  //     +---------------
  // 0 1 2
  var result = [];
  var d = getCurveItems(params.decayCurve, params.epsilon);
  var r = getCurveItems(params.releaseCurve, params.epsilon);
  var t0 = 0;
  var t1 = params.gateTime;
  var t2 = params.gateTime + params.releaseTime;
  var v0 = Math.max(d.zero, r.zero, params.peakLevel);
  var vx = Math.max(d.zero, r.zero, params.sustainLevel * params.peakLevel);
  var v1 = d.calc(t1, 0, params.decayTime, v0, vx);
  var v2 = Math.max(d.zero, r.zero);

  result.push([_constants.SET, v0, t0]);
  result.push([d.type, v1, t1]);
  result.push([r.type, v2, t2]);

  return result;
}

function buildAttackSustainEnvelope(params) {
  //     +
  //    /|
  //   / +-----*
  //  /        |
  // +         +---------
  // 0   12    34
  var result = [];
  var a = getCurveItems(params.attackCurve, params.epsilon);
  var t0 = 0;
  var t1 = params.attackTime;
  var t2 = params.attackTime;
  var t3 = params.gateTime;
  var t4 = params.gateTime;
  var v0 = a.zero;
  var v1 = Math.max(a.zero, params.peakLevel);
  var v2 = params.sustainLevel * params.peakLevel;
  var v3 = params.sustainLevel * params.peakLevel;
  var v4 = 0;

  result.push([_constants.SET, v0, t0]);
  result.push([a.type, v1, t1]);
  result.push([_constants.SET, v2, t2]);
  result.push([_constants.SET, v3, t3]);
  result.push([_constants.SET, v4, t4]);

  return result;
}

function buildAttackEnvelope(params) {
  //
  //
  //   *
  //  /|
  // + +-----------------
  // 0 12
  var result = [];
  var a = getCurveItems(params.attackCurve, params.epsilon);
  var t0 = 0;
  var t1 = params.gateTime;
  var t2 = params.gateTime;
  var v0 = a.zero;
  var vx = Math.max(a.zero, params.peakLevel);
  var v1 = a.calc(t1, 0, params.attackTime, v0, vx);
  var v2 = 0;

  result.push([_constants.SET, v0, t0]);
  result.push([a.type, v1, t1]);
  result.push([_constants.SET, v2, t2]);

  return result;
}

function buildAttackSustainReleaseEnvelope(params) {
  //     +
  //    /|
  //   / +-----*
  //  /         \
  // +           +-------
  // 0   12    3 4
  var result = [];
  var a = getCurveItems(params.attackCurve, params.epsilon);
  var r = getCurveItems(params.releaseCurve, params.epsilon);
  var t0 = 0;
  var t1 = params.attackTime;
  var t2 = params.attackTime;
  var t3 = params.gateTime;
  var t4 = params.gateTime + params.releaseTime;
  var v0 = a.zero;
  var v1 = Math.max(a.zero, params.peakLevel);
  var v2 = Math.max(r.zero, params.sustainLevel * params.peakLevel);
  var v3 = Math.max(r.zero, params.sustainLevel * params.peakLevel);
  var v4 = r.zero;

  result.push([_constants.SET, v0, t0]);
  result.push([a.type, v1, t1]);
  result.push([_constants.SET, v2, t2]);
  result.push([_constants.SET, v3, t3]);
  result.push([r.type, v4, t4]);

  return result;
}

function buildAttackReleaseEnvelope(params) {
  //
  //
  //   *
  //  / \
  // +   +---------------
  // 0 1 2
  var result = [];
  var a = getCurveItems(params.attackCurve, params.epsilon);
  var r = getCurveItems(params.releaseCurve, params.epsilon);
  var t0 = 0;
  var t1 = params.gateTime;
  var t2 = params.gateTime + params.releaseTime;
  var v0 = a.zero;
  var vx = Math.max(a.zero, params.peakLevel);
  var v1 = a.calc(t1, 0, params.attackTime, v0, vx);
  var v2 = r.zero;

  result.push([_constants.SET, v0, t0]);
  result.push([a.type, v1, t1]);
  result.push([r.type, v2, t2]);

  return result;
}

function buildAttackDecaySustainEnvelope(params) {
  //     +
  //    / \
  //   /   +---*
  //  /        |
  // +         +---------
  // 0   1 2   34
  var result = [];
  var a = getCurveItems(params.attackCurve, params.epsilon);
  var d = getCurveItems(params.decayCurve, params.epsilon);
  var t0 = 0;
  var t1 = params.attackTime;
  var t2 = params.attackTime + params.decayTime;
  var t3 = params.gateTime;
  var t4 = params.gateTime;
  var v0 = a.zero;
  var v1 = Math.max(a.zero, d.zero, params.peakLevel);
  var v2 = Math.max(d.zero, params.sustainLevel * params.peakLevel);
  var v3 = Math.max(d.zero, params.sustainLevel * params.peakLevel);
  var v4 = 0;

  result.push([_constants.SET, v0, t0]);
  result.push([a.type, v1, t1]);
  result.push([d.type, v2, t2]);
  result.push([_constants.SET, v3, t3]);
  result.push([_constants.SET, v4, t4]);

  return result;
}

function buildAttackDecayEnvelope(params) {
  //     +
  //    / \
  //   /   *
  //  /    |
  // +     +-------------
  // 0   1 23
  var result = [];
  var a = getCurveItems(params.attackCurve, params.epsilon);
  var d = getCurveItems(params.decayCurve, params.epsilon);
  var t0 = 0;
  var t1 = params.attackTime;
  var t2 = params.gateTime;
  var t3 = params.gateTime;
  var v0 = a.zero;
  var v1 = Math.max(a.zero, d.zero, params.peakLevel);
  var vx = Math.max(d.zero, params.sustainLevel * params.peakLevel);
  var v2 = d.calc(t2, params.attackTime, params.attackTime + params.decayTime, v1, vx);
  var v3 = 0;

  result.push([_constants.SET, v0, t0]);
  result.push([a.type, v1, t1]);
  result.push([d.type, v2, t2]);
  result.push([_constants.SET, v3, t3]);

  return result;
}

function buildAttackDecaySustainReleaseEnvelope(params) {
  //     +
  //    / \
  //   /   +---*
  //  /         \
  // +           +-------
  // 0   1 2   3 4
  var result = [];
  var a = getCurveItems(params.attackCurve, params.epsilon);
  var d = getCurveItems(params.decayCurve, params.epsilon);
  var r = getCurveItems(params.releaseCurve, params.epsilon);
  var t0 = 0;
  var t1 = params.attackTime;
  var t2 = params.attackTime + params.decayTime;
  var t3 = params.gateTime;
  var t4 = params.gateTime + params.releaseTime;
  var v0 = a.zero;
  var v1 = Math.max(a.zero, d.zero, params.peakLevel);
  var v2 = Math.max(d.zero, r.zero, params.sustainLevel * params.peakLevel);
  var v3 = Math.max(d.zero, r.zero, params.sustainLevel * params.peakLevel);
  var v4 = Math.max(d.zero, r.zero);

  result.push([_constants.SET, v0, t0]);
  result.push([a.type, v1, t1]);
  result.push([d.type, v2, t2]);
  result.push([_constants.SET, v3, t3]);
  result.push([r.type, v4, t4]);

  return result;
}

function buildAttackDecayReleaseEnvelope(params) {
  //     +
  //    / \
  //   /   *
  //  /     \
  // +       +-----------
  // 0   1 2 3
  var result = [];
  var a = getCurveItems(params.attackCurve, params.epsilon);
  var d = getCurveItems(params.decayCurve, params.epsilon);
  var r = getCurveItems(params.releaseCurve, params.epsilon);
  var t0 = 0;
  var t1 = params.attackTime;
  var t2 = params.gateTime;
  var t3 = params.gateTime + params.releaseTime;
  var v0 = a.zero;
  var v1 = Math.max(a.zero, d.zero, params.peakLevel);
  var vx = Math.max(d.zero, params.sustainLevel * params.peakLevel);
  var v2 = d.calc(t2, params.attackTime, params.attackTime + params.decayTime, v1, vx);
  var v3 = Math.max(d.zero, r.zero);

  result.push([_constants.SET, v0, t0]);
  result.push([a.type, v1, t1]);
  result.push([d.type, v2, t2]);
  result.push([r.type, v3, t3]);

  return result;
}

exports["default"] = { build: build };
module.exports = exports["default"];
},{"./EnvelopeReducer":5,"./constants":7,"./utils/linexp":13,"./utils/linlin":14}],5:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _constants = require("./constants");

function reduce(envelope) {
  envelope = envelope.filter(function (items) {
    return isFinite(items[_constants.TIME]);
  });

  var changed = undefined;

  do {
    changed = false;

    if (2 <= envelope.length) {
      var a = envelope[envelope.length - 2];
      var b = envelope[envelope.length - 1];

      if (a[_constants.VALUE] === b[_constants.VALUE]) {
        envelope.pop();
      }
    }

    for (var i = envelope.length - 2; i >= 0; i--) {
      var a = envelope[i];
      var b = envelope[i + 1];

      if (a[_constants.TYPE] === _constants.SET) {
        if (b[_constants.TYPE] !== _constants.SET) {
          if (a[_constants.VALUE] === b[_constants.VALUE] || a[_constants.TIME] === b[_constants.TIME]) {
            b[_constants.TYPE] = _constants.SET;
            changed = true;
          }
        } else if (a[_constants.TIME] === b[_constants.TIME]) {
          envelope.splice(i, 1);
          changed = true;
        }
      }
    }
  } while (changed && envelope.length);

  return envelope;
}

exports["default"] = { reduce: reduce };
module.exports = exports["default"];
},{"./constants":7}],6:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

var _utilsLinlin = require("./utils/linlin");

var _utilsLinlin2 = _interopRequireDefault(_utilsLinlin);

var _utilsLinexp = require("./utils/linexp");

var _utilsLinexp2 = _interopRequireDefault(_utilsLinexp);

var _constants = require("./constants");

function at(envelope, time) {
  for (var i = 0, imax = envelope.length - 1; i < imax; i++) {
    var e0 = envelope[i];
    var e1 = envelope[i + 1];

    if (e0[_constants.TIME] <= time && time < e1[_constants.TIME]) {
      switch (e1[_constants.TYPE]) {
        case _constants.LIN:
          return (0, _utilsLinlin2["default"])(time, e0[_constants.TIME], e1[_constants.TIME], e0[_constants.VALUE], e1[_constants.VALUE]);
        case _constants.EXP:
          return (0, _utilsLinexp2["default"])(time, e0[_constants.TIME], e1[_constants.TIME], e0[_constants.VALUE], e1[_constants.VALUE]);
        default:
          return e0[_constants.VALUE];
      }
    }
  }

  return envelope.length ? envelope[envelope.length - 1][_constants.VALUE] : 0;
}

exports["default"] = { at: at };
module.exports = exports["default"];
},{"./constants":7,"./utils/linexp":13,"./utils/linlin":14}],7:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
var SET = 0;
exports.SET = SET;
var LIN = 1;
exports.LIN = LIN;
var EXP = 2;

exports.EXP = EXP;
var TYPE = 0;
exports.TYPE = TYPE;
var VALUE = 1;
exports.VALUE = VALUE;
var TIME = 2;
exports.TIME = TIME;
},{}],8:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = {
  attackTime: 0.01,
  decayTime: 0.3,
  sustainLevel: 0.5,
  releaseTime: 1,
  gateTime: Infinity,
  peakLevel: 1,
  epsilon: 1e-3,
  attackCurve: "lin",
  decayCurve: "lin",
  releaseCurve: "lin"
};
module.exports = exports["default"];
},{}],9:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

var _ADSREnvelope = require("./ADSREnvelope");

var _ADSREnvelope2 = _interopRequireDefault(_ADSREnvelope);

exports["default"] = _ADSREnvelope2["default"];
module.exports = exports["default"];
},{"./ADSREnvelope":2}],10:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = constrain;

function constrain(value, minValue, maxValue) {
  return Math.max(minValue, Math.min(value, maxValue));
}

module.exports = exports["default"];
},{}],11:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = defaults;

function defaults(value, defaultValue) {
  return typeof value !== "undefined" ? value : defaultValue;
}

module.exports = exports["default"];
},{}],12:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = isFiniteNumber;

function isFiniteNumber(value) {
  return typeof value === "number" && isFinite(value);
}

module.exports = exports["default"];
},{}],13:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = linexp;

function linexp(value, inMin, inMax, outMin, outMax) {
  return Math.pow(outMax / outMin, (value - inMin) / (inMax - inMin)) * outMin;
}

module.exports = exports["default"];
},{}],14:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = linlin;

function linlin(value, inMin, inMax, outMin, outMax) {
  return (value - inMin) / (inMax - inMin) * (outMax - outMin) + outMin;
}

module.exports = exports["default"];
},{}]},{},[1])(1)
});(function(factory) {
    if (typeof define === "function" && define.amd) {
      // AMD. Register as an anonymous module.
      define([], factory);
    } else if (typeof exports === "object") {
      // Node/CommonJS
      module.exports = factory();
    } else {
      // Browser globals
      window.wNumb = factory();
    }
  })(function() {
    "use strict";

    var FormatOptions = [
      "decimals",
      "thousand",
      "mark",
      "prefix",
      "suffix",
      "encoder",
      "decoder",
      "negativeBefore",
      "negative",
      "edit",
      "undo"
    ];

    // General

    // Reverse a string
    function strReverse(a) {
      return a
        .split("")
        .reverse()
        .join("");
    }

    // Check if a string starts with a specified prefix.
    function strStartsWith(input, match) {
      return input.substring(0, match.length) === match;
    }

    // Check is a string ends in a specified suffix.
    function strEndsWith(input, match) {
      return input.slice(-1 * match.length) === match;
    }

    // Throw an error if formatting options are incompatible.
    function throwEqualError(F, a, b) {
      if ((F[a] || F[b]) && F[a] === F[b]) {
        throw new Error(a);
      }
    }

    // Check if a number is finite and not NaN
    function isValidNumber(input) {
      return typeof input === "number" && isFinite(input);
    }

    // Provide rounding-accurate toFixed method.
    // Borrowed: http://stackoverflow.com/a/21323330/775265
    function toFixed(value, exp) {
      value = value.toString().split("e");
      value = Math.round(+(value[0] + "e" + (value[1] ? +value[1] + exp : exp)));
      value = value.toString().split("e");
      return (+(value[0] + "e" + (value[1] ? +value[1] - exp : -exp))).toFixed(exp);
    }

    // Formatting

    // Accept a number as input, output formatted string.
    function formatTo(
      decimals,
      thousand,
      mark,
      prefix,
      suffix,
      encoder,
      decoder,
      negativeBefore,
      negative,
      edit,
      undo,
      input
    ) {
      var originalInput = input,
        inputIsNegative,
        inputPieces,
        inputBase,
        inputDecimals = "",
        output = "";

      // Apply user encoder to the input.
      // Expected outcome: number.
      if (encoder) {
        input = encoder(input);
      }

      // Stop if no valid number was provided, the number is infinite or NaN.
      if (!isValidNumber(input)) {
        return false;
      }

      // Rounding away decimals might cause a value of -0
      // when using very small ranges. Remove those cases.
      if (decimals !== false && parseFloat(input.toFixed(decimals)) === 0) {
        input = 0;
      }

      // Formatting is done on absolute numbers,
      // decorated by an optional negative symbol.
      if (input < 0) {
        inputIsNegative = true;
        input = Math.abs(input);
      }

      // Reduce the number of decimals to the specified option.
      if (decimals !== false) {
        input = toFixed(input, decimals);
      }

      // Transform the number into a string, so it can be split.
      input = input.toString();

      // Break the number on the decimal separator.
      if (input.indexOf(".") !== -1) {
        inputPieces = input.split(".");

        inputBase = inputPieces[0];

        if (mark) {
          inputDecimals = mark + inputPieces[1];
        }
      } else {
        // If it isn't split, the entire number will do.
        inputBase = input;
      }

      // Group numbers in sets of three.
      if (thousand) {
        inputBase = strReverse(inputBase).match(/.{1,3}/g);
        inputBase = strReverse(inputBase.join(strReverse(thousand)));
      }

      // If the number is negative, prefix with negation symbol.
      if (inputIsNegative && negativeBefore) {
        output += negativeBefore;
      }

      // Prefix the number
      if (prefix) {
        output += prefix;
      }

      // Normal negative option comes after the prefix. Defaults to '-'.
      if (inputIsNegative && negative) {
        output += negative;
      }

      // Append the actual number.
      output += inputBase;
      output += inputDecimals;

      // Apply the suffix.
      if (suffix) {
        output += suffix;
      }

      // Run the output through a user-specified post-formatter.
      if (edit) {
        output = edit(output, originalInput);
      }

      // All done.
      return output;
    }

    // Accept a sting as input, output decoded number.
    function formatFrom(
      decimals,
      thousand,
      mark,
      prefix,
      suffix,
      encoder,
      decoder,
      negativeBefore,
      negative,
      edit,
      undo,
      input
    ) {
      var originalInput = input,
        inputIsNegative,
        output = "";

      // User defined pre-decoder. Result must be a non empty string.
      if (undo) {
        input = undo(input);
      }

      // Test the input. Can't be empty.
      if (!input || typeof input !== "string") {
        return false;
      }

      // If the string starts with the negativeBefore value: remove it.
      // Remember is was there, the number is negative.
      if (negativeBefore && strStartsWith(input, negativeBefore)) {
        input = input.replace(negativeBefore, "");
        inputIsNegative = true;
      }

      // Repeat the same procedure for the prefix.
      if (prefix && strStartsWith(input, prefix)) {
        input = input.replace(prefix, "");
      }

      // And again for negative.
      if (negative && strStartsWith(input, negative)) {
        input = input.replace(negative, "");
        inputIsNegative = true;
      }

      // Remove the suffix.
      // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/slice
      if (suffix && strEndsWith(input, suffix)) {
        input = input.slice(0, -1 * suffix.length);
      }

      // Remove the thousand grouping.
      if (thousand) {
        input = input.split(thousand).join("");
      }

      // Set the decimal separator back to period.
      if (mark) {
        input = input.replace(mark, ".");
      }

      // Prepend the negative symbol.
      if (inputIsNegative) {
        output += "-";
      }

      // Add the number
      output += input;

      // Trim all non-numeric characters (allow '.' and '-');
      output = output.replace(/[^0-9\.\-.]/g, "");

      // The value contains no parse-able number.
      if (output === "") {
        return false;
      }

      // Covert to number.
      output = Number(output);

      // Run the user-specified post-decoder.
      if (decoder) {
        output = decoder(output);
      }

      // Check is the output is valid, otherwise: return false.
      if (!isValidNumber(output)) {
        return false;
      }

      return output;
    }

    // Framework

    // Validate formatting options
    function validate(inputOptions) {
      var i,
        optionName,
        optionValue,
        filteredOptions = {};

      if (inputOptions["suffix"] === undefined) {
        inputOptions["suffix"] = inputOptions["postfix"];
      }

      for (i = 0; i < FormatOptions.length; i += 1) {
        optionName = FormatOptions[i];
        optionValue = inputOptions[optionName];

        if (optionValue === undefined) {
          // Only default if negativeBefore isn't set.
          if (optionName === "negative" && !filteredOptions.negativeBefore) {
            filteredOptions[optionName] = "-";
            // Don't set a default for mark when 'thousand' is set.
          } else if (optionName === "mark" && filteredOptions.thousand !== ".") {
            filteredOptions[optionName] = ".";
          } else {
            filteredOptions[optionName] = false;
          }

          // Floating points in JS are stable up to 7 decimals.
        } else if (optionName === "decimals") {
          if (optionValue >= 0 && optionValue < 8) {
            filteredOptions[optionName] = optionValue;
          } else {
            throw new Error(optionName);
          }

          // These options, when provided, must be functions.
        } else if (
          optionName === "encoder" ||
          optionName === "decoder" ||
          optionName === "edit" ||
          optionName === "undo"
        ) {
          if (typeof optionValue === "function") {
            filteredOptions[optionName] = optionValue;
          } else {
            throw new Error(optionName);
          }

          // Other options are strings.
        } else {
          if (typeof optionValue === "string") {
            filteredOptions[optionName] = optionValue;
          } else {
            throw new Error(optionName);
          }
        }
      }

      // Some values can't be extracted from a
      // string if certain combinations are present.
      throwEqualError(filteredOptions, "mark", "thousand");
      throwEqualError(filteredOptions, "prefix", "negative");
      throwEqualError(filteredOptions, "prefix", "negativeBefore");

      return filteredOptions;
    }

    // Pass all options as function arguments
    function passAll(options, method, input) {
      var i,
        args = [];

      // Add all options in order of FormatOptions
      for (i = 0; i < FormatOptions.length; i += 1) {
        args.push(options[FormatOptions[i]]);
      }

      // Append the input, then call the method, presenting all
      // options as arguments.
      args.push(input);
      return method.apply("", args);
    }

    function wNumb(options) {
      if (!(this instanceof wNumb)) {
        return new wNumb(options);
      }

      if (typeof options !== "object") {
        return;
      }

      options = validate(options);

      // Call 'formatTo' with proper arguments.
      this.to = function(input) {
        return passAll(options, formatTo, input);
      };

      // Call 'formatFrom' with proper arguments.
      this.from = function(input) {
        return passAll(options, formatFrom, input);
      };
    }

    return wNumb;
  });(function(e) {
    if (typeof define === "function" && define.amd) {
        define(["jquery"], e)
    } else {
        e(jQuery)
    }
})(function(e) {
    "use strict";
    var t = {},
        n = Math.max,
        r = Math.min;
    t.c = {};
    t.c.d = e(document);
    t.c.t = function(e) {
        return e.originalEvent.touches.length - 1
    };
    t.o = function() {
        var n = this;
        this.o = null;
        this.$ = null;
        this.i = null;
        this.g = null;
        this.v = null;
        this.cv = null;
        this.x = 0;
        this.y = 0;
        this.w = 0;
        this.h = 0;
        this.$c = null;
        this.c = null;
        this.t = 0;
        this.isInit = false;
        this.fgColor = null;
        this.pColor = null;
        this.dH = null;
        this.cH = null;
        this.eH = null;
        this.rH = null;
        this.scale = 1;
        this.relative = false;
        this.relativeWidth = false;
        this.relativeHeight = false;
        this.$div = null;
        this.run = function() {
            var t = function(e, t) {
                var r;
                for (r in t) {
                    n.o[r] = t[r]
                }
                n._carve().init();
                n._configure()._draw()
            };
            if (this.$.data("kontroled")) return;
            this.$.data("kontroled", true);
            this.extend();
            this.o = e.extend({
                min: this.$.data("min") !== undefined ? this.$.data("min") : 0,
                max: this.$.data("max") !== undefined ? this.$.data("max") : 100,
                stopper: true,
                readOnly: this.$.data("readonly") || this.$.attr("readonly") === "readonly",
                cursor: this.$.data("cursor") === true && 30 || this.$.data("cursor") || 0,
                thickness: this.$.data("thickness") && Math.max(Math.min(this.$.data("thickness"), 1), .01) || .35,
                lineCap: this.$.data("linecap") || "butt",
                width: this.$.data("width") || 200,
                height: this.$.data("height") || 200,
                displayInput: this.$.data("displayinput") == null || this.$.data("displayinput"),
                displayPrevious: this.$.data("displayprevious"),
                fgColor: this.$.data("fgcolor") || "#87CEEB",
                inputColor: this.$.data("inputcolor"),
                font: this.$.data("font") || "Arial",
                fontWeight: this.$.data("font-weight") || "bold",
                inline: false,
                step: this.$.data("step") || 1,
                rotation: this.$.data("rotation"),
                draw: null,
                change: null,
                cancel: null,
                release: null,
                format: function(e) {
                    return e
                },
                parse: function(e) {
                    return parseFloat(e)
                }
            }, this.o);
            this.o.flip = this.o.rotation === "anticlockwise" || this.o.rotation === "acw";
            if (!this.o.inputColor) {
                this.o.inputColor = this.o.fgColor
            }
            if (this.$.is("fieldset")) {
                this.v = {};
                this.i = this.$.find("input");
                this.i.each(function(t) {
                    var r = e(this);
                    n.i[t] = r;
                    n.v[t] = n.o.parse(r.val());
                    r.bind("change blur", function() {
                        var e = {};
                        e[t] = r.val();
                        n.val(n._validate(e))
                    })
                });
                this.$.find("legend").remove()
            } else {
                this.i = this.$;
                this.v = this.o.parse(this.$.val());
                this.v === "" && (this.v = this.o.min);
                this.$.bind("change blur", function() {
                    n.val(n._validate(n.o.parse(n.$.val())))
                })
            }!this.o.displayInput && this.$.hide();
            this.$c = e(document.createElement("canvas")).attr({
                width: this.o.width,
                height: this.o.height
            });
            this.$div = e('<div style="' + (this.o.inline ? "display:inline;" : "") + "width:" + this.o.width + "px;height:" + this.o.height + "px;" + '"></div>');
            this.$.wrap(this.$div).before(this.$c);
            this.$div = this.$.parent();
            if (typeof G_vmlCanvasManager !== "undefined") {
                G_vmlCanvasManager.initElement(this.$c[0])
            }
            this.c = this.$c[0].getContext ? this.$c[0].getContext("2d") : null;
            if (!this.c) {
                throw {
                    name: "CanvasNotSupportedException",
                    message: "Canvas not supported. Please use excanvas on IE8.0.",
                    toString: function() {
                        return this.name + ": " + this.message
                    }
                }
            }
            this.scale = (window.devicePixelRatio || 1) / (this.c.webkitBackingStorePixelRatio || this.c.mozBackingStorePixelRatio || this.c.msBackingStorePixelRatio || this.c.oBackingStorePixelRatio || this.c.backingStorePixelRatio || 1);
            this.relativeWidth = this.o.width % 1 !== 0 && this.o.width.indexOf("%");
            this.relativeHeight = this.o.height % 1 !== 0 && this.o.height.indexOf("%");
            this.relative = this.relativeWidth || this.relativeHeight;
            this._carve();
            if (this.v instanceof Object) {
                this.cv = {};
                this.copy(this.v, this.cv)
            } else {
                this.cv = this.v
            }
            this.$.bind("configure", t).parent().bind("configure", t);
            this._listen()._configure()._xy().init();
            this.isInit = true;
            this.$.val(this.o.format(this.v));
            this._draw();
            return this
        };
        this._carve = function() {
            if (this.relative) {
                var e = this.relativeWidth ? this.$div.parent().width() * parseInt(this.o.width) / 100 : this.$div.parent().width(),
                    t = this.relativeHeight ? this.$div.parent().height() * parseInt(this.o.height) / 100 : this.$div.parent().height();
                this.w = this.h = Math.min(e, t)
            } else {
                this.w = this.o.width;
                this.h = this.o.height
            }
            this.$div.css({
                width: this.w + "px",
                height: this.h + "px"
            });
            this.$c.attr({
                width: this.w,
                height: this.h
            });
            if (this.scale !== 1) {
                this.$c[0].width = this.$c[0].width * this.scale;
                this.$c[0].height = this.$c[0].height * this.scale;
                this.$c.width(this.w);
                this.$c.height(this.h)
            }
            return this
        };
        this._draw = function() {
            var e = true;
            n.g = n.c;
            n.clear();
            n.dH && (e = n.dH());
            e !== false && n.draw()
        };
        this._touch = function(e) {
            var r = function(e) {
                var t = n.xy2val(e.originalEvent.touches[n.t].pageX, e.originalEvent.touches[n.t].pageY);
                if (t == n.cv) return;
                if (n.cH && n.cH(t) === false) return;
                n.change(n._validate(t));
                n._draw()
            };
            this.t = t.c.t(e);
            r(e);
            t.c.d.bind("touchmove.k", r).bind("touchend.k", function() {
                t.c.d.unbind("touchmove.k touchend.k");
                n.val(n.cv)
            });
            return this
        };
        this._mouse = function(e) {
            var r = function(e) {
                var t = n.xy2val(e.pageX, e.pageY);
                if (t == n.cv) return;
                if (n.cH && n.cH(t) === false) return;
                n.change(n._validate(t));
                n._draw()
            };
            r(e);
            t.c.d.bind("mousemove.k", r).bind("keyup.k", function(e) {
                if (e.keyCode === 27) {
                    t.c.d.unbind("mouseup.k mousemove.k keyup.k");
                    if (n.eH && n.eH() === false) return;
                    n.cancel()
                }
            }).bind("mouseup.k", function(e) {
                t.c.d.unbind("mousemove.k mouseup.k keyup.k");
                n.val(n.cv)
            });
            return this
        };
        this._xy = function() {
            var e = this.$c.offset();
            this.x = e.left;
            this.y = e.top;
            return this
        };
        this._listen = function() {
            if (!this.o.readOnly) {
                this.$c.bind("mousedown", function(e) {
                    e.preventDefault();
                    n._xy()._mouse(e)
                }).bind("touchstart", function(e) {
                    e.preventDefault();
                    n._xy()._touch(e)
                });
                this.listen()
            } else {
                this.$.attr("readonly", "readonly")
            }
            if (this.relative) {
                e(window).resize(function() {
                    n._carve().init();
                    n._draw()
                })
            }
            return this
        };
        this._configure = function() {
            if (this.o.draw) this.dH = this.o.draw;
            if (this.o.change) this.cH = this.o.change;
            if (this.o.cancel) this.eH = this.o.cancel;
            if (this.o.release) this.rH = this.o.release;
            if (this.o.displayPrevious) {
                this.pColor = this.h2rgba(this.o.fgColor, "0.4");
                this.fgColor = this.h2rgba(this.o.fgColor, "0.6")
            } else {
                this.fgColor = this.o.fgColor
            }
            return this
        };
        this._clear = function() {
            this.$c[0].width = this.$c[0].width
        };
        this._validate = function(e) {
            var t = ~~((e < 0 ? -.5 : .5) + e / this.o.step) * this.o.step;
            return Math.round(t * 100) / 100
        };
        this.listen = function() {};
        this.extend = function() {};
        this.init = function() {};
        this.change = function(e) {};
        this.val = function(e) {};
        this.xy2val = function(e, t) {};
        this.draw = function() {};
        this.clear = function() {
            this._clear()
        };
        this.h2rgba = function(e, t) {
            var n;
            e = e.substring(1, 7);
            n = [parseInt(e.substring(0, 2), 16), parseInt(e.substring(2, 4), 16), parseInt(e.substring(4, 6), 16)];
            return "rgba(" + n[0] + "," + n[1] + "," + n[2] + "," + t + ")"
        };
        this.copy = function(e, t) {
            for (var n in e) {
                t[n] = e[n]
            }
        }
    };
    t.Dial = function() {
        t.o.call(this);
        this.startAngle = null;
        this.xy = null;
        this.radius = null;
        this.lineWidth = null;
        this.cursorExt = null;
        this.w2 = null;
        this.PI2 = 2 * Math.PI;
        this.extend = function() {
            this.o = e.extend({
                bgColor: this.$.data("bgcolor") || "#EEEEEE",
                angleOffset: this.$.data("angleoffset") || 0,
                angleArc: this.$.data("anglearc") || 360,
                inline: true
            }, this.o)
        };
        this.val = function(e, t) {
            if (null != e) {
                e = this.o.parse(e);
                if (t !== false && e != this.v && this.rH && this.rH(e) === false) {
                    return
                }
                this.cv = this.o.stopper ? n(r(e, this.o.max), this.o.min) : e;
                this.v = this.cv;
                this.$.val(this.o.format(this.v));
                this._draw()
            } else {
                return this.v
            }
        };
        this.xy2val = function(e, t) {
            var i, s;
            i = Math.atan2(e - (this.x + this.w2), -(t - this.y - this.w2)) - this.angleOffset;
            if (this.o.flip) {
                i = this.angleArc - i - this.PI2
            }
            if (this.angleArc != this.PI2 && i < 0 && i > -.5) {
                i = 0
            } else if (i < 0) {
                i += this.PI2
            }
            s = i * (this.o.max - this.o.min) / this.angleArc + this.o.min;
            this.o.stopper && (s = n(r(s, this.o.max), this.o.min));
            return s
        };
        this.listen = function() {
            var t = this,
                i, s, o = function(e) {
                    e.preventDefault();
                    var o = e.originalEvent,
                        u = o.detail || o.wheelDeltaX,
                        a = o.detail || o.wheelDeltaY,
                        f = t._validate(t.o.parse(t.$.val())) + (u > 0 || a > 0 ? t.o.step : u < 0 || a < 0 ? -t.o.step : 0);
                    f = n(r(f, t.o.max), t.o.min);
                    t.val(f, false);
                    if (t.rH) {
                        clearTimeout(i);
                        i = setTimeout(function() {
                            t.rH(f);
                            i = null
                        }, 100);
                        if (!s) {
                            s = setTimeout(function() {
                                if (i) t.rH(f);
                                s = null
                            }, 200)
                        }
                    }
                },
                u, a, f = 1,
                l = {
                    37: -t.o.step,
                    38: t.o.step,
                    39: t.o.step,
                    40: -t.o.step
                };
            this.$.bind("keydown", function(i) {
                var s = i.keyCode;
                if (s >= 96 && s <= 105) {
                    s = i.keyCode = s - 48
                }
                u = parseInt(String.fromCharCode(s));
                if (isNaN(u)) {
                    s !== 13 && s !== 8 && s !== 9 && s !== 189 && (s !== 190 || t.$.val().match(/\./)) && i.preventDefault();
                    if (e.inArray(s, [37, 38, 39, 40]) > -1) {
                        i.preventDefault();
                        var o = t.o.parse(t.$.val()) + l[s] * f;
                        t.o.stopper && (o = n(r(o, t.o.max), t.o.min));
                        t.change(t._validate(o));
                        t._draw();
                        a = window.setTimeout(function() {
                            f *= 2
                        }, 30)
                    }
                }
            }).bind("keyup", function(e) {
                if (isNaN(u)) {
                    if (a) {
                        window.clearTimeout(a);
                        a = null;
                        f = 1;
                        t.val(t.$.val())
                    }
                } else {
                    t.$.val() > t.o.max && t.$.val(t.o.max) || t.$.val() < t.o.min && t.$.val(t.o.min)
                }
            });
            this.$c.bind("mousewheel DOMMouseScroll", o);
            this.$.bind("mousewheel DOMMouseScroll", o)
        };
        this.init = function() {
            if (this.v < this.o.min || this.v > this.o.max) {
                this.v = this.o.min
            }
            this.$.val(this.v);
            this.w2 = this.w / 2;
            this.cursorExt = this.o.cursor / 100;
            this.xy = this.w2 * this.scale;
            this.lineWidth = this.xy * this.o.thickness;
            this.lineCap = this.o.lineCap;
            this.radius = this.xy - this.lineWidth / 2;
            this.o.angleOffset && (this.o.angleOffset = isNaN(this.o.angleOffset) ? 0 : this.o.angleOffset);
            this.o.angleArc && (this.o.angleArc = isNaN(this.o.angleArc) ? this.PI2 : this.o.angleArc);
            this.angleOffset = this.o.angleOffset * Math.PI / 180;
            this.angleArc = this.o.angleArc * Math.PI / 180;
            this.startAngle = 1.5 * Math.PI + this.angleOffset;
            this.endAngle = 1.5 * Math.PI + this.angleOffset + this.angleArc;
            var e = n(String(Math.abs(this.o.max)).length, String(Math.abs(this.o.min)).length, 2) + 2;
            this.o.displayInput && this.i.css({
                width: (this.w / 2 + 4 >> 0) + "px",
                height: (this.w / 3 >> 0) + "px",
                position: "absolute",
                "vertical-align": "middle",
                "margin-top": (this.w / 3 >> 0) + "px",
                "margin-left": "-" + (this.w * 3 / 4 + 2 >> 0) + "px",
                border: 0,
                background: "none",
                font: this.o.fontWeight + " " + (this.w / e >> 0) + "px " + this.o.font,
                "text-align": "center",
                color: this.o.inputColor || this.o.fgColor,
                padding: "0px",
                "-webkit-appearance": "none"
            }) || this.i.css({
                width: "0px",
                visibility: "hidden"
            })
        };
        this.change = function(e) {
            this.cv = e;
            this.$.val(this.o.format(e))
        };
        this.angle = function(e) {
            return (e - this.o.min) * this.angleArc / (this.o.max - this.o.min)
        };
        this.arc = function(e) {
            var t, n;
            e = this.angle(e);
            if (this.o.flip) {
                t = this.endAngle + 1e-5;
                n = t - e - 1e-5
            } else {
                t = this.startAngle - 1e-5;
                n = t + e + 1e-5
            }
            this.o.cursor && (t = n - this.cursorExt) && (n = n + this.cursorExt);
            return {
                s: t,
                e: n,
                d: this.o.flip && !this.o.cursor
            }
        };
        this.draw = function() {
            var e = this.g,
                t = this.arc(this.cv),
                n, r = 1;
            e.lineWidth = this.lineWidth;
            e.lineCap = this.lineCap;
            if (this.o.bgColor !== "none") {
                e.beginPath();
                e.strokeStyle = this.o.bgColor;
                e.arc(this.xy, this.xy, this.radius, this.endAngle - 1e-5, this.startAngle + 1e-5, true);
                e.stroke()
            }
            if (this.o.displayPrevious) {
                n = this.arc(this.v);
                e.beginPath();
                e.strokeStyle = this.pColor;
                e.arc(this.xy, this.xy, this.radius, n.s, n.e, n.d);
                e.stroke();
                r = this.cv == this.v
            }
            e.beginPath();
            e.strokeStyle = r ? this.o.fgColor : this.fgColor;
            e.arc(this.xy, this.xy, this.radius, t.s, t.e, t.d);
            e.stroke()
        };
        this.cancel = function() {
            this.val(this.v)
        }
    };
    e.fn.dial = e.fn.knob = function(n) {
        return this.each(function() {
            var r = new t.Dial;
            r.o = n;
            r.$ = e(this);
            r.run()
        }).parent()
    }
})</script>
</head>
<body>
<div class="container">
<div class="source-icon">
                    SOURCE
                    <div class="mode-button" onclick="switchColorModes(this);" value="0">
<p>mode</p>
</div>
</div>
<div class="query-parameters">
<div class="query-search">
<div class="query-text">
<input class="query-box" name="query" type="text"/>
</div>
<div class="query-button" onclick="ss.addSoundsByQuery()">
<div class="query-icon">
<svg fill="none" height="18" id="query-indicator" stroke="#d4d2d2" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="18" xmlns="http://www.w3.org/2000/svg">
<circle cx="11" cy="11" r="8"></circle><line x1="21" x2="16.65" y1="21" y2="16.65"></line>
</svg>
</div>
</div>
</div>
<div id="q-par-labels">
<p style="margin-left: 5px;">Number of sounds</p>
<p style="margin-left: -5px;">Min/Max Sound Length</p>
<p style="margin-left: 2px;">Note Layout Type</p>
</div>
<div id="q-par">
<div class="single-slider">
</div>
<div class="double-slider">
</div>
<div class="slider-regular" id="noteLayout" onclick="changeNoteLayout();">
<p style="margin-top:3px;">contiguous</p>
</div>
</div>
</div>
<div class="waveform">
<div id="waveform"></div>
<div class="launch-mode">
<div class="left-arrow">
<button class="left-arrow-inner" onclick="updateLaunchMode(this);"></button>
</div>
<div class="outer-box" id="outer-box-launch">
<div class="inner-box" id="inner-box-launch">
<p>default</p>
</div>
</div>
<div class="right-arrow">
<button class="right-arrow-inner" onclick="updateLaunchMode(this);"></button>
</div>
</div>
</div>
<div class="adsr">
<canvas id="adsr-envelope" style="background-color: transparent;"></canvas>
</div>
<div class="adsr-envelope-knobs">
<div class="adsr-header">
<div class="left-arrow">
<button class="left-arrow-inner" onclick="changeADSRElementId(this);"></button>
</div>
<div class="outer-box" id="outer-box-adsr">
<div class="inner-box" id="inner-box-launch">
<p>amplitude</p>
</div>
</div>
<div class="right-arrow">
<button class="right-arrow-inner" onclick="changeADSRElementId(this);"></button>
</div>
</div>
<div class="adsr-first-knob">
<div class="knob-1" id="attack">
<div class="knob-inner"></div>
<p style="margin-left:7.5px;">attack</p>
</div>
<div class="knob-1" id="decay">
<div class="knob-inner"></div>
<p style="margin-left:7.5px;">decay</p>
</div>
<div class="knob-1" id="sustain">
<div class="knob-inner"></div>
<p style="margin-left:7px;">sustain</p>
</div>
<div class="knob-1" id="release">
<div class="knob-inner"></div>
<p style="margin-left:8px;">release</p>
</div>
</div>
<div class="adsr-second-knob">
<div class="knob-2000" id="gain">
<div class="knob-inner"></div>
<p style="margin-left:7.5px;">gain</p>
</div>
<div class="knob-1" id="pan">
<div class="knob-inner"></div>
<p style="margin-left:9px;">pan</p>
</div>
</div>
</div>
<div class="sound-list">
<select id="sound-dropdown" multiple="" name="sounds" onchange="updateGlobalSoundUUID();" style="width:100%;height:100%;">
</select>
<div class="sound-list-options">
<div class="sound-list-buttons">
<div class="stop-icon" onclick="ss.stopSound('stop');"></div>
</div>
<div class="sound-list-buttons">
<div class="remove-icon" onclick="removeSoundFromList();"></div>
</div>
<div class="sound-list-buttons" id="reverse" onclick="ss.playSound();" value="0">
</div>
</div>
</div>
<div class="parameter-knobs">
<div class="modulation-velocity-header">
<div class="left-arrow">
<button class="left-arrow-inner" onclick="changeModulationVelocityID(this);"></button>
</div>
<div class="outer-box" id="outer-box-modulation-velocity">
<div class="inner-box" id="inner-box-launch">
<p>modulation</p>
</div>
</div>
<div class="right-arrow">
<button class="right-arrow-inner" onclick="changeModulationVelocityID(this);"></button>
</div>
</div>
<div class="modulation-velocity-knob-area">
<div class="knob-12" id="mod2GainAmt">
<div class="knob-inner"></div>
<p style="margin-left:7.5px;">gain</p>
</div>
<div class="knob-100" id="mod2CutoffAmt">
<div class="knob-inner"></div>
<p style="margin-left:7.5px;">cutoff</p>
</div>
<div class="knob-12" id="mod2PitchAmt">
<div class="knob-inner"></div>
<p style="margin-left:7px;">pitch</p>
</div>
</div>
<div class="reverb-knob-area">
<div class="knob-reverb" id="roomSize">
<div class="knob-inner"></div>
<p style="margin-left:6.5px;">room</p>
</div>
<div class="knob-reverb" id="damping">
<div class="knob-inner"></div>
<p style="margin-left:7.5px;">damping</p>
</div>
<div class="knob-reverb" id="wetLevel">
<div class="knob-inner"></div>
<p style="margin-left:8px;">wet</p>
</div>
<div class="knob-reverb" id="dryLevel">
<div class="knob-inner"></div>
<p style="margin-left:8px;">dry</p>
</div>
</div>
</div>
<div class="keyboard">
<div id="keyboard">
<ul class="keys">
<li class="white-key" id="23" note="C" onclick="sendMidiMessage(this);">
<p>C0</p>
</li>
<li class="black-key" id="24" note="C#" onclick="sendMidiMessage(this);"></li>
<li class="white-key offset" id="25" note="D" onclick="sendMidiMessage(this);"></li>
<li class="black-key" id="26" note="D#" onclick="sendMidiMessage(this);"></li>
<li class="white-key offset" id="27" note="E" onclick="sendMidiMessage(this);"></li>
<li class="white-key" id="28" note="F" onclick="sendMidiMessage(this);"></li>
<li class="black-key" id="29" note="F#" onclick="sendMidiMessage(this);"></li>
<li class="white-key offset" id="30" note="G" onclick="sendMidiMessage(this);"></li>
<li class="black-key" id="31" note="G#" onclick="sendMidiMessage(this);"></li>
<li class="white-key offset" id="32" note="A" onclick="sendMidiMessage(this);"></li>
<li class="black-key" id="33" note="A#" onclick="sendMidiMessage(this);"></li>
<li class="white-key offset" id="34" note="B" onclick="sendMidiMessage(this);"></li>
<li class="white-key" id="35" note="C" onclick="sendMidiMessage(this);">
<p>C1</p>
</li>
<li class="black-key" id="36" note="C#" onclick="sendMidiMessage(this);"></li>
<li class="white-key offset" id="37" note="D" onclick="sendMidiMessage(this);"></li>
<li class="black-key" id="38" note="D#" onclick="sendMidiMessage(this);"></li>
<li class="white-key offset" id="39" note="E" onclick="sendMidiMessage(this);"></li>
<li class="white-key" id="40" note="F" onclick="sendMidiMessage(this);"></li>
<li class="black-key" id="41" note="F#" onclick="sendMidiMessage(this);"></li>
<li class="white-key offset" id="42" note="G" onclick="sendMidiMessage(this);"></li>
<li class="black-key" id="43" note="G#" onclick="sendMidiMessage(this);"></li>
<li class="white-key offset" id="44" note="A" onclick="sendMidiMessage(this);"></li>
<li class="black-key" id="45" note="A#" onclick="sendMidiMessage(this);"></li>
<li class="white-key offset" id="46" note="B" onclick="sendMidiMessage(this);"></li>
<li class="white-key" id="47" note="C" onclick="sendMidiMessage(this);">
<p>C2</p>
</li>
<li class="black-key" id="48" note="C#" onclick="sendMidiMessage(this);"></li>
<li class="white-key offset" id="49" note="D" onclick="sendMidiMessage(this);"></li>
<li class="black-key" id="50" note="D#" onclick="sendMidiMessage(this);"></li>
<li class="white-key offset" id="51" note="E" onclick="sendMidiMessage(this);"></li>
<li class="white-key" id="52" note="F" onclick="sendMidiMessage(this);"></li>
<li class="black-key" id="53" note="F#" onclick="sendMidiMessage(this);"></li>
<li class="white-key offset" id="54" note="G" onclick="sendMidiMessage(this);"></li>
<li class="black-key" id="55" note="G#" onclick="sendMidiMessage(this);"></li>
<li class="white-key offset" id="56" note="A" onclick="sendMidiMessage(this);"></li>
<li class="black-key" id="57" note="A#" onclick="sendMidiMessage(this);"></li>
<li class="white-key offset" id="58" note="B" onclick="sendMidiMessage(this);"></li>
<li class="white-key" id="59" note="C" onclick="sendMidiMessage(this);">
<p>C3</p>
</li>
<li class="black-key" id="60" note="C#" onclick="sendMidiMessage(this);"></li>
<li class="white-key offset" id="61" note="D" onclick="sendMidiMessage(this);"></li>
<li class="black-key" id="62" note="D#" onclick="sendMidiMessage(this);"></li>
<li class="white-key offset" id="63" note="E" onclick="sendMidiMessage(this);"></li>
<li class="white-key" id="64" note="F" onclick="sendMidiMessage(this);"></li>
<li class="black-key" id="65" note="F#" onclick="sendMidiMessage(this);"></li>
<li class="white-key offset" id="66" note="G" onclick="sendMidiMessage(this);"></li>
<li class="black-key" id="67" note="G#" onclick="sendMidiMessage(this);"></li>
<li class="white-key offset" id="68" note="A" onclick="sendMidiMessage(this);"></li>
<li class="black-key" id="69" note="A#" onclick="sendMidiMessage(this);"></li>
<li class="white-key offset" id="70" note="B" onclick="sendMidiMessage(this);"></li>
<li class="white-key" id="71" note="C2" onclick="sendMidiMessage(this);">
<p>C4</p>
</li>
<li class="black-key" id="72" note="C#" onclick="sendMidiMessage(this);"></li>
<li class="white-key offset" id="73" note="D" onclick="sendMidiMessage(this);"></li>
<li class="black-key" id="74" note="D#" onclick="sendMidiMessage(this);"></li>
<li class="white-key offset" id="75" note="E" onclick="sendMidiMessage(this);"></li>
<li class="white-key" id="76" note="F" onclick="sendMidiMessage(this);"></li>
<li class="black-key" id="77" note="F#" onclick="sendMidiMessage(this);"></li>
<li class="white-key offset" id="78" note="G" onclick="sendMidiMessage(this);"></li>
<li class="black-key" id="79" note="G#" onclick="sendMidiMessage(this);"></li>
<li class="white-key offset" id="80" note="A" onclick="sendMidiMessage(this);"></li>
<li class="black-key" id="81" note="A#" onclick="sendMidiMessage(this);"></li>
<li class="white-key offset" id="82" note="B" onclick="sendMidiMessage(this);"></li>
<li class="white-key" id="83" note="C2" onclick="sendMidiMessage(this);">
<p>C5</p>
</li>
<li class="black-key" id="84" note="C#" onclick="sendMidiMessage(this);"></li>
<li class="white-key offset" id="85" note="D" onclick="sendMidiMessage(this);"></li>
<li class="black-key" id="86" note="D#" onclick="sendMidiMessage(this);"></li>
<li class="white-key offset" id="87" note="E" onclick="sendMidiMessage(this);"></li>
<li class="white-key" id="88" note="F" onclick="sendMidiMessage(this);"></li>
<li class="black-key" id="89" note="F#" onclick="sendMidiMessage(this);"></li>
<li class="white-key offset" id="90" note="G" onclick="sendMidiMessage(this);"></li>
<li class="black-key" id="91" note="G#" onclick="sendMidiMessage(this);"></li>
<li class="white-key offset" id="92" note="A" onclick="sendMidiMessage(this);"></li>
<li class="black-key" id="93" note="A#" onclick="sendMidiMessage(this);"></li>
<li class="white-key offset" id="94" note="B" onclick="sendMidiMessage(this);"></li>
</ul>
<input class="slider-regular-down" id="pitch" max="36.0" min="-36.0" name="pitch" oninput="ss.setSoundParameter(this.name, this.value, this.min, this.max)" step="0.01" style="transform: rotate(-90deg);width: 75px; height:20px;" type="range" value="0.0"/>
</div>
<div class="keyboard-header">
<div class="left-arrow">
<button class="left-arrow-inner" onclick="updateGateTriggerMode(this);"></button>
</div>
<div class="outer-box" id="outer-box-keyboard">
<div class="inner-box" id="inner-box-launch">
<p>gate</p>
</div>
</div>
<div class="right-arrow">
<button class="right-arrow-inner" onclick="updateGateTriggerMode(this);"></button>
</div>
</div>
</div>
</div>
</body>
</html>
